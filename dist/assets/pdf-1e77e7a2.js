import{_ as Rt}from"./index-8ec824bb.js";var Vt={976:(dt,et,V)=>{V.d(et,{AnnotationLayer:()=>ct,FreeTextAnnotationElement:()=>B,InkAnnotationElement:()=>Q,StampAnnotationElement:()=>ht});var y=V(292),z=V(419),_=V(792);function U(Z){return Math.floor(Math.max(0,Math.min(1,Z))*255).toString(16).padStart(2,"0")}function F(Z){return Math.max(0,Math.min(255,255*Z))}class C{static CMYK_G([m,l,e,n]){return["G",1-Math.min(1,.3*m+.59*e+.11*l+n)]}static G_CMYK([m]){return["CMYK",0,0,0,1-m]}static G_RGB([m]){return["RGB",m,m,m]}static G_rgb([m]){return m=F(m),[m,m,m]}static G_HTML([m]){const l=U(m);return`#${l}${l}${l}`}static RGB_G([m,l,e]){return["G",.3*m+.59*l+.11*e]}static RGB_rgb(m){return m.map(F)}static RGB_HTML(m){return`#${m.map(U).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([m,l,e,n]){return["RGB",1-Math.min(1,m+n),1-Math.min(1,e+n),1-Math.min(1,l+n)]}static CMYK_rgb([m,l,e,n]){return[F(1-Math.min(1,m+n)),F(1-Math.min(1,e+n)),F(1-Math.min(1,l+n))]}static CMYK_HTML(m){const l=this.CMYK_RGB(m).slice(1);return this.RGB_HTML(l)}static RGB_CMYK([m,l,e]){const n=1-m,a=1-l,i=1-e,h=Math.min(n,a,i);return["CMYK",n,a,i,h]}}var T=V(284);const A=1e3,o=9,d=new WeakSet;function u(Z){return{width:Z[2]-Z[0],height:Z[3]-Z[1]}}class b{static create(m){switch(m.data.annotationType){case y.AnnotationType.LINK:return new g(m);case y.AnnotationType.TEXT:return new t(m);case y.AnnotationType.WIDGET:switch(m.data.fieldType){case"Tx":return new c(m);case"Btn":return m.data.radioButton?new S(m):m.data.checkBox?new v(m):new M(m);case"Ch":return new I(m);case"Sig":return new f(m)}return new r(m);case y.AnnotationType.POPUP:return new O(m);case y.AnnotationType.FREETEXT:return new B(m);case y.AnnotationType.LINE:return new q(m);case y.AnnotationType.SQUARE:return new st(m);case y.AnnotationType.CIRCLE:return new X(m);case y.AnnotationType.POLYLINE:return new H(m);case y.AnnotationType.CARET:return new Y(m);case y.AnnotationType.INK:return new Q(m);case y.AnnotationType.POLYGON:return new G(m);case y.AnnotationType.HIGHLIGHT:return new K(m);case y.AnnotationType.UNDERLINE:return new at(m);case y.AnnotationType.SQUIGGLY:return new ot(m);case y.AnnotationType.STRIKEOUT:return new lt(m);case y.AnnotationType.STAMP:return new ht(m);case y.AnnotationType.FILEATTACHMENT:return new ft(m);default:return new s(m)}}}class s{#t=!1;constructor(m,{isRenderable:l=!1,ignoreBorder:e=!1,createQuadrilaterals:n=!1}={}){this.isRenderable=l,this.data=m.data,this.layer=m.layer,this.linkService=m.linkService,this.downloadManager=m.downloadManager,this.imageResourcesPath=m.imageResourcesPath,this.renderForms=m.renderForms,this.svgFactory=m.svgFactory,this.annotationStorage=m.annotationStorage,this.enableScripting=m.enableScripting,this.hasJSActions=m.hasJSActions,this._fieldObjects=m.fieldObjects,this.parent=m.parent,l&&(this.container=this._createContainer(e)),n&&this._createQuadrilaterals()}static _hasPopupData({titleObj:m,contentsObj:l,richText:e}){return!!(m?.str||l?.str||e?.str)}get hasPopupData(){return s._hasPopupData(this.data)}_createContainer(m){const{data:l,parent:{page:e,viewport:n}}=this,a=document.createElement("section");a.setAttribute("data-annotation-id",l.id),this instanceof r||(a.tabIndex=A),a.style.zIndex=this.parent.zIndex++,l.popupRef&&a.setAttribute("aria-haspopup","dialog"),l.alternativeText&&(a.title=l.alternativeText),l.noRotate&&a.classList.add("norotate");const{pageWidth:i,pageHeight:h,pageX:p,pageY:w}=n.rawDims;if(!l.rect||this instanceof O){const{rotation:x}=l;return!l.hasOwnCanvas&&x!==0&&this.setRotation(x,a),a}const{width:E,height:R}=u(l.rect),P=y.Util.normalizeRect([l.rect[0],e.view[3]-l.rect[1]+e.view[1],l.rect[2],e.view[3]-l.rect[3]+e.view[1]]);if(!m&&l.borderStyle.width>0){a.style.borderWidth=`${l.borderStyle.width}px`;const x=l.borderStyle.horizontalCornerRadius,k=l.borderStyle.verticalCornerRadius;if(x>0||k>0){const j=`calc(${x}px * var(--scale-factor)) / calc(${k}px * var(--scale-factor))`;a.style.borderRadius=j}else if(this instanceof S){const j=`calc(${E}px * var(--scale-factor)) / calc(${R}px * var(--scale-factor))`;a.style.borderRadius=j}switch(l.borderStyle.style){case y.AnnotationBorderStyleType.SOLID:a.style.borderStyle="solid";break;case y.AnnotationBorderStyleType.DASHED:a.style.borderStyle="dashed";break;case y.AnnotationBorderStyleType.BEVELED:(0,y.warn)("Unimplemented border style: beveled");break;case y.AnnotationBorderStyleType.INSET:(0,y.warn)("Unimplemented border style: inset");break;case y.AnnotationBorderStyleType.UNDERLINE:a.style.borderBottomStyle="solid";break}const D=l.borderColor||null;D?(this.#t=!0,a.style.borderColor=y.Util.makeHexColor(D[0]|0,D[1]|0,D[2]|0)):a.style.borderWidth=0}a.style.left=`${100*(P[0]-p)/i}%`,a.style.top=`${100*(P[1]-w)/h}%`;const{rotation:L}=l;return l.hasOwnCanvas||L===0?(a.style.width=`${100*E/i}%`,a.style.height=`${100*R/h}%`):this.setRotation(L,a),a}setRotation(m,l=this.container){if(!this.data.rect)return;const{pageWidth:e,pageHeight:n}=this.parent.viewport.rawDims,{width:a,height:i}=u(this.data.rect);let h,p;m%180===0?(h=100*a/e,p=100*i/n):(h=100*i/e,p=100*a/n),l.style.width=`${h}%`,l.style.height=`${p}%`,l.setAttribute("data-main-rotation",(360-m)%360)}get _commonActions(){const m=(l,e,n)=>{const a=n.detail[l],i=a[0],h=a.slice(1);n.target.style[e]=C[`${i}_HTML`](h),this.annotationStorage.setValue(this.data.id,{[e]:C[`${i}_rgb`](h)})};return(0,y.shadow)(this,"_commonActions",{display:l=>{const{display:e}=l.detail,n=e%2===1;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:n,noPrint:e===1||e===2})},print:l=>{this.annotationStorage.setValue(this.data.id,{noPrint:!l.detail.print})},hidden:l=>{const{hidden:e}=l.detail;this.container.style.visibility=e?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:e,noView:e})},focus:l=>{setTimeout(()=>l.target.focus({preventScroll:!1}),0)},userName:l=>{l.target.title=l.detail.userName},readonly:l=>{l.target.disabled=l.detail.readonly},required:l=>{this._setRequired(l.target,l.detail.required)},bgColor:l=>{m("bgColor","backgroundColor",l)},fillColor:l=>{m("fillColor","backgroundColor",l)},fgColor:l=>{m("fgColor","color",l)},textColor:l=>{m("textColor","color",l)},borderColor:l=>{m("borderColor","borderColor",l)},strokeColor:l=>{m("strokeColor","borderColor",l)},rotation:l=>{const e=l.detail.rotation;this.setRotation(e),this.annotationStorage.setValue(this.data.id,{rotation:e})}})}_dispatchEventFromSandbox(m,l){const e=this._commonActions;for(const n of Object.keys(l.detail))(m[n]||e[n])?.(l)}_setDefaultPropertiesFromJS(m){if(!this.enableScripting)return;const l=this.annotationStorage.getRawValue(this.data.id);if(!l)return;const e=this._commonActions;for(const[n,a]of Object.entries(l)){const i=e[n];if(i){const h={detail:{[n]:a},target:m};i(h),delete l[n]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:m}=this.data;if(!m)return;const[l,e,n,a]=this.data.rect;if(m.length===1){const[,{x:k,y:D},{x:j,y:J}]=m[0];if(n===k&&a===D&&l===j&&e===J)return}const{style:i}=this.container;let h;if(this.#t){const{borderColor:k,borderWidth:D}=i;i.borderWidth=0,h=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${k}" stroke-width="${D}">`],this.container.classList.add("hasBorder")}const p=n-l,w=a-e,{svgFactory:E}=this,R=E.createElement("svg");R.classList.add("quadrilateralsContainer"),R.setAttribute("width",0),R.setAttribute("height",0);const P=E.createElement("defs");R.append(P);const L=E.createElement("clipPath"),x=`clippath_${this.data.id}`;L.setAttribute("id",x),L.setAttribute("clipPathUnits","objectBoundingBox"),P.append(L);for(const[,{x:k,y:D},{x:j,y:J}]of m){const $=E.createElement("rect"),tt=(j-l)/p,it=(a-D)/w,W=(k-j)/p,rt=(D-J)/w;$.setAttribute("x",tt),$.setAttribute("y",it),$.setAttribute("width",W),$.setAttribute("height",rt),L.append($),h?.push(`<rect vector-effect="non-scaling-stroke" x="${tt}" y="${it}" width="${W}" height="${rt}"/>`)}this.#t&&(h.push("</g></svg>')"),i.backgroundImage=h.join("")),this.container.append(R),this.container.style.clipPath=`url(#${x})`}_createPopup(){const{container:m,data:l}=this;m.setAttribute("aria-haspopup","dialog");const e=new O({data:{color:l.color,titleObj:l.titleObj,modificationDate:l.modificationDate,contentsObj:l.contentsObj,richText:l.richText,parentRect:l.rect,borderStyle:0,id:`popup_${l.id}`,rotation:l.rotation},parent:this.parent,elements:[this]});this.parent.div.append(e.render())}render(){(0,y.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(m,l=null){const e=[];if(this._fieldObjects){const n=this._fieldObjects[m];if(n)for(const{page:a,id:i,exportValues:h}of n){if(a===-1||i===l)continue;const p=typeof h=="string"?h:null,w=document.querySelector(`[data-element-id="${i}"]`);if(w&&!d.has(w)){(0,y.warn)(`_getElementsByName - element not allowed: ${i}`);continue}e.push({id:i,exportValue:p,domElement:w})}return e}for(const n of document.getElementsByName(m)){const{exportValue:a}=n,i=n.getAttribute("data-element-id");i!==l&&d.has(n)&&e.push({id:i,exportValue:a,domElement:n})}return e}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const m=this.getElementsToTriggerPopup();if(Array.isArray(m))for(const l of m)l.classList.add("highlightArea");else m.classList.add("highlightArea")}get _isEditable(){return!1}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:m,data:{id:l}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:m,editId:l})})}}class g extends s{constructor(m,l=null){super(m,{isRenderable:!0,ignoreBorder:!!l?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=m.data.isTooltipOnly}render(){const{data:m,linkService:l}=this,e=document.createElement("a");e.setAttribute("data-element-id",m.id);let n=!1;return m.url?(l.addLinkAttributes(e,m.url,m.newWindow),n=!0):m.action?(this._bindNamedAction(e,m.action),n=!0):m.attachment?(this.#e(e,m.attachment,m.attachmentDest),n=!0):m.setOCGState?(this.#s(e,m.setOCGState),n=!0):m.dest?(this._bindLink(e,m.dest),n=!0):(m.actions&&(m.actions.Action||m.actions["Mouse Up"]||m.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(e,m),n=!0),m.resetForm?(this._bindResetFormAction(e,m.resetForm),n=!0):this.isTooltipOnly&&!n&&(this._bindLink(e,""),n=!0)),this.container.classList.add("linkAnnotation"),n&&this.container.append(e),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(m,l){m.href=this.linkService.getDestinationHash(l),m.onclick=()=>(l&&this.linkService.goToDestination(l),!1),(l||l==="")&&this.#t()}_bindNamedAction(m,l){m.href=this.linkService.getAnchorUrl(""),m.onclick=()=>(this.linkService.executeNamedAction(l),!1),this.#t()}#e(m,l,e=null){m.href=this.linkService.getAnchorUrl(""),m.onclick=()=>(this.downloadManager?.openOrDownloadData(l.content,l.filename,e),!1),this.#t()}#s(m,l){m.href=this.linkService.getAnchorUrl(""),m.onclick=()=>(this.linkService.executeSetOCGState(l),!1),this.#t()}_bindJSAction(m,l){m.href=this.linkService.getAnchorUrl("");const e=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const n of Object.keys(l.actions)){const a=e.get(n);a&&(m[a]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:l.id,name:n}}),!1))}m.onclick||(m.onclick=()=>!1),this.#t()}_bindResetFormAction(m,l){const e=m.onclick;if(e||(m.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){(0,y.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),e||(m.onclick=()=>!1);return}m.onclick=()=>{e?.();const{fields:n,refs:a,include:i}=l,h=[];if(n.length!==0||a.length!==0){const E=new Set(a);for(const R of n){const P=this._fieldObjects[R]||[];for(const{id:L}of P)E.add(L)}for(const R of Object.values(this._fieldObjects))for(const P of R)E.has(P.id)===i&&h.push(P)}else for(const E of Object.values(this._fieldObjects))h.push(...E);const p=this.annotationStorage,w=[];for(const E of h){const{id:R}=E;switch(w.push(R),E.type){case"text":{const L=E.defaultValue||"";p.setValue(R,{value:L});break}case"checkbox":case"radiobutton":{const L=E.defaultValue===E.exportValues;p.setValue(R,{value:L});break}case"combobox":case"listbox":{const L=E.defaultValue||"";p.setValue(R,{value:L});break}default:continue}const P=document.querySelector(`[data-element-id="${R}"]`);if(P){if(!d.has(P)){(0,y.warn)(`_bindResetFormAction - element not allowed: ${R}`);continue}}else continue;P.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:w,name:"ResetForm"}}),!1}}}class t extends s{constructor(m){super(m,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const m=document.createElement("img");return m.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",m.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),m.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(m),this.container}}class r extends s{render(){return this.container}showElementAndHideCanvas(m){this.data.hasOwnCanvas&&(m.previousSibling?.nodeName==="CANVAS"&&(m.previousSibling.hidden=!0),m.hidden=!1)}_getKeyModifier(m){return y.FeatureTest.platform.isMac?m.metaKey:m.ctrlKey}_setEventListener(m,l,e,n,a){e.includes("mouse")?m.addEventListener(e,i=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:a(i),shift:i.shiftKey,modifier:this._getKeyModifier(i)}})}):m.addEventListener(e,i=>{if(e==="blur"){if(!l.focused||!i.relatedTarget)return;l.focused=!1}else if(e==="focus"){if(l.focused)return;l.focused=!0}a&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:a(i)}})})}_setEventListeners(m,l,e,n){for(const[a,i]of e)(i==="Action"||this.data.actions?.[i])&&((i==="Focus"||i==="Blur")&&(l||={focused:!1}),this._setEventListener(m,l,a,i,n),i==="Focus"&&!this.data.actions?.Blur?this._setEventListener(m,l,"blur","Blur",null):i==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(m,l,"focus","Focus",null))}_setBackgroundColor(m){const l=this.data.backgroundColor||null;m.style.backgroundColor=l===null?"transparent":y.Util.makeHexColor(l[0],l[1],l[2])}_setTextStyle(m){const l=["left","center","right"],{fontColor:e}=this.data.defaultAppearanceData,n=this.data.defaultAppearanceData.fontSize||o,a=m.style;let i;const h=2,p=w=>Math.round(10*w)/10;if(this.data.multiLine){const w=Math.abs(this.data.rect[3]-this.data.rect[1]-h),E=Math.round(w/(y.LINE_FACTOR*n))||1,R=w/E;i=Math.min(n,p(R/y.LINE_FACTOR))}else{const w=Math.abs(this.data.rect[3]-this.data.rect[1]-h);i=Math.min(n,p(w/y.LINE_FACTOR))}a.fontSize=`calc(${i}px * var(--scale-factor))`,a.color=y.Util.makeHexColor(e[0],e[1],e[2]),this.data.textAlignment!==null&&(a.textAlign=l[this.data.textAlignment])}_setRequired(m,l){l?m.setAttribute("required",!0):m.removeAttribute("required"),m.setAttribute("aria-required",l)}}class c extends r{constructor(m){const l=m.renderForms||m.data.hasOwnCanvas||!m.data.hasAppearance&&!!m.data.fieldValue;super(m,{isRenderable:l})}setPropertyOnSiblings(m,l,e,n){const a=this.annotationStorage;for(const i of this._getElementsByName(m.name,m.id))i.domElement&&(i.domElement[l]=e),a.setValue(i.id,{[n]:e})}render(){const m=this.annotationStorage,l=this.data.id;this.container.classList.add("textWidgetAnnotation");let e=null;if(this.renderForms){const n=m.getValue(l,{value:this.data.fieldValue});let a=n.value||"";const i=m.getValue(l,{charLimit:this.data.maxLen}).charLimit;i&&a.length>i&&(a=a.slice(0,i));let h=n.formattedValue||this.data.textContent?.join(`
`)||null;h&&this.data.comb&&(h=h.replaceAll(/\s+/g,""));const p={userValue:a,formattedValue:h,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(e=document.createElement("textarea"),e.textContent=h??a,this.data.doNotScroll&&(e.style.overflowY="hidden")):(e=document.createElement("input"),e.type="text",e.setAttribute("value",h??a),this.data.doNotScroll&&(e.style.overflowX="hidden")),this.data.hasOwnCanvas&&(e.hidden=!0),d.add(e),e.setAttribute("data-element-id",l),e.disabled=this.data.readOnly,e.name=this.data.fieldName,e.tabIndex=A,this._setRequired(e,this.data.required),i&&(e.maxLength=i),e.addEventListener("input",E=>{m.setValue(l,{value:E.target.value}),this.setPropertyOnSiblings(e,"value",E.target.value,"value"),p.formattedValue=null}),e.addEventListener("resetform",E=>{const R=this.data.defaultFieldValue??"";e.value=p.userValue=R,p.formattedValue=null});let w=E=>{const{formattedValue:R}=p;R!=null&&(E.target.value=R),E.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){e.addEventListener("focus",R=>{if(p.focused)return;const{target:P}=R;p.userValue&&(P.value=p.userValue),p.lastCommittedValue=P.value,p.commitKey=1,this.data.actions?.Focus||(p.focused=!0)}),e.addEventListener("updatefromsandbox",R=>{this.showElementAndHideCanvas(R.target);const P={value(L){p.userValue=L.detail.value??"",m.setValue(l,{value:p.userValue.toString()}),L.target.value=p.userValue},formattedValue(L){const{formattedValue:x}=L.detail;p.formattedValue=x,x!=null&&L.target!==document.activeElement&&(L.target.value=x),m.setValue(l,{formattedValue:x})},selRange(L){L.target.setSelectionRange(...L.detail.selRange)},charLimit:L=>{const{charLimit:x}=L.detail,{target:k}=L;if(x===0){k.removeAttribute("maxLength");return}k.setAttribute("maxLength",x);let D=p.userValue;!D||D.length<=x||(D=D.slice(0,x),k.value=p.userValue=D,m.setValue(l,{value:D}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:l,name:"Keystroke",value:D,willCommit:!0,commitKey:1,selStart:k.selectionStart,selEnd:k.selectionEnd}}))}};this._dispatchEventFromSandbox(P,R)}),e.addEventListener("keydown",R=>{p.commitKey=1;let P=-1;if(R.key==="Escape"?P=0:R.key==="Enter"&&!this.data.multiLine?P=2:R.key==="Tab"&&(p.commitKey=3),P===-1)return;const{value:L}=R.target;p.lastCommittedValue!==L&&(p.lastCommittedValue=L,p.userValue=L,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:l,name:"Keystroke",value:L,willCommit:!0,commitKey:P,selStart:R.target.selectionStart,selEnd:R.target.selectionEnd}}))});const E=w;w=null,e.addEventListener("blur",R=>{if(!p.focused||!R.relatedTarget)return;this.data.actions?.Blur||(p.focused=!1);const{value:P}=R.target;p.userValue=P,p.lastCommittedValue!==P&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:l,name:"Keystroke",value:P,willCommit:!0,commitKey:p.commitKey,selStart:R.target.selectionStart,selEnd:R.target.selectionEnd}}),E(R)}),this.data.actions?.Keystroke&&e.addEventListener("beforeinput",R=>{p.lastCommittedValue=null;const{data:P,target:L}=R,{value:x,selectionStart:k,selectionEnd:D}=L;let j=k,J=D;switch(R.inputType){case"deleteWordBackward":{const $=x.substring(0,k).match(/\w*[^\w]*$/);$&&(j-=$[0].length);break}case"deleteWordForward":{const $=x.substring(k).match(/^[^\w]*\w*/);$&&(J+=$[0].length);break}case"deleteContentBackward":k===D&&(j-=1);break;case"deleteContentForward":k===D&&(J+=1);break}R.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:l,name:"Keystroke",value:x,change:P||"",willCommit:!1,selStart:j,selEnd:J}})}),this._setEventListeners(e,p,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],R=>R.target.value)}if(w&&e.addEventListener("blur",w),this.data.comb){const R=(this.data.rect[2]-this.data.rect[0])/i;e.classList.add("comb"),e.style.letterSpacing=`calc(${R}px * var(--scale-factor) - 1ch)`}}else e=document.createElement("div"),e.textContent=this.data.fieldValue,e.style.verticalAlign="middle",e.style.display="table-cell",this.data.hasOwnCanvas&&(e.hidden=!0);return this._setTextStyle(e),this._setBackgroundColor(e),this._setDefaultPropertiesFromJS(e),this.container.append(e),this.container}}class f extends r{constructor(m){super(m,{isRenderable:!!m.data.hasOwnCanvas})}}class v extends r{constructor(m){super(m,{isRenderable:m.renderForms})}render(){const m=this.annotationStorage,l=this.data,e=l.id;let n=m.getValue(e,{value:l.exportValue===l.fieldValue}).value;typeof n=="string"&&(n=n!=="Off",m.setValue(e,{value:n})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const a=document.createElement("input");return d.add(a),a.setAttribute("data-element-id",e),a.disabled=l.readOnly,this._setRequired(a,this.data.required),a.type="checkbox",a.name=l.fieldName,n&&a.setAttribute("checked",!0),a.setAttribute("exportValue",l.exportValue),a.tabIndex=A,a.addEventListener("change",i=>{const{name:h,checked:p}=i.target;for(const w of this._getElementsByName(h,e)){const E=p&&w.exportValue===l.exportValue;w.domElement&&(w.domElement.checked=E),m.setValue(w.id,{value:E})}m.setValue(e,{value:p})}),a.addEventListener("resetform",i=>{const h=l.defaultFieldValue||"Off";i.target.checked=h===l.exportValue}),this.enableScripting&&this.hasJSActions&&(a.addEventListener("updatefromsandbox",i=>{const h={value(p){p.target.checked=p.detail.value!=="Off",m.setValue(e,{value:p.target.checked})}};this._dispatchEventFromSandbox(h,i)}),this._setEventListeners(a,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],i=>i.target.checked)),this._setBackgroundColor(a),this._setDefaultPropertiesFromJS(a),this.container.append(a),this.container}}class S extends r{constructor(m){super(m,{isRenderable:m.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const m=this.annotationStorage,l=this.data,e=l.id;let n=m.getValue(e,{value:l.fieldValue===l.buttonValue}).value;if(typeof n=="string"&&(n=n!==l.buttonValue,m.setValue(e,{value:n})),n)for(const i of this._getElementsByName(l.fieldName,e))m.setValue(i.id,{value:!1});const a=document.createElement("input");if(d.add(a),a.setAttribute("data-element-id",e),a.disabled=l.readOnly,this._setRequired(a,this.data.required),a.type="radio",a.name=l.fieldName,n&&a.setAttribute("checked",!0),a.tabIndex=A,a.addEventListener("change",i=>{const{name:h,checked:p}=i.target;for(const w of this._getElementsByName(h,e))m.setValue(w.id,{value:!1});m.setValue(e,{value:p})}),a.addEventListener("resetform",i=>{const h=l.defaultFieldValue;i.target.checked=h!=null&&h===l.buttonValue}),this.enableScripting&&this.hasJSActions){const i=l.buttonValue;a.addEventListener("updatefromsandbox",h=>{const p={value:w=>{const E=i===w.detail.value;for(const R of this._getElementsByName(w.target.name)){const P=E&&R.id===e;R.domElement&&(R.domElement.checked=P),m.setValue(R.id,{value:P})}}};this._dispatchEventFromSandbox(p,h)}),this._setEventListeners(a,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],h=>h.target.checked)}return this._setBackgroundColor(a),this._setDefaultPropertiesFromJS(a),this.container.append(a),this.container}}class M extends g{constructor(m){super(m,{ignoreBorder:m.data.hasAppearance})}render(){const m=super.render();m.classList.add("buttonWidgetAnnotation","pushButton");const l=m.lastChild;return this.enableScripting&&this.hasJSActions&&l&&(this._setDefaultPropertiesFromJS(l),l.addEventListener("updatefromsandbox",e=>{this._dispatchEventFromSandbox({},e)})),m}}class I extends r{constructor(m){super(m,{isRenderable:m.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const m=this.annotationStorage,l=this.data.id,e=m.getValue(l,{value:this.data.fieldValue}),n=document.createElement("select");d.add(n),n.setAttribute("data-element-id",l),n.disabled=this.data.readOnly,this._setRequired(n,this.data.required),n.name=this.data.fieldName,n.tabIndex=A;let a=this.data.combo&&this.data.options.length>0;this.data.combo||(n.size=this.data.options.length,this.data.multiSelect&&(n.multiple=!0)),n.addEventListener("resetform",E=>{const R=this.data.defaultFieldValue;for(const P of n.options)P.selected=P.value===R});for(const E of this.data.options){const R=document.createElement("option");R.textContent=E.displayValue,R.value=E.exportValue,e.value.includes(E.exportValue)&&(R.setAttribute("selected",!0),a=!1),n.append(R)}let i=null;if(a){const E=document.createElement("option");E.value=" ",E.setAttribute("hidden",!0),E.setAttribute("selected",!0),n.prepend(E),i=()=>{E.remove(),n.removeEventListener("input",i),i=null},n.addEventListener("input",i)}const h=E=>{const R=E?"value":"textContent",{options:P,multiple:L}=n;return L?Array.prototype.filter.call(P,x=>x.selected).map(x=>x[R]):P.selectedIndex===-1?null:P[P.selectedIndex][R]};let p=h(!1);const w=E=>{const R=E.target.options;return Array.prototype.map.call(R,P=>({displayValue:P.textContent,exportValue:P.value}))};return this.enableScripting&&this.hasJSActions?(n.addEventListener("updatefromsandbox",E=>{const R={value(P){i?.();const L=P.detail.value,x=new Set(Array.isArray(L)?L:[L]);for(const k of n.options)k.selected=x.has(k.value);m.setValue(l,{value:h(!0)}),p=h(!1)},multipleSelection(P){n.multiple=!0},remove(P){const L=n.options,x=P.detail.remove;L[x].selected=!1,n.remove(x),L.length>0&&Array.prototype.findIndex.call(L,D=>D.selected)===-1&&(L[0].selected=!0),m.setValue(l,{value:h(!0),items:w(P)}),p=h(!1)},clear(P){for(;n.length!==0;)n.remove(0);m.setValue(l,{value:null,items:[]}),p=h(!1)},insert(P){const{index:L,displayValue:x,exportValue:k}=P.detail.insert,D=n.children[L],j=document.createElement("option");j.textContent=x,j.value=k,D?D.before(j):n.append(j),m.setValue(l,{value:h(!0),items:w(P)}),p=h(!1)},items(P){const{items:L}=P.detail;for(;n.length!==0;)n.remove(0);for(const x of L){const{displayValue:k,exportValue:D}=x,j=document.createElement("option");j.textContent=k,j.value=D,n.append(j)}n.options.length>0&&(n.options[0].selected=!0),m.setValue(l,{value:h(!0),items:w(P)}),p=h(!1)},indices(P){const L=new Set(P.detail.indices);for(const x of P.target.options)x.selected=L.has(x.index);m.setValue(l,{value:h(!0)}),p=h(!1)},editable(P){P.target.disabled=!P.detail.editable}};this._dispatchEventFromSandbox(R,E)}),n.addEventListener("input",E=>{const R=h(!0);m.setValue(l,{value:R}),E.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:l,name:"Keystroke",value:p,changeEx:R,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(n,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],E=>E.target.value)):n.addEventListener("input",function(E){m.setValue(l,{value:h(!0)})}),this.data.combo&&this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class O extends s{constructor(m){const{data:l,elements:e}=m;super(m,{isRenderable:s._hasPopupData(l)}),this.elements=e}render(){this.container.classList.add("popupAnnotation");const m=new N({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),l=[];for(const e of this.elements)e.popup=m,l.push(e.data.id),e.addHighlightArea();return this.container.setAttribute("aria-controls",l.map(e=>`${y.AnnotationPrefix}${e}`).join(",")),this.container}}class N{#t=this.#b.bind(this);#e=this.#E.bind(this);#s=this.#w.bind(this);#n=this.#A.bind(this);#r=null;#i=null;#a=null;#l=null;#h=null;#d=null;#u=null;#c=!1;#o=null;#p=null;#g=null;#f=null;#m=!1;constructor({container:m,color:l,elements:e,titleObj:n,modificationDate:a,contentsObj:i,richText:h,parent:p,rect:w,parentRect:E,open:R}){this.#i=m,this.#f=n,this.#a=i,this.#g=h,this.#d=p,this.#r=l,this.#p=w,this.#u=E,this.#h=e,this.#l=z.PDFDateString.toDateObject(a),this.trigger=e.flatMap(P=>P.getElementsToTriggerPopup());for(const P of this.trigger)P.addEventListener("click",this.#n),P.addEventListener("mouseenter",this.#s),P.addEventListener("mouseleave",this.#e),P.classList.add("popupTriggerArea");for(const P of e)P.container?.addEventListener("keydown",this.#t);this.#i.hidden=!0,R&&this.#A()}render(){if(this.#o)return;const{page:{view:m},viewport:{rawDims:{pageWidth:l,pageHeight:e,pageX:n,pageY:a}}}=this.#d,i=this.#o=document.createElement("div");if(i.className="popup",this.#r){const $=i.style.outlineColor=y.Util.makeHexColor(...this.#r);CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?i.style.backgroundColor=`color-mix(in srgb, ${$} 30%, white)`:i.style.backgroundColor=y.Util.makeHexColor(...this.#r.map(it=>Math.floor(.7*(255-it)+it)))}const h=document.createElement("span");h.className="header";const p=document.createElement("h1");if(h.append(p),{dir:p.dir,str:p.textContent}=this.#f,i.append(h),this.#l){const $=document.createElement("span");$.classList.add("popupDate"),$.setAttribute("data-l10n-id","pdfjs-annotation-date-string"),$.setAttribute("data-l10n-args",JSON.stringify({date:this.#l.toLocaleDateString(),time:this.#l.toLocaleTimeString()})),h.append($)}const w=this.#a,E=this.#g;if(E?.str&&(!w?.str||w.str===E.str))T.XfaLayer.render({xfaHtml:E.html,intent:"richText",div:i}),i.lastChild.classList.add("richText","popupContent");else{const $=this._formatContents(w);i.append($)}let R=!!this.#u,P=R?this.#u:this.#p;for(const $ of this.#h)if(!P||y.Util.intersect($.data.rect,P)!==null){P=$.data.rect,R=!0;break}const L=y.Util.normalizeRect([P[0],m[3]-P[1]+m[1],P[2],m[3]-P[3]+m[1]]),x=5,k=R?P[2]-P[0]+x:0,D=L[0]+k,j=L[1],{style:J}=this.#i;J.left=`${100*(D-n)/l}%`,J.top=`${100*(j-a)/e}%`,this.#i.append(i)}_formatContents({str:m,dir:l}){const e=document.createElement("p");e.classList.add("popupContent"),e.dir=l;const n=m.split(/(?:\r\n?|\n)/);for(let a=0,i=n.length;a<i;++a){const h=n[a];e.append(document.createTextNode(h)),a<i-1&&e.append(document.createElement("br"))}return e}#b(m){m.altKey||m.shiftKey||m.ctrlKey||m.metaKey||(m.key==="Enter"||m.key==="Escape"&&this.#c)&&this.#A()}#A(){this.#c=!this.#c,this.#c?(this.#w(),this.#i.addEventListener("click",this.#n),this.#i.addEventListener("keydown",this.#t)):(this.#E(),this.#i.removeEventListener("click",this.#n),this.#i.removeEventListener("keydown",this.#t))}#w(){this.#o||this.render(),this.isVisible?this.#c&&this.#i.classList.add("focused"):(this.#i.hidden=!1,this.#i.style.zIndex=parseInt(this.#i.style.zIndex)+1e3)}#E(){this.#i.classList.remove("focused"),!(this.#c||!this.isVisible)&&(this.#i.hidden=!0,this.#i.style.zIndex=parseInt(this.#i.style.zIndex)-1e3)}forceHide(){this.#m=this.isVisible,this.#m&&(this.#i.hidden=!0)}maybeShow(){this.#m&&(this.#m=!1,this.#i.hidden=!1)}get isVisible(){return this.#i.hidden===!1}}class B extends s{constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0}),this.textContent=m.data.textContent,this.textPosition=m.data.textPosition,this.annotationEditorType=y.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const m=document.createElement("div");m.classList.add("annotationTextContent"),m.setAttribute("role","comment");for(const l of this.textContent){const e=document.createElement("span");e.textContent=l,m.append(e)}this.container.append(m)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}get _isEditable(){return this.data.hasOwnCanvas}}class q extends s{#t=null;constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const m=this.data,{width:l,height:e}=u(m.rect),n=this.svgFactory.create(l,e,!0),a=this.#t=this.svgFactory.createElement("svg:line");return a.setAttribute("x1",m.rect[2]-m.lineCoordinates[0]),a.setAttribute("y1",m.rect[3]-m.lineCoordinates[1]),a.setAttribute("x2",m.rect[2]-m.lineCoordinates[2]),a.setAttribute("y2",m.rect[3]-m.lineCoordinates[3]),a.setAttribute("stroke-width",m.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),n.append(a),this.container.append(n),!m.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class st extends s{#t=null;constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const m=this.data,{width:l,height:e}=u(m.rect),n=this.svgFactory.create(l,e,!0),a=m.borderStyle.width,i=this.#t=this.svgFactory.createElement("svg:rect");return i.setAttribute("x",a/2),i.setAttribute("y",a/2),i.setAttribute("width",l-a),i.setAttribute("height",e-a),i.setAttribute("stroke-width",a||1),i.setAttribute("stroke","transparent"),i.setAttribute("fill","transparent"),n.append(i),this.container.append(n),!m.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class X extends s{#t=null;constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const m=this.data,{width:l,height:e}=u(m.rect),n=this.svgFactory.create(l,e,!0),a=m.borderStyle.width,i=this.#t=this.svgFactory.createElement("svg:ellipse");return i.setAttribute("cx",l/2),i.setAttribute("cy",e/2),i.setAttribute("rx",l/2-a/2),i.setAttribute("ry",e/2-a/2),i.setAttribute("stroke-width",a||1),i.setAttribute("stroke","transparent"),i.setAttribute("fill","transparent"),n.append(i),this.container.append(n),!m.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class H extends s{#t=null;constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const m=this.data,{width:l,height:e}=u(m.rect),n=this.svgFactory.create(l,e,!0);let a=[];for(const h of m.vertices){const p=h.x-m.rect[0],w=m.rect[3]-h.y;a.push(p+","+w)}a=a.join(" ");const i=this.#t=this.svgFactory.createElement(this.svgElementName);return i.setAttribute("points",a),i.setAttribute("stroke-width",m.borderStyle.width||1),i.setAttribute("stroke","transparent"),i.setAttribute("fill","transparent"),n.append(i),this.container.append(n),!m.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class G extends H{constructor(m){super(m),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Y extends s{constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class Q extends s{#t=[];constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=y.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const m=this.data,{width:l,height:e}=u(m.rect),n=this.svgFactory.create(l,e,!0);for(const a of m.inkLists){let i=[];for(const p of a){const w=p.x-m.rect[0],E=m.rect[3]-p.y;i.push(`${w},${E}`)}i=i.join(" ");const h=this.svgFactory.createElement(this.svgElementName);this.#t.push(h),h.setAttribute("points",i),h.setAttribute("stroke-width",m.borderStyle.width||1),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),!m.popupRef&&this.hasPopupData&&this._createPopup(),n.append(h)}return this.container.append(n),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class K extends s{constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class at extends s{constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class ot extends s{constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class lt extends s{constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class ht extends s{constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class ft extends s{#t=null;constructor(m){super(m,{isRenderable:!0});const{filename:l,content:e}=this.data.file;this.filename=(0,z.getFilenameFromUrl)(l,!0),this.content=e,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,filename:l,content:e})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:m,data:l}=this;let e;l.hasAppearance||l.fillAlpha===0?e=document.createElement("div"):(e=document.createElement("img"),e.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(l.name)?"paperclip":"pushpin"}.svg`,l.fillAlpha&&l.fillAlpha<1&&(e.style=`filter: opacity(${Math.round(l.fillAlpha*100)}%);`)),e.addEventListener("dblclick",this.#e.bind(this)),this.#t=e;const{isMac:n}=y.FeatureTest.platform;return m.addEventListener("keydown",a=>{a.key==="Enter"&&(n?a.metaKey:a.ctrlKey)&&this.#e()}),!l.popupRef&&this.hasPopupData?this._createPopup():e.classList.add("popupTriggerArea"),m.append(e),m}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class ct{#t=null;#e=null;#s=new Map;constructor({div:m,accessibilityManager:l,annotationCanvasMap:e,page:n,viewport:a}){this.div=m,this.#t=l,this.#e=e,this.page=n,this.viewport=a,this.zIndex=0}#n(m,l){const e=m.firstChild||m;e.id=`${y.AnnotationPrefix}${l}`,this.div.append(m),this.#t?.moveElementInDOM(this.div,m,e,!1)}async render(m){const{annotations:l}=m,e=this.div;(0,z.setLayerDimensions)(e,this.viewport);const n=new Map,a={data:null,layer:e,linkService:m.linkService,downloadManager:m.downloadManager,imageResourcesPath:m.imageResourcesPath||"",renderForms:m.renderForms!==!1,svgFactory:new z.DOMSVGFactory,annotationStorage:m.annotationStorage||new _.AnnotationStorage,enableScripting:m.enableScripting===!0,hasJSActions:m.hasJSActions,fieldObjects:m.fieldObjects,parent:this,elements:null};for(const i of l){if(i.noHTML)continue;const h=i.annotationType===y.AnnotationType.POPUP;if(h){const E=n.get(i.id);if(!E)continue;a.elements=E}else{const{width:E,height:R}=u(i.rect);if(E<=0||R<=0)continue}a.data=i;const p=b.create(a);if(!p.isRenderable)continue;if(!h&&i.popupRef){const E=n.get(i.popupRef);E?E.push(p):n.set(i.popupRef,[p])}p.annotationEditorType>0&&this.#s.set(p.data.id,p);const w=p.render();i.hidden&&(w.style.visibility="hidden"),this.#n(w,i.id)}this.#r()}update({viewport:m}){const l=this.div;this.viewport=m,(0,z.setLayerDimensions)(l,{rotation:m.rotation}),this.#r(),l.hidden=!1}#r(){if(!this.#e)return;const m=this.div;for(const[l,e]of this.#e){const n=m.querySelector(`[data-annotation-id="${l}"]`);if(!n)continue;const{firstChild:a}=n;a?a.nodeName==="CANVAS"?a.replaceWith(e):a.before(e):n.append(e)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#s.values())}getEditableAnnotation(m){return this.#s.get(m)}}},792:(dt,et,V)=>{V.d(et,{AnnotationStorage:()=>F,PrintAnnotationStorage:()=>C,SerializableEmpty:()=>U});var y=V(292),z=V(310),_=V(651);const U=Object.freeze({map:null,hash:"",transfer:void 0});class F{#t=!1;#e=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(A,o){const d=this.#e.get(A);return d===void 0?o:Object.assign(o,d)}getRawValue(A){return this.#e.get(A)}remove(A){if(this.#e.delete(A),this.#e.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const o of this.#e.values())if(o instanceof z.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(A,o){const d=this.#e.get(A);let u=!1;if(d!==void 0)for(const[b,s]of Object.entries(o))d[b]!==s&&(u=!0,d[b]=s);else u=!0,this.#e.set(A,o);u&&this.#s(),o instanceof z.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(o.constructor._type)}has(A){return this.#e.has(A)}getAll(){return this.#e.size>0?(0,y.objectFromMap)(this.#e):null}setAll(A){for(const[o,d]of Object.entries(A))this.setValue(o,d)}get size(){return this.#e.size}#s(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new C(this)}get serializable(){if(this.#e.size===0)return U;const A=new Map,o=new _.MurmurHash3_64,d=[],u=Object.create(null);let b=!1;for(const[s,g]of this.#e){const t=g instanceof z.AnnotationEditor?g.serialize(!1,u):g;t&&(A.set(s,t),o.update(`${s}:${JSON.stringify(t)}`),b||=!!t.bitmap)}if(b)for(const s of A.values())s.bitmap&&d.push(s.bitmap);return A.size>0?{map:A,hash:o.hexdigest(),transfer:d}:U}get editorStats(){let A=null;const o=new Map;for(const d of this.#e.values()){if(!(d instanceof z.AnnotationEditor))continue;const u=d.telemetryFinalData;if(!u)continue;const{type:b}=u;o.has(b)||o.set(b,Object.getPrototypeOf(d).constructor),A||=Object.create(null);const s=A[b]||=new Map;for(const[g,t]of Object.entries(u)){if(g==="type")continue;let r=s.get(g);r||(r=new Map,s.set(g,r));const c=r.get(t)??0;r.set(t,c+1)}}for(const[d,u]of o)A[d]=u.computeTelemetryFinalData(A[d]);return A}}class C extends F{#t;constructor(A){super();const{map:o,hash:d,transfer:u}=A.serializable,b=structuredClone(o,u?{transfer:u}:null);this.#t={map:b,hash:d,transfer:u}}get print(){(0,y.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}}},831:(dt,et,V)=>{V.a(dt,async(y,z)=>{try{let st=function(a){if(typeof a=="string"||a instanceof URL?a={url:a}:(a instanceof ArrayBuffer||ArrayBuffer.isView(a))&&(a={data:a}),typeof a!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!a.url&&!a.data&&!a.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const i=new Y,{docId:h}=i,p=a.url?H(a.url):null,w=a.data?G(a.data):null,E=a.httpHeaders||null,R=a.withCredentials===!0,P=a.password??null,L=a.range instanceof Q?a.range:null,x=Number.isInteger(a.rangeChunkSize)&&a.rangeChunkSize>0?a.rangeChunkSize:S;let k=a.worker instanceof ht?a.worker:null;const D=a.verbosity,j=typeof a.docBaseUrl=="string"&&!(0,F.isDataScheme)(a.docBaseUrl)?a.docBaseUrl:null,J=typeof a.cMapUrl=="string"?a.cMapUrl:null,$=a.cMapPacked!==!1,tt=a.CMapReaderFactory||N,it=typeof a.standardFontDataUrl=="string"?a.standardFontDataUrl:null,W=a.StandardFontDataFactory||q,rt=a.stopAtErrors!==!0,nt=Number.isInteger(a.maxImageSize)&&a.maxImageSize>-1?a.maxImageSize:-1,ut=a.isEvalSupported!==!1,gt=typeof a.isOffscreenCanvasSupported=="boolean"?a.isOffscreenCanvasSupported:!_.isNodeJS,mt=Number.isInteger(a.canvasMaxAreaInBytes)?a.canvasMaxAreaInBytes:-1,At=typeof a.disableFontFace=="boolean"?a.disableFontFace:_.isNodeJS,bt=a.fontExtraProperties===!0,Ct=a.enableXfa===!0,St=a.ownerDocument||globalThis.document,Tt=a.disableRange===!0,yt=a.disableStream===!0,xt=a.disableAutoFetch===!0,kt=a.pdfBug===!0,Pt=L?L.length:a.length??NaN,Nt=typeof a.useSystemFonts=="boolean"?a.useSystemFonts:!_.isNodeJS&&!At,Mt=typeof a.useWorkerFetch=="boolean"?a.useWorkerFetch:tt===F.DOMCMapReaderFactory&&W===F.DOMStandardFontDataFactory&&J&&it&&(0,F.isValidFetchUrl)(J,document.baseURI)&&(0,F.isValidFetchUrl)(it,document.baseURI),Ot=a.canvasFactory||new O({ownerDocument:St}),Et=a.filterFactory||new B({docId:h,ownerDocument:St}),wt=null;(0,_.setVerbosityLevel)(D);const It={canvasFactory:Ot,filterFactory:Et};if(Mt||(It.cMapReaderFactory=new tt({baseUrl:J,isCompressed:$}),It.standardFontDataFactory=new W({baseUrl:it})),!k){const vt={verbosity:D,port:d.GlobalWorkerOptions.workerPort};k=vt.port?ht.fromPort(vt):new ht(vt),i._worker=k}const Ht={docId:h,apiVersion:"4.1.392",data:w,password:P,disableAutoFetch:xt,rangeChunkSize:x,length:Pt,docBaseUrl:j,enableXfa:Ct,evaluatorOptions:{maxImageSize:nt,disableFontFace:At,ignoreErrors:rt,isEvalSupported:ut,isOffscreenCanvasSupported:gt,canvasMaxAreaInBytes:mt,fontExtraProperties:bt,useSystemFonts:Nt,cMapUrl:Mt?J:null,standardFontDataUrl:Mt?it:null}},_t={ignoreErrors:rt,isEvalSupported:ut,disableFontFace:At,fontExtraProperties:bt,enableXfa:Ct,ownerDocument:St,disableAutoFetch:xt,pdfBug:kt,styleElement:wt};return k.promise.then(function(){if(i.destroyed)throw new Error("Loading aborted");const vt=X(k,Ht),Ut=new Promise(function(Bt){let Dt;L?Dt=new g.PDFDataTransportStream(L,{disableRange:Tt,disableStream:yt}):w||(Dt=(Ft=>_.isNodeJS?function(){return typeof fetch<"u"&&typeof Response<"u"&&"body"in Response.prototype}()&&(0,F.isValidFetchUrl)(Ft.url)?new t.PDFFetchStream(Ft):new c.PDFNodeStream(Ft):(0,F.isValidFetchUrl)(Ft.url)?new t.PDFFetchStream(Ft):new r.PDFNetworkStream(Ft))({url:p,length:Pt,httpHeaders:E,withCredentials:R,rangeChunkSize:x,disableRange:Tt,disableStream:yt})),Bt(Dt)});return Promise.all([vt,Ut]).then(function([Bt,Dt]){if(i.destroyed)throw new Error("Loading aborted");const zt=new u.MessageHandler(h,Bt,k.port),Ft=new ft(zt,i,Dt,_t,It);i._transport=Ft,zt.send("Ready",null)})}).catch(i._capability.reject),i},H=function(a){if(a instanceof URL)return a.href;try{return new URL(a,window.location).href}catch{if(_.isNodeJS&&typeof a=="string")return a}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")},G=function(a){if(_.isNodeJS&&typeof Buffer<"u"&&a instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(a instanceof Uint8Array&&a.byteLength===a.buffer.byteLength)return a;if(typeof a=="string")return(0,_.stringToBytes)(a);if(a instanceof ArrayBuffer||ArrayBuffer.isView(a)||typeof a=="object"&&!isNaN(a?.length))return new Uint8Array(a);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")};V.d(et,{PDFDataRangeTransport:()=>Q,PDFWorker:()=>ht,build:()=>n,getDocument:()=>st,version:()=>e});var _=V(292),U=V(792),F=V(419),C=V(10),T=V(573),A=V(923),o=V(814),d=V(164),u=V(178),b=V(62),s=V(626),g=V(585),t=V(94),r=V(457),c=V(786),f=V(50),v=y([T,c]);[T,c]=v.then?(await v)():v;const S=65536,M=100,I=5e3,O=_.isNodeJS?T.NodeCanvasFactory:F.DOMCanvasFactory,N=_.isNodeJS?T.NodeCMapReaderFactory:F.DOMCMapReaderFactory,B=_.isNodeJS?T.NodeFilterFactory:F.DOMFilterFactory,q=_.isNodeJS?T.NodeStandardFontDataFactory:F.DOMStandardFontDataFactory;async function X(a,i){if(a.destroyed)throw new Error("Worker was destroyed");const h=await a.messageHandler.sendWithPromise("GetDocRequest",i,i.data?[i.data.buffer]:null);if(a.destroyed)throw new Error("Worker was destroyed");return h}class Y{static#t=0;constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${Y.#t++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(i){throw this._worker?.port&&delete this._worker._pendingDestroy,i}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}class Q{constructor(i,h,p=!1,w=null){this.length=i,this.initialData=h,this.progressiveDone=p,this.contentDispositionFilename=w,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(i){this._rangeListeners.push(i)}addProgressListener(i){this._progressListeners.push(i)}addProgressiveReadListener(i){this._progressiveReadListeners.push(i)}addProgressiveDoneListener(i){this._progressiveDoneListeners.push(i)}onDataRange(i,h){for(const p of this._rangeListeners)p(i,h)}onDataProgress(i,h){this._readyCapability.promise.then(()=>{for(const p of this._progressListeners)p(i,h)})}onDataProgressiveRead(i){this._readyCapability.promise.then(()=>{for(const h of this._progressiveReadListeners)h(i)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const i of this._progressiveDoneListeners)i()})}transportReady(){this._readyCapability.resolve()}requestDataRange(i,h){(0,_.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class K{constructor(i,h){this._pdfInfo=i,this._transport=h}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(i){return this._transport.getPage(i)}getPageIndex(i){return this._transport.getPageIndex(i)}getDestinations(){return this._transport.getDestinations()}getDestination(i){return this._transport.getDestination(i)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:i="display"}={}){const{renderingIntent:h}=this._transport.getRenderingIntent(i);return this._transport.getOptionalContentConfig(h)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(i=!1){return this._transport.startCleanup(i||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class at{#t=null;#e=!1;constructor(i,h,p,w=!1){this._pageIndex=i,this._pageInfo=h,this._transport=p,this._stats=w?new F.StatTimer:null,this._pdfBug=w,this.commonObjs=p.commonObjs,this.objs=new Z,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:i,rotation:h=this.rotate,offsetX:p=0,offsetY:w=0,dontFlip:E=!1}={}){return new F.PageViewport({viewBox:this.view,scale:i,rotation:h,offsetX:p,offsetY:w,dontFlip:E})}getAnnotations({intent:i="display"}={}){const{renderingIntent:h}=this._transport.getRenderingIntent(i);return this._transport.getAnnotations(this._pageIndex,h)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:i,viewport:h,intent:p="display",annotationMode:w=_.AnnotationMode.ENABLE,transform:E=null,background:R=null,optionalContentConfigPromise:P=null,annotationCanvasMap:L=null,pageColors:x=null,printAnnotationStorage:k=null}){this._stats?.time("Overall");const D=this._transport.getRenderingIntent(p,w,k),{renderingIntent:j,cacheKey:J}=D;this.#e=!1,this.#n(),P||=this._transport.getOptionalContentConfig(j);let $=this._intentStates.get(J);$||($=Object.create(null),this._intentStates.set(J,$)),$.streamReaderCancelTimeout&&(clearTimeout($.streamReaderCancelTimeout),$.streamReaderCancelTimeout=null);const tt=!!(j&_.RenderingIntentFlag.PRINT);$.displayReadyCapability||($.displayReadyCapability=Promise.withResolvers(),$.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(D));const it=nt=>{$.renderTasks.delete(W),(this._maybeCleanupAfterRender||tt)&&(this.#e=!0),this.#s(!tt),nt?(W.capability.reject(nt),this._abortOperatorList({intentState:$,reason:nt instanceof Error?nt:new Error(nt)})):W.capability.resolve(),this._stats?.timeEnd("Rendering"),this._stats?.timeEnd("Overall")},W=new l({callback:it,params:{canvasContext:i,viewport:h,transform:E,background:R},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:L,operatorList:$.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!tt,pdfBug:this._pdfBug,pageColors:x});($.renderTasks||=new Set).add(W);const rt=W.task;return Promise.all([$.displayReadyCapability.promise,P]).then(([nt,ut])=>{if(this.destroyed){it();return}if(this._stats?.time("Rendering"),!(ut.renderingIntent&j))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");W.initializeGraphics({transparency:nt,optionalContentConfig:ut}),W.operatorListChanged()}).catch(it),rt}getOperatorList({intent:i="display",annotationMode:h=_.AnnotationMode.ENABLE,printAnnotationStorage:p=null}={}){function w(){R.operatorList.lastChunk&&(R.opListReadCapability.resolve(R.operatorList),R.renderTasks.delete(P))}const E=this._transport.getRenderingIntent(i,h,p,!0);let R=this._intentStates.get(E.cacheKey);R||(R=Object.create(null),this._intentStates.set(E.cacheKey,R));let P;return R.opListReadCapability||(P=Object.create(null),P.operatorListChanged=w,R.opListReadCapability=Promise.withResolvers(),(R.renderTasks||=new Set).add(P),R.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(E)),R.opListReadCapability.promise}streamTextContent({includeMarkedContent:i=!1,disableNormalization:h=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:i===!0,disableNormalization:h===!0},{highWaterMark:100,size(w){return w.items.length}})}getTextContent(i={}){if(this._transport._htmlForXfa)return this.getXfa().then(p=>f.XfaText.textContent(p));const h=this.streamTextContent(i);return new Promise(function(p,w){function E(){R.read().then(function({value:L,done:x}){if(x){p(P);return}Object.assign(P.styles,L.styles),P.items.push(...L.items),E()},w)}const R=h.getReader(),P={items:[],styles:Object.create(null)};E()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const i=[];for(const h of this._intentStates.values())if(this._abortOperatorList({intentState:h,reason:new Error("Page was destroyed."),force:!0}),!h.opListReadCapability)for(const p of h.renderTasks)i.push(p.completed),p.cancel();return this.objs.clear(),this.#e=!1,this.#n(),Promise.all(i)}cleanup(i=!1){this.#e=!0;const h=this.#s(!1);return i&&h&&(this._stats&&=new F.StatTimer),h}#s(i=!1){if(this.#n(),!this.#e||this.destroyed)return!1;if(i)return this.#t=setTimeout(()=>{this.#t=null,this.#s(!1)},I),!1;for(const{renderTasks:h,operatorList:p}of this._intentStates.values())if(h.size>0||!p.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#e=!1,!0}#n(){this.#t&&(clearTimeout(this.#t),this.#t=null)}_startRenderPage(i,h){const p=this._intentStates.get(h);p&&(this._stats?.timeEnd("Page Request"),p.displayReadyCapability?.resolve(i))}_renderPageChunk(i,h){for(let p=0,w=i.length;p<w;p++)h.operatorList.fnArray.push(i.fnArray[p]),h.operatorList.argsArray.push(i.argsArray[p]);h.operatorList.lastChunk=i.lastChunk,h.operatorList.separateAnnots=i.separateAnnots;for(const p of h.renderTasks)p.operatorListChanged();i.lastChunk&&this.#s(!0)}_pumpOperatorList({renderingIntent:i,cacheKey:h,annotationStorageSerializable:p}){const{map:w,transfer:E}=p,P=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:i,cacheKey:h,annotationStorage:w},E).getReader(),L=this._intentStates.get(h);L.streamReader=P;const x=()=>{P.read().then(({value:k,done:D})=>{if(D){L.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(k,L),x())},k=>{if(L.streamReader=null,!this._transport.destroyed){if(L.operatorList){L.operatorList.lastChunk=!0;for(const D of L.renderTasks)D.operatorListChanged();this.#s(!0)}if(L.displayReadyCapability)L.displayReadyCapability.reject(k);else if(L.opListReadCapability)L.opListReadCapability.reject(k);else throw k}})};x()}_abortOperatorList({intentState:i,reason:h,force:p=!1}){if(i.streamReader){if(i.streamReaderCancelTimeout&&(clearTimeout(i.streamReaderCancelTimeout),i.streamReaderCancelTimeout=null),!p){if(i.renderTasks.size>0)return;if(h instanceof F.RenderingCancelledException){let w=M;h.extraDelay>0&&h.extraDelay<1e3&&(w+=h.extraDelay),i.streamReaderCancelTimeout=setTimeout(()=>{i.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:i,reason:h,force:!0})},w);return}}if(i.streamReader.cancel(new _.AbortException(h.message)).catch(()=>{}),i.streamReader=null,!this._transport.destroyed){for(const[w,E]of this._intentStates)if(E===i){this._intentStates.delete(w);break}this.cleanup()}}}get stats(){return this._stats}}class ot{#t=new Set;#e=Promise.resolve();postMessage(i,h){const p={data:structuredClone(i,h?{transfer:h}:null)};this.#e.then(()=>{for(const w of this.#t)w.call(this,p)})}addEventListener(i,h){this.#t.add(h)}removeEventListener(i,h){this.#t.delete(h)}terminate(){this.#t.clear()}}const lt={isWorkerDisabled:!1,fakeWorkerId:0};_.isNodeJS&&(lt.isWorkerDisabled=!0,d.GlobalWorkerOptions.workerSrc||="./pdf.worker.mjs"),lt.isSameOrigin=function(a,i){let h;try{if(h=new URL(a),!h.origin||h.origin==="null")return!1}catch{return!1}const p=new URL(i,h);return h.origin===p.origin},lt.createCDNWrapper=function(a){const i=`await import("${a}");`;return URL.createObjectURL(new Blob([i],{type:"text/javascript"}))};class ht{static#t;constructor({name:i=null,port:h=null,verbosity:p=(0,_.getVerbosityLevel)()}={}){if(this.name=i,this.destroyed=!1,this.verbosity=p,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,h){if(ht.#t?.has(h))throw new Error("Cannot use more than one PDFWorker per port.");(ht.#t||=new WeakMap).set(h,this),this._initializeFromPort(h);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(i){this._port=i,this._messageHandler=new u.MessageHandler("main","worker",i),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!lt.isWorkerDisabled&&!ht.#e){let{workerSrc:i}=ht;try{lt.isSameOrigin(window.location.href,i)||(i=lt.createCDNWrapper(new URL(i,window.location).href));const h=new Worker(i,{type:"module"}),p=new u.MessageHandler("main","worker",h),w=()=>{h.removeEventListener("error",E),p.destroy(),h.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},E=()=>{this._webWorker||w()};h.addEventListener("error",E),p.on("test",P=>{if(h.removeEventListener("error",E),this.destroyed){w();return}P?(this._messageHandler=p,this._port=h,this._webWorker=h,this._readyCapability.resolve(),p.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),p.destroy(),h.terminate())}),p.on("ready",P=>{if(h.removeEventListener("error",E),this.destroyed){w();return}try{R()}catch{this._setupFakeWorker()}});const R=()=>{const P=new Uint8Array;p.send("test",P,[P.buffer])};R();return}catch{(0,_.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){lt.isWorkerDisabled||((0,_.warn)("Setting up fake worker."),lt.isWorkerDisabled=!0),ht._setupFakeWorkerGlobal.then(i=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const h=new ot;this._port=h;const p=`fake${lt.fakeWorkerId++}`,w=new u.MessageHandler(p+"_worker",p,h);i.setup(w,h);const E=new u.MessageHandler(p,p+"_worker",h);this._messageHandler=E,this._readyCapability.resolve(),E.send("configure",{verbosity:this.verbosity})}).catch(i=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${i.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),ht.#t?.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(i){if(!i?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");const h=this.#t?.get(i.port);if(h){if(h._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return h}return new ht(i)}static get workerSrc(){if(d.GlobalWorkerOptions.workerSrc)return d.GlobalWorkerOptions.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get#e(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){const i=async()=>this.#e?this.#e:(await Rt(()=>import(this.workerSrc),[])).WorkerMessageHandler;return(0,_.shadow)(this,"_setupFakeWorkerGlobal",i())}}class ft{#t=new Map;#e=new Map;#s=new Map;#n=null;constructor(i,h,p,w,E){this.messageHandler=i,this.loadingTask=h,this.commonObjs=new Z,this.fontLoader=new C.FontLoader({ownerDocument:w.ownerDocument,styleElement:w.styleElement}),this._params=w,this.canvasFactory=E.canvasFactory,this.filterFactory=E.filterFactory,this.cMapReaderFactory=E.cMapReaderFactory,this.standardFontDataFactory=E.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=p,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}#r(i,h=null){const p=this.#t.get(i);if(p)return p;const w=this.messageHandler.sendWithPromise(i,h);return this.#t.set(i,w),w}get annotationStorage(){return(0,_.shadow)(this,"annotationStorage",new U.AnnotationStorage)}getRenderingIntent(i,h=_.AnnotationMode.ENABLE,p=null,w=!1){let E=_.RenderingIntentFlag.DISPLAY,R=U.SerializableEmpty;switch(i){case"any":E=_.RenderingIntentFlag.ANY;break;case"display":break;case"print":E=_.RenderingIntentFlag.PRINT;break;default:(0,_.warn)(`getRenderingIntent - invalid intent: ${i}`)}switch(h){case _.AnnotationMode.DISABLE:E+=_.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _.AnnotationMode.ENABLE:break;case _.AnnotationMode.ENABLE_FORMS:E+=_.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _.AnnotationMode.ENABLE_STORAGE:E+=_.RenderingIntentFlag.ANNOTATIONS_STORAGE,R=(E&_.RenderingIntentFlag.PRINT&&p instanceof U.PrintAnnotationStorage?p:this.annotationStorage).serializable;break;default:(0,_.warn)(`getRenderingIntent - invalid annotationMode: ${h}`)}return w&&(E+=_.RenderingIntentFlag.OPLIST),{renderingIntent:E,cacheKey:`${E}_${R.hash}`,annotationStorageSerializable:R}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#n?.reject(new Error("Worker was destroyed during onPassword callback"));const i=[];for(const p of this.#e.values())i.push(p._destroy());this.#e.clear(),this.#s.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const h=this.messageHandler.sendWithPromise("Terminate",null);return i.push(h),Promise.all(i).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),(0,o.cleanupTextLayer)(),this._networkStream?.cancelAllRequests(new _.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:i,loadingTask:h}=this;i.on("GetReader",(p,w)=>{(0,_.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=E=>{this._lastProgress={loaded:E.loaded,total:E.total}},w.onPull=()=>{this._fullReader.read().then(function({value:E,done:R}){if(R){w.close();return}(0,_.assert)(E instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),w.enqueue(new Uint8Array(E),1,[E])}).catch(E=>{w.error(E)})},w.onCancel=E=>{this._fullReader.cancel(E),w.ready.catch(R=>{if(!this.destroyed)throw R})}}),i.on("ReaderHeadersReady",p=>{const w=Promise.withResolvers(),E=this._fullReader;return E.headersReady.then(()=>{(!E.isStreamingSupported||!E.isRangeSupported)&&(this._lastProgress&&h.onProgress?.(this._lastProgress),E.onProgress=R=>{h.onProgress?.({loaded:R.loaded,total:R.total})}),w.resolve({isStreamingSupported:E.isStreamingSupported,isRangeSupported:E.isRangeSupported,contentLength:E.contentLength})},w.reject),w.promise}),i.on("GetRangeReader",(p,w)=>{(0,_.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const E=this._networkStream.getRangeReader(p.begin,p.end);if(!E){w.close();return}w.onPull=()=>{E.read().then(function({value:R,done:P}){if(P){w.close();return}(0,_.assert)(R instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),w.enqueue(new Uint8Array(R),1,[R])}).catch(R=>{w.error(R)})},w.onCancel=R=>{E.cancel(R),w.ready.catch(P=>{if(!this.destroyed)throw P})}}),i.on("GetDoc",({pdfInfo:p})=>{this._numPages=p.numPages,this._htmlForXfa=p.htmlForXfa,delete p.htmlForXfa,h._capability.resolve(new K(p,this))}),i.on("DocException",function(p){let w;switch(p.name){case"PasswordException":w=new _.PasswordException(p.message,p.code);break;case"InvalidPDFException":w=new _.InvalidPDFException(p.message);break;case"MissingPDFException":w=new _.MissingPDFException(p.message);break;case"UnexpectedResponseException":w=new _.UnexpectedResponseException(p.message,p.status);break;case"UnknownErrorException":w=new _.UnknownErrorException(p.message,p.details);break;default:(0,_.unreachable)("DocException - expected a valid Error.")}h._capability.reject(w)}),i.on("PasswordRequest",p=>{if(this.#n=Promise.withResolvers(),h.onPassword){const w=E=>{E instanceof Error?this.#n.reject(E):this.#n.resolve({password:E})};try{h.onPassword(w,p.code)}catch(E){this.#n.reject(E)}}else this.#n.reject(new _.PasswordException(p.message,p.code));return this.#n.promise}),i.on("DataLoaded",p=>{h.onProgress?.({loaded:p.length,total:p.length}),this.downloadInfoCapability.resolve(p)}),i.on("StartRenderPage",p=>{if(this.destroyed)return;this.#e.get(p.pageIndex)._startRenderPage(p.transparency,p.cacheKey)}),i.on("commonobj",([p,w,E])=>{if(this.destroyed||this.commonObjs.has(p))return null;switch(w){case"Font":const R=this._params;if("error"in E){const k=E.error;(0,_.warn)(`Error during font loading: ${k}`),this.commonObjs.resolve(p,k);break}const P=R.pdfBug&&globalThis.FontInspector?.enabled?(k,D)=>globalThis.FontInspector.fontAdded(k,D):null,L=new C.FontFaceObject(E,{isEvalSupported:R.isEvalSupported,disableFontFace:R.disableFontFace,ignoreErrors:R.ignoreErrors,inspectFont:P});this.fontLoader.bind(L).catch(()=>i.sendWithPromise("FontFallback",{id:p})).finally(()=>{!R.fontExtraProperties&&L.data&&(L.data=null),this.commonObjs.resolve(p,L)});break;case"CopyLocalImage":const{imageRef:x}=E;(0,_.assert)(x,"The imageRef must be defined.");for(const k of this.#e.values())for(const[,D]of k.objs)if(D.ref===x)return D.dataLen?(this.commonObjs.resolve(p,structuredClone(D)),D.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(p,E);break;default:throw new Error(`Got unknown common object type ${w}`)}return null}),i.on("obj",([p,w,E,R])=>{if(this.destroyed)return;const P=this.#e.get(w);if(!P.objs.has(p)){if(P._intentStates.size===0){R?.bitmap?.close();return}switch(E){case"Image":P.objs.resolve(p,R),R?.dataLen>_.MAX_IMAGE_SIZE_TO_CACHE&&(P._maybeCleanupAfterRender=!0);break;case"Pattern":P.objs.resolve(p,R);break;default:throw new Error(`Got unknown object type ${E}`)}}}),i.on("DocProgress",p=>{this.destroyed||h.onProgress?.({loaded:p.loaded,total:p.total})}),i.on("FetchBuiltInCMap",p=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(p):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),i.on("FetchStandardFontData",p=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(p):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&(0,_.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:i,transfer:h}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:i,filename:this._fullReader?.filename??null},h).finally(()=>{this.annotationStorage.resetModified()})}getPage(i){if(!Number.isInteger(i)||i<=0||i>this._numPages)return Promise.reject(new Error("Invalid page request."));const h=i-1,p=this.#s.get(h);if(p)return p;const w=this.messageHandler.sendWithPromise("GetPage",{pageIndex:h}).then(E=>{if(this.destroyed)throw new Error("Transport destroyed");const R=new at(h,E,this,this._params.pdfBug);return this.#e.set(h,R),R});return this.#s.set(h,w),w}getPageIndex(i){return typeof i!="object"||i===null||!Number.isInteger(i.num)||i.num<0||!Number.isInteger(i.gen)||i.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:i.num,gen:i.gen})}getAnnotations(i,h){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:i,intent:h})}getFieldObjects(){return this.#r("GetFieldObjects")}hasJSActions(){return this.#r("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(i){return typeof i!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:i})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#r("GetDocJSActions")}getPageJSActions(i){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:i})}getStructTree(i){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:i})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(i){return this.#r("GetOptionalContentConfig").then(h=>new s.OptionalContentConfig(h,i))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const i="GetMetadata",h=this.#t.get(i);if(h)return h;const p=this.messageHandler.sendWithPromise(i,null).then(w=>({info:w[0],metadata:w[1]?new b.Metadata(w[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#t.set(i,p),p}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(i=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const h of this.#e.values())if(!h.cleanup())throw new Error(`startCleanup: Page ${h.pageNumber} is currently rendering.`);this.commonObjs.clear(),i||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0),(0,o.cleanupTextLayer)()}}get loadingParams(){const{disableAutoFetch:i,enableXfa:h}=this._params;return(0,_.shadow)(this,"loadingParams",{disableAutoFetch:i,enableXfa:h})}}const ct=Symbol("INITIAL_DATA");class Z{#t=Object.create(null);#e(i){return this.#t[i]||={...Promise.withResolvers(),data:ct}}get(i,h=null){if(h){const w=this.#e(i);return w.promise.then(()=>h(w.data)),null}const p=this.#t[i];if(!p||p.data===ct)throw new Error(`Requesting object that isn't resolved yet ${i}.`);return p.data}has(i){const h=this.#t[i];return!!h&&h.data!==ct}resolve(i,h=null){const p=this.#e(i);p.data=h,p.resolve()}clear(){for(const i in this.#t){const{data:h}=this.#t[i];h?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(const i in this.#t){const{data:h}=this.#t[i];h!==ct&&(yield[i,h])}}}class m{#t=null;constructor(i){this.#t=i,this.onContinue=null}get promise(){return this.#t.capability.promise}cancel(i=0){this.#t.cancel(null,i)}get separateAnnots(){const{separateAnnots:i}=this.#t.operatorList;if(!i)return!1;const{annotationCanvasMap:h}=this.#t;return i.form||i.canvas&&h?.size>0}}class l{static#t=new WeakSet;constructor({callback:i,params:h,objs:p,commonObjs:w,annotationCanvasMap:E,operatorList:R,pageIndex:P,canvasFactory:L,filterFactory:x,useRequestAnimationFrame:k=!1,pdfBug:D=!1,pageColors:j=null}){this.callback=i,this.params=h,this.objs=p,this.commonObjs=w,this.annotationCanvasMap=E,this.operatorListIdx=null,this.operatorList=R,this._pageIndex=P,this.canvasFactory=L,this.filterFactory=x,this._pdfBug=D,this.pageColors=j,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=k===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new m(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=h.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:i=!1,optionalContentConfig:h}){if(this.cancelled)return;if(this._canvas){if(l.#t.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");l.#t.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:p,viewport:w,transform:E,background:R}=this.params;this.gfx=new A.CanvasGraphics(p,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:h},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:E,viewport:w,transparency:i,background:R}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(i=null,h=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),l.#t.delete(this._canvas),this.callback(i||new F.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,h))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),l.#t.delete(this._canvas),this.callback())))}}const e="4.1.392",n="fcb76a78d";z()}catch(S){z(S)}})},583:(dt,et,V)=>{V.d(et,{BaseCMapReaderFactory:()=>U,BaseCanvasFactory:()=>_,BaseFilterFactory:()=>z,BaseSVGFactory:()=>C,BaseStandardFontDataFactory:()=>F});var y=V(292);class z{constructor(){this.constructor===z&&(0,y.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(A){return"none"}addHCMFilter(A,o){return"none"}addHighlightHCMFilter(A,o,d,u,b){return"none"}destroy(A=!1){}}class _{constructor(){this.constructor===_&&(0,y.unreachable)("Cannot initialize BaseCanvasFactory.")}create(A,o){if(A<=0||o<=0)throw new Error("Invalid canvas size");const d=this._createCanvas(A,o);return{canvas:d,context:d.getContext("2d")}}reset(A,o,d){if(!A.canvas)throw new Error("Canvas is not specified");if(o<=0||d<=0)throw new Error("Invalid canvas size");A.canvas.width=o,A.canvas.height=d}destroy(A){if(!A.canvas)throw new Error("Canvas is not specified");A.canvas.width=0,A.canvas.height=0,A.canvas=null,A.context=null}_createCanvas(A,o){(0,y.unreachable)("Abstract method `_createCanvas` called.")}}class U{constructor({baseUrl:A=null,isCompressed:o=!0}){this.constructor===U&&(0,y.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=A,this.isCompressed=o}async fetch({name:A}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!A)throw new Error("CMap name must be specified.");const o=this.baseUrl+A+(this.isCompressed?".bcmap":""),d=this.isCompressed?y.CMapCompressionType.BINARY:y.CMapCompressionType.NONE;return this._fetchData(o,d).catch(u=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${o}`)})}_fetchData(A,o){(0,y.unreachable)("Abstract method `_fetchData` called.")}}class F{constructor({baseUrl:A=null}){this.constructor===F&&(0,y.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=A}async fetch({filename:A}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!A)throw new Error("Font filename must be specified.");const o=`${this.baseUrl}${A}`;return this._fetchData(o).catch(d=>{throw new Error(`Unable to load font data at: ${o}`)})}_fetchData(A){(0,y.unreachable)("Abstract method `_fetchData` called.")}}class C{constructor(){this.constructor===C&&(0,y.unreachable)("Cannot initialize BaseSVGFactory.")}create(A,o,d=!1){if(A<=0||o<=0)throw new Error("Invalid SVG dimensions");const u=this._createSVG("svg:svg");return u.setAttribute("version","1.1"),d||(u.setAttribute("width",`${A}px`),u.setAttribute("height",`${o}px`)),u.setAttribute("preserveAspectRatio","none"),u.setAttribute("viewBox",`0 0 ${A} ${o}`),u}createElement(A){if(typeof A!="string")throw new Error("Invalid SVG element type");return this._createSVG(A)}_createSVG(A){(0,y.unreachable)("Abstract method `_createSVG` called.")}}},923:(dt,et,V)=>{V.d(et,{CanvasGraphics:()=>m});var y=V(292),z=V(419);const _={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function U(l,e){if(!e)return;const n=e[2]-e[0],a=e[3]-e[1],i=new Path2D;i.rect(e[0],e[1],n,a),l.clip(i)}class F{constructor(){this.constructor===F&&(0,y.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,y.unreachable)("Abstract method `getPattern` called.")}}class C extends F{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let n;this._type==="axial"?n=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(n=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const a of this._colorStops)n.addColorStop(a[0],a[1]);return n}getPattern(e,n,a,i){let h;if(i===_.STROKE||i===_.FILL){const p=n.current.getClippedPathBoundingBox(i,(0,z.getCurrentTransform)(e))||[0,0,0,0],w=Math.ceil(p[2]-p[0])||1,E=Math.ceil(p[3]-p[1])||1,R=n.cachedCanvases.getCanvas("pattern",w,E,!0),P=R.context;P.clearRect(0,0,P.canvas.width,P.canvas.height),P.beginPath(),P.rect(0,0,P.canvas.width,P.canvas.height),P.translate(-p[0],-p[1]),a=y.Util.transform(a,[1,0,0,1,p[0],p[1]]),P.transform(...n.baseTransform),this.matrix&&P.transform(...this.matrix),U(P,this._bbox),P.fillStyle=this._createGradient(P),P.fill(),h=e.createPattern(R.canvas,"no-repeat");const L=new DOMMatrix(a);h.setTransform(L)}else U(e,this._bbox),h=this._createGradient(e);return h}}function T(l,e,n,a,i,h,p,w){const E=e.coords,R=e.colors,P=l.data,L=l.width*4;let x;E[n+1]>E[a+1]&&(x=n,n=a,a=x,x=h,h=p,p=x),E[a+1]>E[i+1]&&(x=a,a=i,i=x,x=p,p=w,w=x),E[n+1]>E[a+1]&&(x=n,n=a,a=x,x=h,h=p,p=x);const k=(E[n]+e.offsetX)*e.scaleX,D=(E[n+1]+e.offsetY)*e.scaleY,j=(E[a]+e.offsetX)*e.scaleX,J=(E[a+1]+e.offsetY)*e.scaleY,$=(E[i]+e.offsetX)*e.scaleX,tt=(E[i+1]+e.offsetY)*e.scaleY;if(D>=tt)return;const it=R[h],W=R[h+1],rt=R[h+2],nt=R[p],ut=R[p+1],gt=R[p+2],mt=R[w],At=R[w+1],bt=R[w+2],Ct=Math.round(D),St=Math.round(tt);let Tt,yt,xt,kt,Pt,Nt,Mt,Ot;for(let Et=Ct;Et<=St;Et++){if(Et<J){const vt=Et<D?0:(D-Et)/(D-J);Tt=k-(k-j)*vt,yt=it-(it-nt)*vt,xt=W-(W-ut)*vt,kt=rt-(rt-gt)*vt}else{let vt;Et>tt?vt=1:J===tt?vt=0:vt=(J-Et)/(J-tt),Tt=j-(j-$)*vt,yt=nt-(nt-mt)*vt,xt=ut-(ut-At)*vt,kt=gt-(gt-bt)*vt}let wt;Et<D?wt=0:Et>tt?wt=1:wt=(D-Et)/(D-tt),Pt=k-(k-$)*wt,Nt=it-(it-mt)*wt,Mt=W-(W-At)*wt,Ot=rt-(rt-bt)*wt;const It=Math.round(Math.min(Tt,Pt)),Ht=Math.round(Math.max(Tt,Pt));let _t=L*Et+It*4;for(let vt=It;vt<=Ht;vt++)wt=(Tt-vt)/(Tt-Pt),wt<0?wt=0:wt>1&&(wt=1),P[_t++]=yt-(yt-Nt)*wt|0,P[_t++]=xt-(xt-Mt)*wt|0,P[_t++]=kt-(kt-Ot)*wt|0,P[_t++]=255}}function A(l,e,n){const a=e.coords,i=e.colors;let h,p;switch(e.type){case"lattice":const w=e.verticesPerRow,E=Math.floor(a.length/w)-1,R=w-1;for(h=0;h<E;h++){let P=h*w;for(let L=0;L<R;L++,P++)T(l,n,a[P],a[P+1],a[P+w],i[P],i[P+1],i[P+w]),T(l,n,a[P+w+1],a[P+1],a[P+w],i[P+w+1],i[P+1],i[P+w])}break;case"triangles":for(h=0,p=a.length;h<p;h+=3)T(l,n,a[h],a[h+1],a[h+2],i[h],i[h+1],i[h+2]);break;default:throw new Error("illegal figure")}}class o extends F{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,n,a){const w=Math.floor(this._bounds[0]),E=Math.floor(this._bounds[1]),R=Math.ceil(this._bounds[2])-w,P=Math.ceil(this._bounds[3])-E,L=Math.min(Math.ceil(Math.abs(R*e[0]*1.1)),3e3),x=Math.min(Math.ceil(Math.abs(P*e[1]*1.1)),3e3),k=R/L,D=P/x,j={coords:this._coords,colors:this._colors,offsetX:-w,offsetY:-E,scaleX:1/k,scaleY:1/D},J=L+2*2,$=x+2*2,tt=a.getCanvas("mesh",J,$,!1),it=tt.context,W=it.createImageData(L,x);if(n){const nt=W.data;for(let ut=0,gt=nt.length;ut<gt;ut+=4)nt[ut]=n[0],nt[ut+1]=n[1],nt[ut+2]=n[2],nt[ut+3]=255}for(const nt of this._figures)A(W,nt,j);return it.putImageData(W,2,2),{canvas:tt.canvas,offsetX:w-2*k,offsetY:E-2*D,scaleX:k,scaleY:D}}getPattern(e,n,a,i){U(e,this._bbox);let h;if(i===_.SHADING)h=y.Util.singularValueDecompose2dScale((0,z.getCurrentTransform)(e));else if(h=y.Util.singularValueDecompose2dScale(n.baseTransform),this.matrix){const w=y.Util.singularValueDecompose2dScale(this.matrix);h=[h[0]*w[0],h[1]*w[1]]}const p=this._createMeshCanvas(h,i===_.SHADING?null:this._background,n.cachedCanvases);return i!==_.SHADING&&(e.setTransform(...n.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(p.offsetX,p.offsetY),e.scale(p.scaleX,p.scaleY),e.createPattern(p.canvas,"no-repeat")}}class d extends F{getPattern(){return"hotpink"}}function u(l){switch(l[0]){case"RadialAxial":return new C(l);case"Mesh":return new o(l);case"Dummy":return new d}throw new Error(`Unknown IR type: ${l[0]}`)}const b={COLORED:1,UNCOLORED:2};class s{static MAX_PATTERN_SIZE=3e3;constructor(e,n,a,i,h){this.operatorList=e[2],this.matrix=e[3]||[1,0,0,1,0,0],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=n,this.ctx=a,this.canvasGraphicsFactory=i,this.baseTransform=h}createPatternCanvas(e){const n=this.operatorList,a=this.bbox,i=this.xstep,h=this.ystep,p=this.paintType,w=this.tilingType,E=this.color,R=this.canvasGraphicsFactory;(0,y.info)("TilingType: "+w);const P=a[0],L=a[1],x=a[2],k=a[3],D=y.Util.singularValueDecompose2dScale(this.matrix),j=y.Util.singularValueDecompose2dScale(this.baseTransform),J=[D[0]*j[0],D[1]*j[1]],$=this.getSizeAndScale(i,this.ctx.canvas.width,J[0]),tt=this.getSizeAndScale(h,this.ctx.canvas.height,J[1]),it=e.cachedCanvases.getCanvas("pattern",$.size,tt.size,!0),W=it.context,rt=R.createCanvasGraphics(W);rt.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(rt,p,E);let nt=P,ut=L,gt=x,mt=k;return P<0&&(nt=0,gt+=Math.abs(P)),L<0&&(ut=0,mt+=Math.abs(L)),W.translate(-($.scale*nt),-(tt.scale*ut)),rt.transform($.scale,0,0,tt.scale,0,0),W.save(),this.clipBbox(rt,nt,ut,gt,mt),rt.baseTransform=(0,z.getCurrentTransform)(rt.ctx),rt.executeOperatorList(n),rt.endDrawing(),{canvas:it.canvas,scaleX:$.scale,scaleY:tt.scale,offsetX:nt,offsetY:ut}}getSizeAndScale(e,n,a){e=Math.abs(e);const i=Math.max(s.MAX_PATTERN_SIZE,n);let h=Math.ceil(e*a);return h>=i?h=i:a=h/e,{scale:a,size:h}}clipBbox(e,n,a,i,h){const p=i-n,w=h-a;e.ctx.rect(n,a,p,w),e.current.updateRectMinMax((0,z.getCurrentTransform)(e.ctx),[n,a,i,h]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,n,a){const i=e.ctx,h=e.current;switch(n){case b.COLORED:const p=this.ctx;i.fillStyle=p.fillStyle,i.strokeStyle=p.strokeStyle,h.fillColor=p.fillStyle,h.strokeColor=p.strokeStyle;break;case b.UNCOLORED:const w=y.Util.makeHexColor(a[0],a[1],a[2]);i.fillStyle=w,i.strokeStyle=w,h.fillColor=w,h.strokeColor=w;break;default:throw new y.FormatError(`Unsupported paint type: ${n}`)}}getPattern(e,n,a,i){let h=a;i!==_.SHADING&&(h=y.Util.transform(h,n.baseTransform),this.matrix&&(h=y.Util.transform(h,this.matrix)));const p=this.createPatternCanvas(n);let w=new DOMMatrix(h);w=w.translate(p.offsetX,p.offsetY),w=w.scale(1/p.scaleX,1/p.scaleY);const E=e.createPattern(p.canvas,"repeat");return E.setTransform(w),E}}function g({src:l,srcPos:e=0,dest:n,width:a,height:i,nonBlackColor:h=4294967295,inverseDecode:p=!1}){const w=y.FeatureTest.isLittleEndian?4278190080:255,[E,R]=p?[h,w]:[w,h],P=a>>3,L=a&7,x=l.length;n=new Uint32Array(n.buffer);let k=0;for(let D=0;D<i;D++){for(const J=e+P;e<J;e++){const $=e<x?l[e]:255;n[k++]=$&128?R:E,n[k++]=$&64?R:E,n[k++]=$&32?R:E,n[k++]=$&16?R:E,n[k++]=$&8?R:E,n[k++]=$&4?R:E,n[k++]=$&2?R:E,n[k++]=$&1?R:E}if(L===0)continue;const j=e<x?l[e++]:255;for(let J=0;J<L;J++)n[k++]=j&1<<7-J?R:E}return{srcPos:e,destPos:k}}const t=16,r=100,c=4096,f=15,v=10,S=1e3,M=16;function I(l,e){if(l._removeMirroring)throw new Error("Context is already forwarding operations.");l.__originalSave=l.save,l.__originalRestore=l.restore,l.__originalRotate=l.rotate,l.__originalScale=l.scale,l.__originalTranslate=l.translate,l.__originalTransform=l.transform,l.__originalSetTransform=l.setTransform,l.__originalResetTransform=l.resetTransform,l.__originalClip=l.clip,l.__originalMoveTo=l.moveTo,l.__originalLineTo=l.lineTo,l.__originalBezierCurveTo=l.bezierCurveTo,l.__originalRect=l.rect,l.__originalClosePath=l.closePath,l.__originalBeginPath=l.beginPath,l._removeMirroring=()=>{l.save=l.__originalSave,l.restore=l.__originalRestore,l.rotate=l.__originalRotate,l.scale=l.__originalScale,l.translate=l.__originalTranslate,l.transform=l.__originalTransform,l.setTransform=l.__originalSetTransform,l.resetTransform=l.__originalResetTransform,l.clip=l.__originalClip,l.moveTo=l.__originalMoveTo,l.lineTo=l.__originalLineTo,l.bezierCurveTo=l.__originalBezierCurveTo,l.rect=l.__originalRect,l.closePath=l.__originalClosePath,l.beginPath=l.__originalBeginPath,delete l._removeMirroring},l.save=function(){e.save(),this.__originalSave()},l.restore=function(){e.restore(),this.__originalRestore()},l.translate=function(a,i){e.translate(a,i),this.__originalTranslate(a,i)},l.scale=function(a,i){e.scale(a,i),this.__originalScale(a,i)},l.transform=function(a,i,h,p,w,E){e.transform(a,i,h,p,w,E),this.__originalTransform(a,i,h,p,w,E)},l.setTransform=function(a,i,h,p,w,E){e.setTransform(a,i,h,p,w,E),this.__originalSetTransform(a,i,h,p,w,E)},l.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},l.rotate=function(a){e.rotate(a),this.__originalRotate(a)},l.clip=function(a){e.clip(a),this.__originalClip(a)},l.moveTo=function(n,a){e.moveTo(n,a),this.__originalMoveTo(n,a)},l.lineTo=function(n,a){e.lineTo(n,a),this.__originalLineTo(n,a)},l.bezierCurveTo=function(n,a,i,h,p,w){e.bezierCurveTo(n,a,i,h,p,w),this.__originalBezierCurveTo(n,a,i,h,p,w)},l.rect=function(n,a,i,h){e.rect(n,a,i,h),this.__originalRect(n,a,i,h)},l.closePath=function(){e.closePath(),this.__originalClosePath()},l.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class O{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,n,a){let i;return this.cache[e]!==void 0?(i=this.cache[e],this.canvasFactory.reset(i,n,a)):(i=this.canvasFactory.create(n,a),this.cache[e]=i),i}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const n=this.cache[e];this.canvasFactory.destroy(n),delete this.cache[e]}}}function N(l,e,n,a,i,h,p,w,E,R){const[P,L,x,k,D,j]=(0,z.getCurrentTransform)(l);if(L===0&&x===0){const tt=p*P+D,it=Math.round(tt),W=w*k+j,rt=Math.round(W),nt=(p+E)*P+D,ut=Math.abs(Math.round(nt)-it)||1,gt=(w+R)*k+j,mt=Math.abs(Math.round(gt)-rt)||1;return l.setTransform(Math.sign(P),0,0,Math.sign(k),it,rt),l.drawImage(e,n,a,i,h,0,0,ut,mt),l.setTransform(P,L,x,k,D,j),[ut,mt]}if(P===0&&k===0){const tt=w*x+D,it=Math.round(tt),W=p*L+j,rt=Math.round(W),nt=(w+R)*x+D,ut=Math.abs(Math.round(nt)-it)||1,gt=(p+E)*L+j,mt=Math.abs(Math.round(gt)-rt)||1;return l.setTransform(0,Math.sign(L),Math.sign(x),0,it,rt),l.drawImage(e,n,a,i,h,0,0,mt,ut),l.setTransform(P,L,x,k,D,j),[mt,ut]}l.drawImage(e,n,a,i,h,p,w,E,R);const J=Math.hypot(P,L),$=Math.hypot(x,k);return[J*E,$*R]}function B(l){const{width:e,height:n}=l;if(e>S||n>S)return null;const a=1e3,i=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),h=e+1;let p=new Uint8Array(h*(n+1)),w,E,R;const P=e+7&-8;let L=new Uint8Array(P*n),x=0;for(const $ of l.data){let tt=128;for(;tt>0;)L[x++]=$&tt?0:255,tt>>=1}let k=0;for(x=0,L[x]!==0&&(p[0]=1,++k),E=1;E<e;E++)L[x]!==L[x+1]&&(p[E]=L[x]?2:1,++k),x++;for(L[x]!==0&&(p[E]=2,++k),w=1;w<n;w++){x=w*P,R=w*h,L[x-P]!==L[x]&&(p[R]=L[x]?1:8,++k);let $=(L[x]?4:0)+(L[x-P]?8:0);for(E=1;E<e;E++)$=($>>2)+(L[x+1]?4:0)+(L[x-P+1]?8:0),i[$]&&(p[R+E]=i[$],++k),x++;if(L[x-P]!==L[x]&&(p[R+E]=L[x]?2:4,++k),k>a)return null}for(x=P*(n-1),R=w*h,L[x]!==0&&(p[R]=8,++k),E=1;E<e;E++)L[x]!==L[x+1]&&(p[R+E]=L[x]?4:8,++k),x++;if(L[x]!==0&&(p[R+E]=4,++k),k>a)return null;const D=new Int32Array([0,h,-1,0,-h,0,0,0,1]),j=new Path2D;for(w=0;k&&w<=n;w++){let $=w*h;const tt=$+e;for(;$<tt&&!p[$];)$++;if($===tt)continue;j.moveTo($%h,w);const it=$;let W=p[$];do{const rt=D[W];do $+=rt;while(!p[$]);const nt=p[$];nt!==5&&nt!==10?(W=nt,p[$]=0):(W=nt&51*W>>4,p[$]&=W>>2|W<<2),j.lineTo($%h,$/h|0),p[$]||--k}while(it!==$);--w}return L=null,p=null,function($){$.save(),$.scale(1/e,-1/n),$.translate(0,-n),$.fill(j),$.beginPath(),$.restore()}}class q{constructor(e,n){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=y.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=y.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=y.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,n])}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,n){this.x=e,this.y=n}updatePathMinMax(e,n,a){[n,a]=y.Util.applyTransform([n,a],e),this.minX=Math.min(this.minX,n),this.minY=Math.min(this.minY,a),this.maxX=Math.max(this.maxX,n),this.maxY=Math.max(this.maxY,a)}updateRectMinMax(e,n){const a=y.Util.applyTransform(n,e),i=y.Util.applyTransform(n.slice(2),e),h=y.Util.applyTransform([n[0],n[3]],e),p=y.Util.applyTransform([n[2],n[1]],e);this.minX=Math.min(this.minX,a[0],i[0],h[0],p[0]),this.minY=Math.min(this.minY,a[1],i[1],h[1],p[1]),this.maxX=Math.max(this.maxX,a[0],i[0],h[0],p[0]),this.maxY=Math.max(this.maxY,a[1],i[1],h[1],p[1])}updateScalingPathMinMax(e,n){y.Util.scaleMinMax(e,n),this.minX=Math.min(this.minX,n[0]),this.minY=Math.min(this.minY,n[1]),this.maxX=Math.max(this.maxX,n[2]),this.maxY=Math.max(this.maxY,n[3])}updateCurvePathMinMax(e,n,a,i,h,p,w,E,R,P){const L=y.Util.bezierBoundingBox(n,a,i,h,p,w,E,R,P);P||this.updateRectMinMax(e,L)}getPathBoundingBox(e=_.FILL,n=null){const a=[this.minX,this.minY,this.maxX,this.maxY];if(e===_.STROKE){n||(0,y.unreachable)("Stroke bounding box must include transform.");const i=y.Util.singularValueDecompose2dScale(n),h=i[0]*this.lineWidth/2,p=i[1]*this.lineWidth/2;a[0]-=h,a[1]-=p,a[2]+=h,a[3]+=p}return a}updateClipFromPath(){const e=y.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=_.FILL,n=null){return y.Util.intersect(this.clipBox,this.getPathBoundingBox(e,n))}}function st(l,e){if(typeof ImageData<"u"&&e instanceof ImageData){l.putImageData(e,0,0);return}const n=e.height,a=e.width,i=n%M,h=(n-i)/M,p=i===0?h:h+1,w=l.createImageData(a,M);let E=0,R;const P=e.data,L=w.data;let x,k,D,j;if(e.kind===y.ImageKind.GRAYSCALE_1BPP){const J=P.byteLength,$=new Uint32Array(L.buffer,0,L.byteLength>>2),tt=$.length,it=a+7>>3,W=4294967295,rt=y.FeatureTest.isLittleEndian?4278190080:255;for(x=0;x<p;x++){for(D=x<h?M:i,R=0,k=0;k<D;k++){const nt=J-E;let ut=0;const gt=nt>it?a:nt*8-7,mt=gt&-8;let At=0,bt=0;for(;ut<mt;ut+=8)bt=P[E++],$[R++]=bt&128?W:rt,$[R++]=bt&64?W:rt,$[R++]=bt&32?W:rt,$[R++]=bt&16?W:rt,$[R++]=bt&8?W:rt,$[R++]=bt&4?W:rt,$[R++]=bt&2?W:rt,$[R++]=bt&1?W:rt;for(;ut<gt;ut++)At===0&&(bt=P[E++],At=128),$[R++]=bt&At?W:rt,At>>=1}for(;R<tt;)$[R++]=0;l.putImageData(w,0,x*M)}}else if(e.kind===y.ImageKind.RGBA_32BPP){for(k=0,j=a*M*4,x=0;x<h;x++)L.set(P.subarray(E,E+j)),E+=j,l.putImageData(w,0,k),k+=M;x<p&&(j=a*i*4,L.set(P.subarray(E,E+j)),l.putImageData(w,0,k))}else if(e.kind===y.ImageKind.RGB_24BPP)for(D=M,j=a*D,x=0;x<p;x++){for(x>=h&&(D=i,j=a*D),R=0,k=j;k--;)L[R++]=P[E++],L[R++]=P[E++],L[R++]=P[E++],L[R++]=255;l.putImageData(w,0,x*M)}else throw new Error(`bad image kind: ${e.kind}`)}function X(l,e){if(e.bitmap){l.drawImage(e.bitmap,0,0);return}const n=e.height,a=e.width,i=n%M,h=(n-i)/M,p=i===0?h:h+1,w=l.createImageData(a,M);let E=0;const R=e.data,P=w.data;for(let L=0;L<p;L++){const x=L<h?M:i;({srcPos:E}=g({src:R,srcPos:E,dest:P,width:a,height:x,nonBlackColor:0})),l.putImageData(w,0,L*M)}}function H(l,e){const n=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const a of n)l[a]!==void 0&&(e[a]=l[a]);l.setLineDash!==void 0&&(e.setLineDash(l.getLineDash()),e.lineDashOffset=l.lineDashOffset)}function G(l){if(l.strokeStyle=l.fillStyle="#000000",l.fillRule="nonzero",l.globalAlpha=1,l.lineWidth=1,l.lineCap="butt",l.lineJoin="miter",l.miterLimit=10,l.globalCompositeOperation="source-over",l.font="10px sans-serif",l.setLineDash!==void 0&&(l.setLineDash([]),l.lineDashOffset=0),!y.isNodeJS){const{filter:e}=l;e!=="none"&&e!==""&&(l.filter="none")}}function Y(l,e,n,a){const i=l.length;for(let h=3;h<i;h+=4){const p=l[h];if(p===0)l[h-3]=e,l[h-2]=n,l[h-1]=a;else if(p<255){const w=255-p;l[h-3]=l[h-3]*p+e*w>>8,l[h-2]=l[h-2]*p+n*w>>8,l[h-1]=l[h-1]*p+a*w>>8}}}function Q(l,e,n){const a=l.length,i=1/255;for(let h=3;h<a;h+=4){const p=n?n[l[h]]:l[h];e[h]=e[h]*p*i|0}}function K(l,e,n){const a=l.length;for(let i=3;i<a;i+=4){const h=l[i-3]*77+l[i-2]*152+l[i-1]*28;e[i]=n?e[i]*n[h>>8]>>8:e[i]*h>>16}}function at(l,e,n,a,i,h,p,w,E,R,P){const L=!!h,x=L?h[0]:0,k=L?h[1]:0,D=L?h[2]:0,j=i==="Luminosity"?K:Q,$=Math.min(a,Math.ceil(1048576/n));for(let tt=0;tt<a;tt+=$){const it=Math.min($,a-tt),W=l.getImageData(w-R,tt+(E-P),n,it),rt=e.getImageData(w,tt+E,n,it);L&&Y(W.data,x,k,D),j(W.data,rt.data,p),e.putImageData(rt,w,tt+E)}}function ot(l,e,n,a){const i=a[0],h=a[1],p=a[2]-i,w=a[3]-h;p===0||w===0||(at(e.context,n,p,w,e.subtype,e.backdrop,e.transferMap,i,h,e.offsetX,e.offsetY),l.save(),l.globalAlpha=1,l.globalCompositeOperation="source-over",l.setTransform(1,0,0,1,0,0),l.drawImage(n.canvas,0,0),l.restore())}function lt(l,e){const n=y.Util.singularValueDecompose2dScale(l);n[0]=Math.fround(n[0]),n[1]=Math.fround(n[1]);const a=Math.fround((globalThis.devicePixelRatio||1)*z.PixelsPerInch.PDF_TO_CSS_UNITS);return e!==void 0?e:n[0]<=a||n[1]<=a}const ht=["butt","round","square"],ft=["miter","round","bevel"],ct={},Z={};class m{constructor(e,n,a,i,h,{optionalContentConfig:p,markedContentStack:w=null},E,R){this.ctx=e,this.current=new q(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=n,this.objs=a,this.canvasFactory=i,this.filterFactory=h,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=w||[],this.optionalContentConfig=p,this.cachedCanvases=new O(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=E,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=R,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,n=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):n}beginDrawing({transform:e,viewport:n,transparency:a=!1,background:i=null}){const h=this.ctx.canvas.width,p=this.ctx.canvas.height,w=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,h,p),this.ctx.fillStyle=w,a){const E=this.cachedCanvases.getCanvas("transparent",h,p);this.compositeCtx=this.ctx,this.transparentCanvas=E.canvas,this.ctx=E.context,this.ctx.save(),this.ctx.transform(...(0,z.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),G(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...n.transform),this.viewportScale=n.scale,this.baseTransform=(0,z.getCurrentTransform)(this.ctx)}executeOperatorList(e,n,a,i){const h=e.argsArray,p=e.fnArray;let w=n||0;const E=h.length;if(E===w)return w;const R=E-w>v&&typeof a=="function",P=R?Date.now()+f:0;let L=0;const x=this.commonObjs,k=this.objs;let D;for(;;){if(i!==void 0&&w===i.nextBreakPoint)return i.breakIt(w,a),w;if(D=p[w],D!==y.OPS.dependency)this[D].apply(this,h[w]);else for(const j of h[w]){const J=j.startsWith("g_")?x:k;if(!J.has(j))return J.get(j,a),w}if(w++,w===E)return w;if(R&&++L>v){if(Date.now()>P)return a(),w;L=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const n of e.values())typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement&&(n.width=n.height=0);e.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const n=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=n}}}_scaleImage(e,n){const a=e.width,i=e.height;let h=Math.max(Math.hypot(n[0],n[1]),1),p=Math.max(Math.hypot(n[2],n[3]),1),w=a,E=i,R="prescale1",P,L;for(;h>2&&w>1||p>2&&E>1;){let x=w,k=E;h>2&&w>1&&(x=w>=16384?Math.floor(w/2)-1||1:Math.ceil(w/2),h/=w/x),p>2&&E>1&&(k=E>=16384?Math.floor(E/2)-1||1:Math.ceil(E)/2,p/=E/k),P=this.cachedCanvases.getCanvas(R,x,k),L=P.context,L.clearRect(0,0,x,k),L.drawImage(e,0,0,w,E,0,0,x,k),e=P.canvas,w=x,E=k,R=R==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:w,paintHeight:E}}_createMaskCanvas(e){const n=this.ctx,{width:a,height:i}=e,h=this.current.fillColor,p=this.current.patternFill,w=(0,z.getCurrentTransform)(n);let E,R,P,L;if((e.bitmap||e.data)&&e.count>1){const gt=e.bitmap||e.data.buffer;R=JSON.stringify(p?w:[w.slice(0,4),h]),E=this._cachedBitmapsMap.get(gt),E||(E=new Map,this._cachedBitmapsMap.set(gt,E));const mt=E.get(R);if(mt&&!p){const At=Math.round(Math.min(w[0],w[2])+w[4]),bt=Math.round(Math.min(w[1],w[3])+w[5]);return{canvas:mt,offsetX:At,offsetY:bt}}P=mt}P||(L=this.cachedCanvases.getCanvas("maskCanvas",a,i),X(L.context,e));let x=y.Util.transform(w,[1/a,0,0,-1/i,0,0]);x=y.Util.transform(x,[1,0,0,1,0,-i]);const[k,D,j,J]=y.Util.getAxialAlignedBoundingBox([0,0,a,i],x),$=Math.round(j-k)||1,tt=Math.round(J-D)||1,it=this.cachedCanvases.getCanvas("fillCanvas",$,tt),W=it.context,rt=k,nt=D;W.translate(-rt,-nt),W.transform(...x),P||(P=this._scaleImage(L.canvas,(0,z.getCurrentTransformInverse)(W)),P=P.img,E&&p&&E.set(R,P)),W.imageSmoothingEnabled=lt((0,z.getCurrentTransform)(W),e.interpolate),N(W,P,0,0,P.width,P.height,0,0,a,i),W.globalCompositeOperation="source-in";const ut=y.Util.transform((0,z.getCurrentTransformInverse)(W),[1,0,0,1,-rt,-nt]);return W.fillStyle=p?h.getPattern(n,this,ut,_.FILL):h,W.fillRect(0,0,a,i),E&&!p&&(this.cachedCanvases.delete("fillCanvas"),E.set(R,it.canvas)),{canvas:it.canvas,offsetX:Math.round(rt),offsetY:Math.round(nt)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=ht[e]}setLineJoin(e){this.ctx.lineJoin=ft[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,n){const a=this.ctx;a.setLineDash!==void 0&&(a.setLineDash(e),a.lineDashOffset=n)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[n,a]of e)switch(n){case"LW":this.setLineWidth(a);break;case"LC":this.setLineCap(a);break;case"LJ":this.setLineJoin(a);break;case"ML":this.setMiterLimit(a);break;case"D":this.setDash(a[0],a[1]);break;case"RI":this.setRenderingIntent(a);break;case"FL":this.setFlatness(a);break;case"Font":this.setFont(a[0],a[1]);break;case"CA":this.current.strokeAlpha=a;break;case"ca":this.current.fillAlpha=a,this.ctx.globalAlpha=a;break;case"BM":this.ctx.globalCompositeOperation=a;break;case"SMask":this.current.activeSMask=a?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(a);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,n=this.ctx.canvas.height,a="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(a,e,n);this.suspendedCtx=this.ctx,this.ctx=i.context;const h=this.ctx;h.setTransform(...(0,z.getCurrentTransform)(this.suspendedCtx)),H(this.suspendedCtx,h),I(h,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),H(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const n=this.current.activeSMask,a=this.suspendedCtx;ot(a,n,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(H(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),H(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,n,a,i,h,p){this.ctx.transform(e,n,a,i,h,p),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,n,a){const i=this.ctx,h=this.current;let p=h.x,w=h.y,E,R;const P=(0,z.getCurrentTransform)(i),L=P[0]===0&&P[3]===0||P[1]===0&&P[2]===0,x=L?a.slice(0):null;for(let k=0,D=0,j=e.length;k<j;k++)switch(e[k]|0){case y.OPS.rectangle:p=n[D++],w=n[D++];const J=n[D++],$=n[D++],tt=p+J,it=w+$;i.moveTo(p,w),J===0||$===0?i.lineTo(tt,it):(i.lineTo(tt,w),i.lineTo(tt,it),i.lineTo(p,it)),L||h.updateRectMinMax(P,[p,w,tt,it]),i.closePath();break;case y.OPS.moveTo:p=n[D++],w=n[D++],i.moveTo(p,w),L||h.updatePathMinMax(P,p,w);break;case y.OPS.lineTo:p=n[D++],w=n[D++],i.lineTo(p,w),L||h.updatePathMinMax(P,p,w);break;case y.OPS.curveTo:E=p,R=w,p=n[D+4],w=n[D+5],i.bezierCurveTo(n[D],n[D+1],n[D+2],n[D+3],p,w),h.updateCurvePathMinMax(P,E,R,n[D],n[D+1],n[D+2],n[D+3],p,w,x),D+=6;break;case y.OPS.curveTo2:E=p,R=w,i.bezierCurveTo(p,w,n[D],n[D+1],n[D+2],n[D+3]),h.updateCurvePathMinMax(P,E,R,p,w,n[D],n[D+1],n[D+2],n[D+3],x),p=n[D+2],w=n[D+3],D+=4;break;case y.OPS.curveTo3:E=p,R=w,p=n[D+2],w=n[D+3],i.bezierCurveTo(n[D],n[D+1],p,w,p,w),h.updateCurvePathMinMax(P,E,R,n[D],n[D+1],p,w,p,w,x),D+=4;break;case y.OPS.closePath:i.closePath();break}L&&h.updateScalingPathMinMax(P,x),h.setCurrentPoint(p,w)}closePath(){this.ctx.closePath()}stroke(e=!0){const n=this.ctx,a=this.current.strokeColor;n.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof a=="object"&&a?.getPattern?(n.save(),n.strokeStyle=a.getPattern(n,this,(0,z.getCurrentTransformInverse)(n),_.STROKE),this.rescaleAndStroke(!1),n.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),n.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){const n=this.ctx,a=this.current.fillColor,i=this.current.patternFill;let h=!1;i&&(n.save(),n.fillStyle=a.getPattern(n,this,(0,z.getCurrentTransformInverse)(n),_.FILL),h=!0);const p=this.current.getClippedPathBoundingBox();this.contentVisible&&p!==null&&(this.pendingEOFill?(n.fill("evenodd"),this.pendingEOFill=!1):n.fill()),h&&n.restore(),e&&this.consumePath(p)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=ct}eoClip(){this.pendingClip=Z}beginText(){this.current.textMatrix=y.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,n=this.ctx;if(e===void 0){n.beginPath();return}n.save(),n.beginPath();for(const a of e)n.setTransform(...a.transform),n.translate(a.x,a.y),a.addToPath(n,a.fontSize);n.restore(),n.clip(),n.beginPath(),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,n){const a=this.commonObjs.get(e),i=this.current;if(!a)throw new Error(`Can't find font for ${e}`);if(i.fontMatrix=a.fontMatrix||y.FONT_IDENTITY_MATRIX,(i.fontMatrix[0]===0||i.fontMatrix[3]===0)&&(0,y.warn)("Invalid font matrix for font "+e),n<0?(n=-n,i.fontDirection=-1):i.fontDirection=1,this.current.font=a,this.current.fontSize=n,a.isType3Font)return;const h=a.loadedName||"sans-serif",p=a.systemFontInfo?.css||`"${h}", ${a.fallbackName}`;let w="normal";a.black?w="900":a.bold&&(w="bold");const E=a.italic?"italic":"normal";let R=n;n<t?R=t:n>r&&(R=r),this.current.fontSizeScale=n/R,this.ctx.font=`${E} ${w} ${R}px ${p}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,n){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=n}setLeadingMoveText(e,n){this.setLeading(-n),this.moveText(e,n)}setTextMatrix(e,n,a,i,h,p){this.current.textMatrix=[e,n,a,i,h,p],this.current.textMatrixScale=Math.hypot(e,n),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,n,a,i){const h=this.ctx,p=this.current,w=p.font,E=p.textRenderingMode,R=p.fontSize/p.fontSizeScale,P=E&y.TextRenderingMode.FILL_STROKE_MASK,L=!!(E&y.TextRenderingMode.ADD_TO_PATH_FLAG),x=p.patternFill&&!w.missingFile;let k;(w.disableFontFace||L||x)&&(k=w.getPathGenerator(this.commonObjs,e)),w.disableFontFace||x?(h.save(),h.translate(n,a),h.beginPath(),k(h,R),i&&h.setTransform(...i),(P===y.TextRenderingMode.FILL||P===y.TextRenderingMode.FILL_STROKE)&&h.fill(),(P===y.TextRenderingMode.STROKE||P===y.TextRenderingMode.FILL_STROKE)&&h.stroke(),h.restore()):((P===y.TextRenderingMode.FILL||P===y.TextRenderingMode.FILL_STROKE)&&h.fillText(e,n,a),(P===y.TextRenderingMode.STROKE||P===y.TextRenderingMode.FILL_STROKE)&&h.strokeText(e,n,a)),L&&(this.pendingTextPaths||=[]).push({transform:(0,z.getCurrentTransform)(h),x:n,y:a,fontSize:R,addToPath:k})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const n=e.getImageData(0,0,10,10).data;let a=!1;for(let i=3;i<n.length;i+=4)if(n[i]>0&&n[i]<255){a=!0;break}return(0,y.shadow)(this,"isFontSubpixelAAEnabled",a)}showText(e){const n=this.current,a=n.font;if(a.isType3Font)return this.showType3Text(e);const i=n.fontSize;if(i===0)return;const h=this.ctx,p=n.fontSizeScale,w=n.charSpacing,E=n.wordSpacing,R=n.fontDirection,P=n.textHScale*R,L=e.length,x=a.vertical,k=x?1:-1,D=a.defaultVMetrics,j=i*n.fontMatrix[0],J=n.textRenderingMode===y.TextRenderingMode.FILL&&!a.disableFontFace&&!n.patternFill;h.save(),h.transform(...n.textMatrix),h.translate(n.x,n.y+n.textRise),R>0?h.scale(P,-1):h.scale(P,1);let $;if(n.patternFill){h.save();const nt=n.fillColor.getPattern(h,this,(0,z.getCurrentTransformInverse)(h),_.FILL);$=(0,z.getCurrentTransform)(h),h.restore(),h.fillStyle=nt}let tt=n.lineWidth;const it=n.textMatrixScale;if(it===0||tt===0){const nt=n.textRenderingMode&y.TextRenderingMode.FILL_STROKE_MASK;(nt===y.TextRenderingMode.STROKE||nt===y.TextRenderingMode.FILL_STROKE)&&(tt=this.getSinglePixelWidth())}else tt/=it;if(p!==1&&(h.scale(p,p),tt/=p),h.lineWidth=tt,a.isInvalidPDFjsFont){const nt=[];let ut=0;for(const gt of e)nt.push(gt.unicode),ut+=gt.width;h.fillText(nt.join(""),0,0),n.x+=ut*j*P,h.restore(),this.compose();return}let W=0,rt;for(rt=0;rt<L;++rt){const nt=e[rt];if(typeof nt=="number"){W+=k*nt*i/1e3;continue}let ut=!1;const gt=(nt.isSpace?E:0)+w,mt=nt.fontChar,At=nt.accent;let bt,Ct,St=nt.width;if(x){const yt=nt.vmetric||D,xt=-(nt.vmetric?yt[1]:St*.5)*j,kt=yt[2]*j;St=yt?-yt[0]:St,bt=xt/p,Ct=(W+kt)/p}else bt=W/p,Ct=0;if(a.remeasure&&St>0){const yt=h.measureText(mt).width*1e3/i*p;if(St<yt&&this.isFontSubpixelAAEnabled){const xt=St/yt;ut=!0,h.save(),h.scale(xt,1),bt/=xt}else St!==yt&&(bt+=(St-yt)/2e3*i/p)}if(this.contentVisible&&(nt.isInFont||a.missingFile)){if(J&&!At)h.fillText(mt,bt,Ct);else if(this.paintChar(mt,bt,Ct,$),At){const yt=bt+i*At.offset.x/p,xt=Ct-i*At.offset.y/p;this.paintChar(At.fontChar,yt,xt,$)}}const Tt=x?St*j-gt*R:St*j+gt*R;W+=Tt,ut&&h.restore()}x?n.y-=W:n.x+=W*P,h.restore(),this.compose()}showType3Text(e){const n=this.ctx,a=this.current,i=a.font,h=a.fontSize,p=a.fontDirection,w=i.vertical?1:-1,E=a.charSpacing,R=a.wordSpacing,P=a.textHScale*p,L=a.fontMatrix||y.FONT_IDENTITY_MATRIX,x=e.length,k=a.textRenderingMode===y.TextRenderingMode.INVISIBLE;let D,j,J,$;if(!(k||h===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,n.save(),n.transform(...a.textMatrix),n.translate(a.x,a.y),n.scale(P,p),D=0;D<x;++D){if(j=e[D],typeof j=="number"){$=w*j*h/1e3,this.ctx.translate($,0),a.x+=$*P;continue}const tt=(j.isSpace?R:0)+E,it=i.charProcOperatorList[j.operatorListId];if(!it){(0,y.warn)(`Type3 character "${j.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=j,this.save(),n.scale(h,h),n.transform(...L),this.executeOperatorList(it),this.restore()),J=y.Util.applyTransform([j.width,0],L)[0]*h+tt,n.translate(J,0),a.x+=J*P}n.restore(),this.processingType3=null}}setCharWidth(e,n){}setCharWidthAndBounds(e,n,a,i,h,p){this.ctx.rect(a,i,h-a,p-i),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let n;if(e[0]==="TilingPattern"){const a=e[1],i=this.baseTransform||(0,z.getCurrentTransform)(this.ctx),h={createCanvasGraphics:p=>new m(p,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};n=new s(e,a,this.ctx,h,i)}else n=this._getPattern(e[1],e[2]);return n}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,n,a){const i=y.Util.makeHexColor(e,n,a);this.ctx.strokeStyle=i,this.current.strokeColor=i}setFillRGBColor(e,n,a){const i=y.Util.makeHexColor(e,n,a);this.ctx.fillStyle=i,this.current.fillColor=i,this.current.patternFill=!1}_getPattern(e,n=null){let a;return this.cachedPatterns.has(e)?a=this.cachedPatterns.get(e):(a=u(this.getObject(e)),this.cachedPatterns.set(e,a)),n&&(a.matrix=n),a}shadingFill(e){if(!this.contentVisible)return;const n=this.ctx;this.save();const a=this._getPattern(e);n.fillStyle=a.getPattern(n,this,(0,z.getCurrentTransformInverse)(n),_.SHADING);const i=(0,z.getCurrentTransformInverse)(n);if(i){const{width:h,height:p}=n.canvas,[w,E,R,P]=y.Util.getAxialAlignedBoundingBox([0,0,h,p],i);this.ctx.fillRect(w,E,R-w,P-E)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,y.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,y.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(e,n){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(e)&&e.length===6&&this.transform(...e),this.baseTransform=(0,z.getCurrentTransform)(this.ctx),n)){const a=n[2]-n[0],i=n[3]-n[1];this.ctx.rect(n[0],n[1],a,i),this.current.updateRectMinMax((0,z.getCurrentTransform)(this.ctx),n),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const n=this.ctx;e.isolated||(0,y.info)("TODO: Support non-isolated groups."),e.knockout&&(0,y.warn)("Knockout groups not supported.");const a=(0,z.getCurrentTransform)(n);if(e.matrix&&n.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let i=y.Util.getAxialAlignedBoundingBox(e.bbox,(0,z.getCurrentTransform)(n));const h=[0,0,n.canvas.width,n.canvas.height];i=y.Util.intersect(i,h)||[0,0,0,0];const p=Math.floor(i[0]),w=Math.floor(i[1]);let E=Math.max(Math.ceil(i[2])-p,1),R=Math.max(Math.ceil(i[3])-w,1),P=1,L=1;E>c&&(P=E/c,E=c),R>c&&(L=R/c,R=c),this.current.startNewPathAndClipBox([0,0,E,R]);let x="groupAt"+this.groupLevel;e.smask&&(x+="_smask_"+this.smaskCounter++%2);const k=this.cachedCanvases.getCanvas(x,E,R),D=k.context;D.scale(1/P,1/L),D.translate(-p,-w),D.transform(...a),e.smask?this.smaskStack.push({canvas:k.canvas,context:D,offsetX:p,offsetY:w,scaleX:P,scaleY:L,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(n.setTransform(1,0,0,1,0,0),n.translate(p,w),n.scale(P,L),n.save()),H(n,D),this.ctx=D,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(n),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const n=this.ctx,a=this.groupStack.pop();if(this.ctx=a,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const i=(0,z.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...i);const h=y.Util.getAxialAlignedBoundingBox([0,0,n.canvas.width,n.canvas.height],i);this.ctx.drawImage(n.canvas,0,0),this.ctx.restore(),this.compose(h)}}beginAnnotation(e,n,a,i,h){if(this.#t(),G(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(n)&&n.length===4){const p=n[2]-n[0],w=n[3]-n[1];if(h&&this.annotationCanvasMap){a=a.slice(),a[4]-=n[0],a[5]-=n[1],n=n.slice(),n[0]=n[1]=0,n[2]=p,n[3]=w;const[E,R]=y.Util.singularValueDecompose2dScale((0,z.getCurrentTransform)(this.ctx)),{viewportScale:P}=this,L=Math.ceil(p*this.outputScaleX*P),x=Math.ceil(w*this.outputScaleY*P);this.annotationCanvas=this.canvasFactory.create(L,x);const{canvas:k,context:D}=this.annotationCanvas;this.annotationCanvasMap.set(e,k),this.annotationCanvas.savedCtx=this.ctx,this.ctx=D,this.ctx.save(),this.ctx.setTransform(E,0,0,-R,0,w*R),G(this.ctx)}else G(this.ctx),this.ctx.rect(n[0],n[1],p,w),this.ctx.clip(),this.endPath()}this.current=new q(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...a),this.transform(...i)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const n=e.count;e=this.getObject(e.data,e),e.count=n;const a=this.ctx,i=this.processingType3;if(i&&(i.compiled===void 0&&(i.compiled=B(e)),i.compiled)){i.compiled(a);return}const h=this._createMaskCanvas(e),p=h.canvas;a.save(),a.setTransform(1,0,0,1,0,0),a.drawImage(p,h.offsetX,h.offsetY),a.restore(),this.compose()}paintImageMaskXObjectRepeat(e,n,a=0,i=0,h,p){if(!this.contentVisible)return;e=this.getObject(e.data,e);const w=this.ctx;w.save();const E=(0,z.getCurrentTransform)(w);w.transform(n,a,i,h,0,0);const R=this._createMaskCanvas(e);w.setTransform(1,0,0,1,R.offsetX-E[4],R.offsetY-E[5]);for(let P=0,L=p.length;P<L;P+=2){const x=y.Util.transform(E,[n,a,i,h,p[P],p[P+1]]),[k,D]=y.Util.applyTransform([0,0],x);w.drawImage(R.canvas,k,D)}w.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const n=this.ctx,a=this.current.fillColor,i=this.current.patternFill;for(const h of e){const{data:p,width:w,height:E,transform:R}=h,P=this.cachedCanvases.getCanvas("maskCanvas",w,E),L=P.context;L.save();const x=this.getObject(p,h);X(L,x),L.globalCompositeOperation="source-in",L.fillStyle=i?a.getPattern(L,this,(0,z.getCurrentTransformInverse)(n),_.FILL):a,L.fillRect(0,0,w,E),L.restore(),n.save(),n.transform(...R),n.scale(1,-1),N(n,P.canvas,0,0,w,E,0,-1,1,1),n.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const n=this.getObject(e);if(!n){(0,y.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(n)}paintImageXObjectRepeat(e,n,a,i){if(!this.contentVisible)return;const h=this.getObject(e);if(!h){(0,y.warn)("Dependent image isn't ready yet");return}const p=h.width,w=h.height,E=[];for(let R=0,P=i.length;R<P;R+=2)E.push({transform:[n,0,0,a,i[R],i[R+1]],x:0,y:0,w:p,h:w});this.paintInlineImageXObjectGroup(h,E)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:n,width:a,height:i}=e,h=this.cachedCanvases.getCanvas("inlineImage",a,i),p=h.context;return p.filter=this.current.transferMaps,p.drawImage(n,0,0),p.filter="none",h.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const n=e.width,a=e.height,i=this.ctx;if(this.save(),!y.isNodeJS){const{filter:w}=i;w!=="none"&&w!==""&&(i.filter="none")}i.scale(1/n,-1/a);let h;if(e.bitmap)h=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)h=e;else{const E=this.cachedCanvases.getCanvas("inlineImage",n,a).context;st(E,e),h=this.applyTransferMapsToCanvas(E)}const p=this._scaleImage(h,(0,z.getCurrentTransformInverse)(i));i.imageSmoothingEnabled=lt((0,z.getCurrentTransform)(i),e.interpolate),N(i,p.img,0,0,p.paintWidth,p.paintHeight,0,-a,n,a),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,n){if(!this.contentVisible)return;const a=this.ctx;let i;if(e.bitmap)i=e.bitmap;else{const h=e.width,p=e.height,E=this.cachedCanvases.getCanvas("inlineImage",h,p).context;st(E,e),i=this.applyTransferMapsToCanvas(E)}for(const h of n)a.save(),a.transform(...h.transform),a.scale(1,-1),N(a,i,h.x,h.y,h.w,h.h,0,-1,1,1),a.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,n){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,n){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(n)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){const n=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const a=this.ctx;this.pendingClip&&(n||(this.pendingClip===Z?a.clip("evenodd"):a.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),a.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=(0,z.getCurrentTransform)(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const n=Math.abs(e[0]*e[3]-e[2]*e[1]),a=Math.hypot(e[0],e[2]),i=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(a,i)/n}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:n,b:a,c:i,d:h}=this.ctx.getTransform();let p,w;if(a===0&&i===0){const E=Math.abs(n),R=Math.abs(h);if(E===R)if(e===0)p=w=1/E;else{const P=E*e;p=w=P<1?1/P:1}else if(e===0)p=1/E,w=1/R;else{const P=E*e,L=R*e;p=P<1?1/P:1,w=L<1?1/L:1}}else{const E=Math.abs(n*h-a*i),R=Math.hypot(n,a),P=Math.hypot(i,h);if(e===0)p=P/E,w=R/E;else{const L=e*E;p=P>L?P/L:1,w=R>L?R/L:1}}this._cachedScaleForStroking[0]=p,this._cachedScaleForStroking[1]=w}return this._cachedScaleForStroking}rescaleAndStroke(e){const{ctx:n}=this,{lineWidth:a}=this.current,[i,h]=this.getScaleForStroking();if(n.lineWidth=a||1,i===1&&h===1){n.stroke();return}const p=n.getLineDash();if(e&&n.save(),n.scale(i,h),p.length>0){const w=Math.max(i,h);n.setLineDash(p.map(E=>E/w)),n.lineDashOffset/=w}n.stroke(),e&&n.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}}for(const l in y.OPS)m.prototype[l]!==void 0&&(m.prototype[y.OPS[l]]=m.prototype[l])},419:(dt,et,V)=>{V.d(et,{DOMCMapReaderFactory:()=>A,DOMCanvasFactory:()=>C,DOMFilterFactory:()=>F,DOMSVGFactory:()=>d,DOMStandardFontDataFactory:()=>o,PDFDateString:()=>M,PageViewport:()=>u,PixelsPerInch:()=>U,RenderingCancelledException:()=>b,StatTimer:()=>c,fetchData:()=>T,getColorValues:()=>N,getCurrentTransform:()=>B,getCurrentTransformInverse:()=>q,getFilenameFromUrl:()=>t,getPdfFilenameFromUrl:()=>r,getRGB:()=>O,getXfaPageViewport:()=>I,isDataScheme:()=>s,isPdfFile:()=>g,isValidFetchUrl:()=>f,noContextMenu:()=>v,setLayerDimensions:()=>st});var y=V(583),z=V(292);const _="http://www.w3.org/2000/svg";class U{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}class F extends y.BaseFilterFactory{#t;#e;#s;#n;#r;#i=0;constructor({docId:H,ownerDocument:G=globalThis.document}={}){super(),this.#s=H,this.#n=G}get#a(){return this.#t||=new Map}get#l(){return this.#r||=new Map}get#h(){if(!this.#e){const H=this.#n.createElement("div"),{style:G}=H;G.visibility="hidden",G.contain="strict",G.width=G.height=0,G.position="absolute",G.top=G.left=0,G.zIndex=-1;const Y=this.#n.createElementNS(_,"svg");Y.setAttribute("width",0),Y.setAttribute("height",0),this.#e=this.#n.createElementNS(_,"defs"),H.append(Y),Y.append(this.#e),this.#n.body.append(H)}return this.#e}addFilter(H){if(!H)return"none";let G=this.#a.get(H);if(G)return G;let Y,Q,K,at;if(H.length===1){const ft=H[0],ct=new Array(256);for(let Z=0;Z<256;Z++)ct[Z]=ft[Z]/255;at=Y=Q=K=ct.join(",")}else{const[ft,ct,Z]=H,m=new Array(256),l=new Array(256),e=new Array(256);for(let n=0;n<256;n++)m[n]=ft[n]/255,l[n]=ct[n]/255,e[n]=Z[n]/255;Y=m.join(","),Q=l.join(","),K=e.join(","),at=`${Y}${Q}${K}`}if(G=this.#a.get(at),G)return this.#a.set(H,G),G;const ot=`g_${this.#s}_transfer_map_${this.#i++}`,lt=`url(#${ot})`;this.#a.set(H,lt),this.#a.set(at,lt);const ht=this.#u(ot);return this.#o(Y,Q,K,ht),lt}addHCMFilter(H,G){const Y=`${H}-${G}`,Q="base";let K=this.#l.get(Q);if(K?.key===Y||(K?(K.filter?.remove(),K.key=Y,K.url="none",K.filter=null):(K={key:Y,url:"none",filter:null},this.#l.set(Q,K)),!H||!G))return K.url;const at=this.#p(H);H=z.Util.makeHexColor(...at);const ot=this.#p(G);if(G=z.Util.makeHexColor(...ot),this.#h.style.color="",H==="#000000"&&G==="#ffffff"||H===G)return K.url;const lt=new Array(256);for(let m=0;m<=255;m++){const l=m/255;lt[m]=l<=.03928?l/12.92:((l+.055)/1.055)**2.4}const ht=lt.join(","),ft=`g_${this.#s}_hcm_filter`,ct=K.filter=this.#u(ft);this.#o(ht,ht,ht,ct),this.#d(ct);const Z=(m,l)=>{const e=at[m]/255,n=ot[m]/255,a=new Array(l+1);for(let i=0;i<=l;i++)a[i]=e+i/l*(n-e);return a.join(",")};return this.#o(Z(0,5),Z(1,5),Z(2,5),ct),K.url=`url(#${ft})`,K.url}addHighlightHCMFilter(H,G,Y,Q,K){const at=`${G}-${Y}-${Q}-${K}`;let ot=this.#l.get(H);if(ot?.key===at||(ot?(ot.filter?.remove(),ot.key=at,ot.url="none",ot.filter=null):(ot={key:at,url:"none",filter:null},this.#l.set(H,ot)),!G||!Y))return ot.url;const[lt,ht]=[G,Y].map(this.#p.bind(this));let ft=Math.round(.2126*lt[0]+.7152*lt[1]+.0722*lt[2]),ct=Math.round(.2126*ht[0]+.7152*ht[1]+.0722*ht[2]),[Z,m]=[Q,K].map(this.#p.bind(this));ct<ft&&([ft,ct,Z,m]=[ct,ft,m,Z]),this.#h.style.color="";const l=(a,i,h)=>{const p=new Array(256),w=(ct-ft)/h,E=a/255,R=(i-a)/(255*h);let P=0;for(let L=0;L<=h;L++){const x=Math.round(ft+L*w),k=E+L*R;for(let D=P;D<=x;D++)p[D]=k;P=x+1}for(let L=P;L<256;L++)p[L]=p[P-1];return p.join(",")},e=`g_${this.#s}_hcm_${H}_filter`,n=ot.filter=this.#u(e);return this.#d(n),this.#o(l(Z[0],m[0],5),l(Z[1],m[1],5),l(Z[2],m[2],5),n),ot.url=`url(#${e})`,ot.url}destroy(H=!1){H&&this.#l.size!==0||(this.#e&&(this.#e.parentNode.parentNode.remove(),this.#e=null),this.#t&&(this.#t.clear(),this.#t=null),this.#i=0)}#d(H){const G=this.#n.createElementNS(_,"feColorMatrix");G.setAttribute("type","matrix"),G.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),H.append(G)}#u(H){const G=this.#n.createElementNS(_,"filter");return G.setAttribute("color-interpolation-filters","sRGB"),G.setAttribute("id",H),this.#h.append(G),G}#c(H,G,Y){const Q=this.#n.createElementNS(_,G);Q.setAttribute("type","discrete"),Q.setAttribute("tableValues",Y),H.append(Q)}#o(H,G,Y,Q){const K=this.#n.createElementNS(_,"feComponentTransfer");Q.append(K),this.#c(K,"feFuncR",H),this.#c(K,"feFuncG",G),this.#c(K,"feFuncB",Y)}#p(H){return this.#h.style.color=H,O(getComputedStyle(this.#h).getPropertyValue("color"))}}class C extends y.BaseCanvasFactory{constructor({ownerDocument:H=globalThis.document}={}){super(),this._document=H}_createCanvas(H,G){const Y=this._document.createElement("canvas");return Y.width=H,Y.height=G,Y}}async function T(X,H="text"){if(f(X,document.baseURI)){const G=await fetch(X);if(!G.ok)throw new Error(G.statusText);switch(H){case"arraybuffer":return G.arrayBuffer();case"blob":return G.blob();case"json":return G.json()}return G.text()}return new Promise((G,Y)=>{const Q=new XMLHttpRequest;Q.open("GET",X,!0),Q.responseType=H,Q.onreadystatechange=()=>{if(Q.readyState===XMLHttpRequest.DONE){if(Q.status===200||Q.status===0){switch(H){case"arraybuffer":case"blob":case"json":G(Q.response);return}G(Q.responseText);return}Y(new Error(Q.statusText))}},Q.send(null)})}class A extends y.BaseCMapReaderFactory{_fetchData(H,G){return T(H,this.isCompressed?"arraybuffer":"text").then(Y=>({cMapData:Y instanceof ArrayBuffer?new Uint8Array(Y):(0,z.stringToBytes)(Y),compressionType:G}))}}class o extends y.BaseStandardFontDataFactory{_fetchData(H){return T(H,"arraybuffer").then(G=>new Uint8Array(G))}}class d extends y.BaseSVGFactory{_createSVG(H){return document.createElementNS(_,H)}}class u{constructor({viewBox:H,scale:G,rotation:Y,offsetX:Q=0,offsetY:K=0,dontFlip:at=!1}){this.viewBox=H,this.scale=G,this.rotation=Y,this.offsetX=Q,this.offsetY=K;const ot=(H[2]+H[0])/2,lt=(H[3]+H[1])/2;let ht,ft,ct,Z;switch(Y%=360,Y<0&&(Y+=360),Y){case 180:ht=-1,ft=0,ct=0,Z=1;break;case 90:ht=0,ft=1,ct=1,Z=0;break;case 270:ht=0,ft=-1,ct=-1,Z=0;break;case 0:ht=1,ft=0,ct=0,Z=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}at&&(ct=-ct,Z=-Z);let m,l,e,n;ht===0?(m=Math.abs(lt-H[1])*G+Q,l=Math.abs(ot-H[0])*G+K,e=(H[3]-H[1])*G,n=(H[2]-H[0])*G):(m=Math.abs(ot-H[0])*G+Q,l=Math.abs(lt-H[1])*G+K,e=(H[2]-H[0])*G,n=(H[3]-H[1])*G),this.transform=[ht*G,ft*G,ct*G,Z*G,m-ht*G*ot-ct*G*lt,l-ft*G*ot-Z*G*lt],this.width=e,this.height=n}get rawDims(){const{viewBox:H}=this;return(0,z.shadow)(this,"rawDims",{pageWidth:H[2]-H[0],pageHeight:H[3]-H[1],pageX:H[0],pageY:H[1]})}clone({scale:H=this.scale,rotation:G=this.rotation,offsetX:Y=this.offsetX,offsetY:Q=this.offsetY,dontFlip:K=!1}={}){return new u({viewBox:this.viewBox.slice(),scale:H,rotation:G,offsetX:Y,offsetY:Q,dontFlip:K})}convertToViewportPoint(H,G){return z.Util.applyTransform([H,G],this.transform)}convertToViewportRectangle(H){const G=z.Util.applyTransform([H[0],H[1]],this.transform),Y=z.Util.applyTransform([H[2],H[3]],this.transform);return[G[0],G[1],Y[0],Y[1]]}convertToPdfPoint(H,G){return z.Util.applyInverseTransform([H,G],this.transform)}}class b extends z.BaseException{constructor(H,G=0){super(H,"RenderingCancelledException"),this.extraDelay=G}}function s(X){const H=X.length;let G=0;for(;G<H&&X[G].trim()==="";)G++;return X.substring(G,G+5).toLowerCase()==="data:"}function g(X){return typeof X=="string"&&/\.pdf$/i.test(X)}function t(X,H=!1){return H||([X]=X.split(/[#?]/,1)),X.substring(X.lastIndexOf("/")+1)}function r(X,H="document.pdf"){if(typeof X!="string")return H;if(s(X))return(0,z.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),H;const G=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,Y=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,Q=G.exec(X);let K=Y.exec(Q[1])||Y.exec(Q[2])||Y.exec(Q[3]);if(K&&(K=K[0],K.includes("%")))try{K=Y.exec(decodeURIComponent(K))[0]}catch{}return K||H}class c{started=Object.create(null);times=[];time(H){H in this.started&&(0,z.warn)(`Timer is already running for ${H}`),this.started[H]=Date.now()}timeEnd(H){H in this.started||(0,z.warn)(`Timer has not been started for ${H}`),this.times.push({name:H,start:this.started[H],end:Date.now()}),delete this.started[H]}toString(){const H=[];let G=0;for(const{name:Y}of this.times)G=Math.max(Y.length,G);for(const{name:Y,start:Q,end:K}of this.times)H.push(`${Y.padEnd(G)} ${K-Q}ms
`);return H.join("")}}function f(X,H){try{const{protocol:G}=H?new URL(X,H):new URL(X);return G==="http:"||G==="https:"}catch{return!1}}function v(X){X.preventDefault()}let S;class M{static toDateObject(H){if(!H||typeof H!="string")return null;S||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const G=S.exec(H);if(!G)return null;const Y=parseInt(G[1],10);let Q=parseInt(G[2],10);Q=Q>=1&&Q<=12?Q-1:0;let K=parseInt(G[3],10);K=K>=1&&K<=31?K:1;let at=parseInt(G[4],10);at=at>=0&&at<=23?at:0;let ot=parseInt(G[5],10);ot=ot>=0&&ot<=59?ot:0;let lt=parseInt(G[6],10);lt=lt>=0&&lt<=59?lt:0;const ht=G[7]||"Z";let ft=parseInt(G[8],10);ft=ft>=0&&ft<=23?ft:0;let ct=parseInt(G[9],10)||0;return ct=ct>=0&&ct<=59?ct:0,ht==="-"?(at+=ft,ot+=ct):ht==="+"&&(at-=ft,ot-=ct),new Date(Date.UTC(Y,Q,K,at,ot,lt))}}function I(X,{scale:H=1,rotation:G=0}){const{width:Y,height:Q}=X.attributes.style,K=[0,0,parseInt(Y),parseInt(Q)];return new u({viewBox:K,scale:H,rotation:G})}function O(X){if(X.startsWith("#")){const H=parseInt(X.slice(1),16);return[(H&16711680)>>16,(H&65280)>>8,H&255]}return X.startsWith("rgb(")?X.slice(4,-1).split(",").map(H=>parseInt(H)):X.startsWith("rgba(")?X.slice(5,-1).split(",").map(H=>parseInt(H)).slice(0,3):((0,z.warn)(`Not a valid color format: "${X}"`),[0,0,0])}function N(X){const H=document.createElement("span");H.style.visibility="hidden",document.body.append(H);for(const G of X.keys()){H.style.color=G;const Y=window.getComputedStyle(H).color;X.set(G,O(Y))}H.remove()}function B(X){const{a:H,b:G,c:Y,d:Q,e:K,f:at}=X.getTransform();return[H,G,Y,Q,K,at]}function q(X){const{a:H,b:G,c:Y,d:Q,e:K,f:at}=X.getTransform().invertSelf();return[H,G,Y,Q,K,at]}function st(X,H,G=!1,Y=!0){if(H instanceof u){const{pageWidth:Q,pageHeight:K}=H.rawDims,{style:at}=X,ot=z.FeatureTest.isCSSRoundSupported,lt=`var(--scale-factor) * ${Q}px`,ht=`var(--scale-factor) * ${K}px`,ft=ot?`round(${lt}, 1px)`:`calc(${lt})`,ct=ot?`round(${ht}, 1px)`:`calc(${ht})`;!G||H.rotation%180===0?(at.width=ft,at.height=ct):(at.width=ct,at.height=ft)}Y&&X.setAttribute("data-main-rotation",H.rotation)}},47:(dt,et,V)=>{V.d(et,{DrawLayer:()=>_});var y=V(419),z=V(292);class _{#t=null;#e=0;#s=new Map;#n=new Map;constructor({pageIndex:F}){this.pageIndex=F}setParent(F){if(!this.#t){this.#t=F;return}if(this.#t!==F){if(this.#s.size>0)for(const C of this.#s.values())C.remove(),F.append(C);this.#t=F}}static get _svgFactory(){return(0,z.shadow)(this,"_svgFactory",new y.DOMSVGFactory)}static#r(F,{x:C=0,y:T=0,width:A=1,height:o=1}={}){const{style:d}=F;d.top=`${100*T}%`,d.left=`${100*C}%`,d.width=`${100*A}%`,d.height=`${100*o}%`}#i(F){const C=_._svgFactory.create(1,1,!0);return this.#t.append(C),C.setAttribute("aria-hidden",!0),_.#r(C,F),C}#a(F,C){const T=_._svgFactory.createElement("clipPath");F.append(T);const A=`clip_${C}`;T.setAttribute("id",A),T.setAttribute("clipPathUnits","objectBoundingBox");const o=_._svgFactory.createElement("use");return T.append(o),o.setAttribute("href",`#${C}`),o.classList.add("clip"),A}highlight(F,C,T,A=!1){const o=this.#e++,d=this.#i(F.box);d.classList.add("highlight"),F.free&&d.classList.add("free");const u=_._svgFactory.createElement("defs");d.append(u);const b=_._svgFactory.createElement("path");u.append(b);const s=`path_p${this.pageIndex}_${o}`;b.setAttribute("id",s),b.setAttribute("d",F.toSVGPath()),A&&this.#n.set(o,b);const g=this.#a(u,s),t=_._svgFactory.createElement("use");return d.append(t),d.setAttribute("fill",C),d.setAttribute("fill-opacity",T),t.setAttribute("href",`#${s}`),this.#s.set(o,d),{id:o,clipPathId:`url(#${g})`}}highlightOutline(F){const C=this.#e++,T=this.#i(F.box);T.classList.add("highlightOutline");const A=_._svgFactory.createElement("defs");T.append(A);const o=_._svgFactory.createElement("path");A.append(o);const d=`path_p${this.pageIndex}_${C}`;o.setAttribute("id",d),o.setAttribute("d",F.toSVGPath()),o.setAttribute("vector-effect","non-scaling-stroke");let u;if(F.free){T.classList.add("free");const g=_._svgFactory.createElement("mask");A.append(g),u=`mask_p${this.pageIndex}_${C}`,g.setAttribute("id",u),g.setAttribute("maskUnits","objectBoundingBox");const t=_._svgFactory.createElement("rect");g.append(t),t.setAttribute("width","1"),t.setAttribute("height","1"),t.setAttribute("fill","white");const r=_._svgFactory.createElement("use");g.append(r),r.setAttribute("href",`#${d}`),r.setAttribute("stroke","none"),r.setAttribute("fill","black"),r.setAttribute("fill-rule","nonzero"),r.classList.add("mask")}const b=_._svgFactory.createElement("use");T.append(b),b.setAttribute("href",`#${d}`),u&&b.setAttribute("mask",`url(#${u})`);const s=b.cloneNode();return T.append(s),b.classList.add("mainOutline"),s.classList.add("secondaryOutline"),this.#s.set(C,T),C}finalizeLine(F,C){const T=this.#n.get(F);this.#n.delete(F),this.updateBox(F,C.box),T.setAttribute("d",C.toSVGPath())}updateLine(F,C){this.#s.get(F).firstChild.firstChild.setAttribute("d",C.toSVGPath())}removeFreeHighlight(F){this.remove(F),this.#n.delete(F)}updatePath(F,C){this.#n.get(F).setAttribute("d",C.toSVGPath())}updateBox(F,C){_.#r(this.#s.get(F),C)}show(F,C){this.#s.get(F).classList.toggle("hidden",!C)}rotate(F,C){this.#s.get(F).setAttribute("data-main-rotation",C)}changeColor(F,C){this.#s.get(F).setAttribute("fill",C)}changeOpacity(F,C){this.#s.get(F).setAttribute("fill-opacity",C)}addClass(F,C){this.#s.get(F).classList.add(C)}removeClass(F,C){this.#s.get(F).classList.remove(C)}remove(F){this.#t!==null&&(this.#s.get(F).remove(),this.#s.delete(F))}destroy(){this.#t=null;for(const F of this.#s.values())F.remove();this.#s.clear()}}},731:(dt,et,V)=>{V.d(et,{AnnotationEditorLayer:()=>s});var y=V(292),z=V(310),_=V(830),U=V(976);const F=/\r\n?|\n/g;class C extends z.AnnotationEditor{#t=this.editorDivBlur.bind(this);#e=this.editorDivFocus.bind(this);#s=this.editorDivInput.bind(this);#n=this.editorDivKeydown.bind(this);#r=this.editorDivPaste.bind(this);#i;#a="";#l=`${this.id}-editor`;#h;#d=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const t=C.prototype,r=v=>v.isEmpty(),c=_.AnnotationEditorUIManager.TRANSLATE_SMALL,f=_.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,y.shadow)(this,"_keyboardManager",new _.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-c,0],checker:r}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-f,0],checker:r}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[c,0],checker:r}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[f,0],checker:r}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-c],checker:r}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-f],checker:r}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,c],checker:r}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,f],checker:r}]]))}static _type="freetext";static _editorType=y.AnnotationEditorType.FREETEXT;constructor(t){super({...t,name:"freeTextEditor"}),this.#i=t.color||C._defaultColor||z.AnnotationEditor._defaultLineColor,this.#h=t.fontSize||C._defaultFontSize}static initialize(t,r){z.AnnotationEditor.initialize(t,r,{strings:["pdfjs-free-text-default-content"]});const c=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(c.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,r){switch(t){case y.AnnotationEditorParamsType.FREETEXT_SIZE:C._defaultFontSize=r;break;case y.AnnotationEditorParamsType.FREETEXT_COLOR:C._defaultColor=r;break}}updateParams(t,r){switch(t){case y.AnnotationEditorParamsType.FREETEXT_SIZE:this.#u(r);break;case y.AnnotationEditorParamsType.FREETEXT_COLOR:this.#c(r);break}}static get defaultPropertiesToUpdate(){return[[y.AnnotationEditorParamsType.FREETEXT_SIZE,C._defaultFontSize],[y.AnnotationEditorParamsType.FREETEXT_COLOR,C._defaultColor||z.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[y.AnnotationEditorParamsType.FREETEXT_SIZE,this.#h],[y.AnnotationEditorParamsType.FREETEXT_COLOR,this.#i]]}#u(t){const r=f=>{this.editorDiv.style.fontSize=`calc(${f}px * var(--scale-factor))`,this.translate(0,-(f-this.#h)*this.parentScale),this.#h=f,this.#p()},c=this.#h;this.addCommands({cmd:r.bind(this,t),undo:r.bind(this,c),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:y.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#c(t){const r=f=>{this.#i=this.editorDiv.style.color=f},c=this.#i;this.addCommands({cmd:r.bind(this,t),undo:r.bind(this,c),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:y.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,r){this._uiManager.translateSelectedEditors(t,r,!0)}getInitialTranslation(){const t=this.parentScale;return[-C._internalPadding*t,-(C._internalPadding+this.#h)*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(y.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",this.#n),this.editorDiv.addEventListener("focus",this.#e),this.editorDiv.addEventListener("blur",this.#t),this.editorDiv.addEventListener("input",this.#s),this.editorDiv.addEventListener("paste",this.#r))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#l),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",this.#n),this.editorDiv.removeEventListener("focus",this.#e),this.editorDiv.removeEventListener("blur",this.#t),this.editorDiv.removeEventListener("input",this.#s),this.editorDiv.removeEventListener("paste",this.#r),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){this.width||(this.enableEditMode(),this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#o(){const t=[];this.editorDiv.normalize();for(const r of this.editorDiv.childNodes)t.push(C.#g(r));return t.join(`
`)}#p(){const[t,r]=this.parentDimensions;let c;if(this.isAttachedToDOM)c=this.div.getBoundingClientRect();else{const{currentLayer:f,div:v}=this,S=v.style.display;v.style.display="hidden",f.div.append(this.div),c=v.getBoundingClientRect(),v.remove(),v.style.display=S}this.rotation%180===this.parentRotation%180?(this.width=c.width/t,this.height=c.height/r):(this.width=c.height/t,this.height=c.width/r),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=this.#a,r=this.#a=this.#o().trimEnd();if(t===r)return;const c=f=>{if(this.#a=f,!f){this.remove();return}this.#f(),this._uiManager.rebuild(this),this.#p()};this.addCommands({cmd:()=>{c(r)},undo:()=>{c(t)},mustExec:!1}),this.#p()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){C._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let t,r;this.width&&(t=this.x,r=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#l),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text"),this.enableEditing(),z.AnnotationEditor._l10nPromise.get("pdfjs-free-text-default-content").then(f=>this.editorDiv?.setAttribute("default-content",f)),this.editorDiv.contentEditable=!0;const{style:c}=this.editorDiv;if(c.fontSize=`calc(${this.#h}px * var(--scale-factor))`,c.color=this.#i,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,_.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[f,v]=this.parentDimensions;if(this.annotationElementId){const{position:S}=this.#d;let[M,I]=this.getInitialTranslation();[M,I]=this.pageTranslationToScreen(M,I);const[O,N]=this.pageDimensions,[B,q]=this.pageTranslation;let st,X;switch(this.rotation){case 0:st=t+(S[0]-B)/O,X=r+this.height-(S[1]-q)/N;break;case 90:st=t+(S[0]-B)/O,X=r-(S[1]-q)/N,[M,I]=[I,-M];break;case 180:st=t-this.width+(S[0]-B)/O,X=r-(S[1]-q)/N,[M,I]=[-M,-I];break;case 270:st=t+(S[0]-B-this.height*N)/O,X=r+(S[1]-q-this.width*O)/N,[M,I]=[-I,M];break}this.setAt(st*f,X*v,M,I)}else this.setAt(t*f,r*v,this.width*f,this.height*v);this.#f(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#g(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(F,"")}editorDivPaste(t){const r=t.clipboardData||window.clipboardData,{types:c}=r;if(c.length===1&&c[0]==="text/plain")return;t.preventDefault();const f=C.#b(r.getData("text")||"").replaceAll(F,`
`);if(!f)return;const v=window.getSelection();if(!v.rangeCount)return;this.editorDiv.normalize(),v.deleteFromDocument();const S=v.getRangeAt(0);if(!f.includes(`
`)){S.insertNode(document.createTextNode(f)),this.editorDiv.normalize(),v.collapseToStart();return}const{startContainer:M,startOffset:I}=S,O=[],N=[];if(M.nodeType===Node.TEXT_NODE){const st=M.parentElement;if(N.push(M.nodeValue.slice(I).replaceAll(F,"")),st!==this.editorDiv){let X=O;for(const H of this.editorDiv.childNodes){if(H===st){X=N;continue}X.push(C.#g(H))}}O.push(M.nodeValue.slice(0,I).replaceAll(F,""))}else if(M===this.editorDiv){let st=O,X=0;for(const H of this.editorDiv.childNodes)X++===I&&(st=N),st.push(C.#g(H))}this.#a=`${O.join(`
`)}${f}${N.join(`
`)}`,this.#f();const B=new Range;let q=O.reduce((st,X)=>st+X.length,0);for(const{firstChild:st}of this.editorDiv.childNodes)if(st.nodeType===Node.TEXT_NODE){const X=st.nodeValue.length;if(q<=X){B.setStart(st,q),B.setEnd(st,q);break}q-=X}v.removeAllRanges(),v.addRange(B)}#f(){if(this.editorDiv.replaceChildren(),!!this.#a)for(const t of this.#a.split(`
`)){const r=document.createElement("div");r.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(r)}}#m(){return this.#a.replaceAll(" "," ")}static#b(t){return t.replaceAll(" "," ")}get contentDiv(){return this.editorDiv}static deserialize(t,r,c){let f=null;if(t instanceof U.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:S,fontColor:M},rect:I,rotation:O,id:N},textContent:B,textPosition:q,parent:{page:{pageNumber:st}}}=t;if(!B||B.length===0)return null;f=t={annotationType:y.AnnotationEditorType.FREETEXT,color:Array.from(M),fontSize:S,value:B.join(`
`),position:q,pageIndex:st-1,rect:I,rotation:O,id:N,deleted:!1}}const v=super.deserialize(t,r,c);return v.#h=t.fontSize,v.#i=y.Util.makeHexColor(...t.color),v.#a=C.#b(t.value),v.annotationElementId=t.id||null,v.#d=f,v}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const r=C._internalPadding*this.parentScale,c=this.getRect(r,r),f=z.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#i),v={annotationType:y.AnnotationEditorType.FREETEXT,color:f,fontSize:this.#h,value:this.#m(),pageIndex:this.pageIndex,rect:c,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?v:this.annotationElementId&&!this.#A(v)?null:(v.id=this.annotationElementId,v)}#A(t){const{value:r,fontSize:c,color:f,pageIndex:v}=this.#d;return this._hasBeenMoved||t.value!==r||t.fontSize!==c||t.color.some((S,M)=>S!==f[M])||t.pageIndex!==v}}var T=V(61),A=V(259),o=V(419);class d extends z.AnnotationEditor{#t=null;#e=0;#s;#n=null;#r=null;#i=null;#a=null;#l=0;#h=null;#d=null;#u=null;#c=!1;#o=this.#T.bind(this);#p=null;#g;#f=null;#m="";#b;#A="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _l10nPromise;static _type="highlight";static _editorType=y.AnnotationEditorType.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const t=d.prototype;return(0,y.shadow)(this,"_keyboardManager",new _.KeyboardManager([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"}),this.color=t.color||d._defaultColor,this.#b=t.thickness||d._defaultThickness,this.#g=t.opacity||d._defaultOpacity,this.#s=t.boxes||null,this.#A=t.methodOfCreation||"",this.#m=t.text||"",this._isDraggable=!1,t.highlightId>-1?(this.#c=!0,this.#E(t),this.#S()):(this.#t=t.anchorNode,this.#e=t.anchorOffset,this.#a=t.focusNode,this.#l=t.focusOffset,this.#w(),this.#S(),this.rotate(this.rotation))}get telemetryInitialData(){return{action:"added",type:this.#c?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:this.#b,methodOfCreation:this.#A}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#w(){const t=new T.Outliner(this.#s,.001);this.#d=t.getOutlines(),{x:this.x,y:this.y,width:this.width,height:this.height}=this.#d.box;const r=new T.Outliner(this.#s,.0025,.001,this._uiManager.direction==="ltr");this.#i=r.getOutlines();const{lastPoint:c}=this.#i.box;this.#p=[(c[0]-this.x)/this.width,(c[1]-this.y)/this.height]}#E({highlightOutlines:t,highlightId:r,clipPathId:c}){this.#d=t;const f=1.5;if(this.#i=t.getNewOutline(this.#b/2+f,.0025),r>=0)this.#u=r,this.#n=c,this.parent.drawLayer.finalizeLine(r,t),this.#f=this.parent.drawLayer.highlightOutline(this.#i);else if(this.parent){const N=this.parent.viewport.rotation;this.parent.drawLayer.updateLine(this.#u,t),this.parent.drawLayer.updateBox(this.#u,d.#x(this.#d.box,(N-this.rotation+360)%360)),this.parent.drawLayer.updateLine(this.#f,this.#i),this.parent.drawLayer.updateBox(this.#f,d.#x(this.#i.box,N))}const{x:v,y:S,width:M,height:I}=t.box;switch(this.rotation){case 0:this.x=v,this.y=S,this.width=M,this.height=I;break;case 90:{const[N,B]=this.parentDimensions;this.x=S,this.y=1-v,this.width=M*B/N,this.height=I*N/B;break}case 180:this.x=1-v,this.y=1-S,this.width=M,this.height=I;break;case 270:{const[N,B]=this.parentDimensions;this.x=1-S,this.y=v,this.width=M*B/N,this.height=I*N/B;break}}const{lastPoint:O}=this.#i.box;this.#p=[(O[0]-v)/M,(O[1]-S)/I]}static initialize(t,r){z.AnnotationEditor.initialize(t,r),d._defaultColor||=r.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,r){switch(t){case y.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR:d._defaultColor=r;break;case y.AnnotationEditorParamsType.HIGHLIGHT_THICKNESS:d._defaultThickness=r;break}}translateInPage(t,r){}get toolbarPosition(){return this.#p}updateParams(t,r){switch(t){case y.AnnotationEditorParamsType.HIGHLIGHT_COLOR:this.#L(r);break;case y.AnnotationEditorParamsType.HIGHLIGHT_THICKNESS:this.#M(r);break}}static get defaultPropertiesToUpdate(){return[[y.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR,d._defaultColor],[y.AnnotationEditorParamsType.HIGHLIGHT_THICKNESS,d._defaultThickness]]}get propertiesToUpdate(){return[[y.AnnotationEditorParamsType.HIGHLIGHT_COLOR,this.color||d._defaultColor],[y.AnnotationEditorParamsType.HIGHLIGHT_THICKNESS,this.#b||d._defaultThickness],[y.AnnotationEditorParamsType.HIGHLIGHT_FREE,this.#c]]}#L(t){const r=f=>{this.color=f,this.parent?.drawLayer.changeColor(this.#u,f),this.#r?.updateColor(f)},c=this.color;this.addCommands({cmd:r.bind(this,t),undo:r.bind(this,c),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:y.AnnotationEditorParamsType.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)}#M(t){const r=this.#b,c=f=>{this.#b=f,this.#y(f)};this.addCommands({cmd:c.bind(this,t),undo:c.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:y.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}async addEditToolbar(){const t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(this.#r=new A.ColorPicker({editor:this}),t.addColorPicker(this.#r)),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#k())}getBaseTranslation(){return[0,0]}getRect(t,r){return super.getRect(t,r,this.#k())}onceAdded(){this.parent.addUndoableEditor(this),this.div.focus()}remove(){this.#v(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#S(),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let r=!1;this.parent&&!t?this.#v():t&&(this.#S(t),r=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),r&&this.select()}#y(t){if(!this.#c)return;this.#E({highlightOutlines:this.#d.getNewOutline(t/2)}),this.fixAndSetPosition();const[r,c]=this.parentDimensions;this.setDims(this.width*r,this.height*c)}#v(){this.#u===null||!this.parent||(this.parent.drawLayer.remove(this.#u),this.#u=null,this.parent.drawLayer.remove(this.#f),this.#f=null)}#S(t=this.parent){this.#u===null&&({id:this.#u,clipPathId:this.#n}=t.drawLayer.highlight(this.#d,this.color,this.#g),this.#f=t.drawLayer.highlightOutline(this.#i),this.#h&&(this.#h.style.clipPath=this.#n))}static#x({x:t,y:r,width:c,height:f},v){switch(v){case 90:return{x:1-r-f,y:t,width:f,height:c};case 180:return{x:1-t-c,y:1-r-f,width:c,height:f};case 270:return{x:r,y:1-t-c,width:f,height:c}}return{x:t,y:r,width:c,height:f}}rotate(t){const{drawLayer:r}=this.parent;let c;this.#c?(t=(t-this.rotation+360)%360,c=d.#x(this.#d.box,t)):c=d.#x(this,t),r.rotate(this.#u,t),r.rotate(this.#f,t),r.updateBox(this.#u,c),r.updateBox(this.#f,d.#x(this.#i.box,t))}render(){if(this.div)return this.div;const t=super.render();this.#m&&(t.setAttribute("aria-label",this.#m),t.setAttribute("role","mark")),this.#c?t.classList.add("free"):this.div.addEventListener("keydown",this.#o);const r=this.#h=document.createElement("div");t.append(r),r.setAttribute("aria-hidden","true"),r.className="internal",r.style.clipPath=this.#n;const[c,f]=this.parentDimensions;return this.setDims(this.width*c,this.height*f),(0,_.bindEvents)(this,this.#h,["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.parent.drawLayer.addClass(this.#f,"hovered")}pointerleave(){this.parent.drawLayer.removeClass(this.#f,"hovered")}#T(t){d._keyboardManager.exec(this,t)}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:this.#F(!0);break;case 1:case 3:this.#F(!1);break}}#F(t){if(!this.#t)return;const r=window.getSelection();t?r.setPosition(this.#t,this.#e):r.setPosition(this.#a,this.#l)}select(){super.select(),this.#f&&(this.parent?.drawLayer.removeClass(this.#f,"hovered"),this.parent?.drawLayer.addClass(this.#f,"selected"))}unselect(){super.unselect(),this.#f&&(this.parent?.drawLayer.removeClass(this.#f,"selected"),this.#c||this.#F(!1))}get _mustFixPosition(){return!this.#c}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.show(this.#u,t),this.parent.drawLayer.show(this.#f,t))}#k(){return this.#c?this.rotation:0}#I(){if(this.#c)return null;const[t,r]=this.pageDimensions,c=this.#s,f=new Array(c.length*8);let v=0;for(const{x:S,y:M,width:I,height:O}of c){const N=S*t,B=(1-M-O)*r;f[v]=f[v+4]=N,f[v+1]=f[v+3]=B,f[v+2]=f[v+6]=N+I*t,f[v+5]=f[v+7]=B+O*r,v+=8}return f}#R(t){return this.#d.serialize(t,this.#k())}static startHighlighting(t,r,{target:c,x:f,y:v}){const{x:S,y:M,width:I,height:O}=c.getBoundingClientRect(),N=X=>{this.#_(t,X)},B={capture:!0,passive:!1},q=X=>{X.preventDefault(),X.stopPropagation()},st=X=>{c.removeEventListener("pointermove",N),window.removeEventListener("blur",st),window.removeEventListener("pointerup",st),window.removeEventListener("pointerdown",q,B),window.removeEventListener("contextmenu",o.noContextMenu),this.#P(t,X)};window.addEventListener("blur",st),window.addEventListener("pointerup",st),window.addEventListener("pointerdown",q,B),window.addEventListener("contextmenu",o.noContextMenu),c.addEventListener("pointermove",N),this._freeHighlight=new T.FreeOutliner({x:f,y:v},[S,M,I,O],t.scale,this._defaultThickness/2,r,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.highlight(this._freeHighlight,this._defaultColor,this._defaultOpacity,!0)}static#_(t,r){this._freeHighlight.add(r)&&t.drawLayer.updatePath(this._freeHighlightId,this._freeHighlight)}static#P(t,r){this._freeHighlight.isEmpty()?t.drawLayer.removeFreeHighlight(this._freeHighlightId):t.createAndAddNewEditor(r,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static deserialize(t,r,c){const f=super.deserialize(t,r,c),{rect:[v,S,M,I],color:O,quadPoints:N}=t;f.color=y.Util.makeHexColor(...O),f.#g=t.opacity;const[B,q]=f.pageDimensions;f.width=(M-v)/B,f.height=(I-S)/q;const st=f.#s=[];for(let X=0;X<N.length;X+=8)st.push({x:(N[4]-M)/B,y:(I-(1-N[X+5]))/q,width:(N[X+2]-N[X])/B,height:(N[X+5]-N[X+1])/q});return f.#w(),f}serialize(t=!1){if(this.isEmpty()||t)return null;const r=this.getRect(0,0),c=z.AnnotationEditor._colorManager.convert(this.color);return{annotationType:y.AnnotationEditorType.HIGHLIGHT,color:c,opacity:this.#g,thickness:this.#b,quadPoints:this.#I(),outlines:this.#R(r),pageIndex:this.pageIndex,rect:r,rotation:this.#k(),structTreeParentId:this._structTreeParentId}}static canCreateNewEmptyEditor(){return!1}}class u extends z.AnnotationEditor{#t=0;#e=0;#s=this.canvasPointermove.bind(this);#n=this.canvasPointerleave.bind(this);#r=this.canvasPointerup.bind(this);#i=this.canvasPointerdown.bind(this);#a=null;#l=new Path2D;#h=!1;#d=!1;#u=!1;#c=null;#o=0;#p=0;#g=null;static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=1;static _type="ink";static _editorType=y.AnnotationEditorType.INK;constructor(t){super({...t,name:"inkEditor"}),this.color=t.color||null,this.thickness=t.thickness||null,this.opacity=t.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(t,r){z.AnnotationEditor.initialize(t,r)}static updateDefaultParams(t,r){switch(t){case y.AnnotationEditorParamsType.INK_THICKNESS:u._defaultThickness=r;break;case y.AnnotationEditorParamsType.INK_COLOR:u._defaultColor=r;break;case y.AnnotationEditorParamsType.INK_OPACITY:u._defaultOpacity=r/100;break}}updateParams(t,r){switch(t){case y.AnnotationEditorParamsType.INK_THICKNESS:this.#f(r);break;case y.AnnotationEditorParamsType.INK_COLOR:this.#m(r);break;case y.AnnotationEditorParamsType.INK_OPACITY:this.#b(r);break}}static get defaultPropertiesToUpdate(){return[[y.AnnotationEditorParamsType.INK_THICKNESS,u._defaultThickness],[y.AnnotationEditorParamsType.INK_COLOR,u._defaultColor||z.AnnotationEditor._defaultLineColor],[y.AnnotationEditorParamsType.INK_OPACITY,Math.round(u._defaultOpacity*100)]]}get propertiesToUpdate(){return[[y.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||u._defaultThickness],[y.AnnotationEditorParamsType.INK_COLOR,this.color||u._defaultColor||z.AnnotationEditor._defaultLineColor],[y.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??u._defaultOpacity))]]}#f(t){const r=f=>{this.thickness=f,this.#N()},c=this.thickness;this.addCommands({cmd:r.bind(this,t),undo:r.bind(this,c),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:y.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}#m(t){const r=f=>{this.color=f,this.#T()},c=this.color;this.addCommands({cmd:r.bind(this,t),undo:r.bind(this,c),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:y.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}#b(t){const r=f=>{this.opacity=f,this.#T()};t/=100;const c=this.opacity;this.addCommands({cmd:r.bind(this,t),undo:r.bind(this,c),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:y.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(this.#k(),this.#I()),this.isAttachedToDOM||(this.parent.add(this),this.#R()),this.#N()))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,this.#a&&(clearTimeout(this.#a),this.#a=null),this.#c.disconnect(),this.#c=null,super.remove())}setParent(t){!this.parent&&t?this._uiManager.removeShouldRescale(this):this.parent&&t===null&&this._uiManager.addShouldRescale(this),super.setParent(t)}onScaleChanging(){const[t,r]=this.parentDimensions,c=this.width*t,f=this.height*r;this.setDimensions(c,f)}enableEditMode(){this.#h||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",this.#i))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",this.#i))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}#A(){const{parentRotation:t,parentDimensions:[r,c]}=this;switch(t){case 90:return[0,c,c,r];case 180:return[r,c,r,c];case 270:return[r,0,c,r];default:return[0,0,r,c]}}#w(){const{ctx:t,color:r,opacity:c,thickness:f,parentScale:v,scaleFactor:S}=this;t.lineWidth=f*v/S,t.lineCap="round",t.lineJoin="round",t.miterLimit=10,t.strokeStyle=`${r}${(0,_.opacityToHex)(c)}`}#E(t,r){this.canvas.addEventListener("contextmenu",o.noContextMenu),this.canvas.addEventListener("pointerleave",this.#n),this.canvas.addEventListener("pointermove",this.#s),this.canvas.addEventListener("pointerup",this.#r),this.canvas.removeEventListener("pointerdown",this.#i),this.isEditing=!0,this.#u||(this.#u=!0,this.#R(),this.thickness||=u._defaultThickness,this.color||=u._defaultColor||z.AnnotationEditor._defaultLineColor,this.opacity??=u._defaultOpacity),this.currentPath.push([t,r]),this.#d=!1,this.#w(),this.#g=()=>{this.#v(),this.#g&&window.requestAnimationFrame(this.#g)},window.requestAnimationFrame(this.#g)}#L(t,r){const[c,f]=this.currentPath.at(-1);if(this.currentPath.length>1&&t===c&&r===f)return;const v=this.currentPath;let S=this.#l;if(v.push([t,r]),this.#d=!0,v.length<=2){S.moveTo(...v[0]),S.lineTo(t,r);return}v.length===3&&(this.#l=S=new Path2D,S.moveTo(...v[0])),this.#S(S,...v.at(-3),...v.at(-2),t,r)}#M(){if(this.currentPath.length===0)return;const t=this.currentPath.at(-1);this.#l.lineTo(...t)}#y(t,r){this.#g=null,t=Math.min(Math.max(t,0),this.canvas.width),r=Math.min(Math.max(r,0),this.canvas.height),this.#L(t,r),this.#M();let c;if(this.currentPath.length!==1)c=this.#x();else{const I=[t,r];c=[[I,I.slice(),I.slice(),I]]}const f=this.#l,v=this.currentPath;this.currentPath=[],this.#l=new Path2D;const S=()=>{this.allRawPaths.push(v),this.paths.push(c),this.bezierPath2D.push(f),this._uiManager.rebuild(this)},M=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(this.#k(),this.#I()),this.#N())};this.addCommands({cmd:S,undo:M,mustExec:!0})}#v(){if(!this.#d)return;this.#d=!1;const t=Math.ceil(this.thickness*this.parentScale),r=this.currentPath.slice(-3),c=r.map(S=>S[0]),f=r.map(S=>S[1]);Math.min(...c)-t,Math.max(...c)+t,Math.min(...f)-t,Math.max(...f)+t;const{ctx:v}=this;v.save(),v.clearRect(0,0,this.canvas.width,this.canvas.height);for(const S of this.bezierPath2D)v.stroke(S);v.stroke(this.#l),v.restore()}#S(t,r,c,f,v,S,M){const I=(r+f)/2,O=(c+v)/2,N=(f+S)/2,B=(v+M)/2;t.bezierCurveTo(I+2*(f-I)/3,O+2*(v-O)/3,N+2*(f-N)/3,B+2*(v-B)/3,N,B)}#x(){const t=this.currentPath;if(t.length<=2)return[[t[0],t[0],t.at(-1),t.at(-1)]];const r=[];let c,[f,v]=t[0];for(c=1;c<t.length-2;c++){const[q,st]=t[c],[X,H]=t[c+1],G=(q+X)/2,Y=(st+H)/2,Q=[f+2*(q-f)/3,v+2*(st-v)/3],K=[G+2*(q-G)/3,Y+2*(st-Y)/3];r.push([[f,v],Q,K,[G,Y]]),[f,v]=[G,Y]}const[S,M]=t[c],[I,O]=t[c+1],N=[f+2*(S-f)/3,v+2*(M-v)/3],B=[I+2*(S-I)/3,O+2*(M-O)/3];return r.push([[f,v],N,B,[I,O]]),r}#T(){if(this.isEmpty()){this.#P();return}this.#w();const{canvas:t,ctx:r}=this;r.setTransform(1,0,0,1,0,0),r.clearRect(0,0,t.width,t.height),this.#P();for(const c of this.bezierPath2D)r.stroke(c)}commit(){this.#h||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),this.#h=!0,this.div.classList.add("disabled"),this.#N(!0),this.select(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),this.enableEditMode())}canvasPointerdown(t){t.button!==0||!this.isInEditMode()||this.#h||(this.setInForeground(),t.preventDefault(),this.div.contains(document.activeElement)||this.div.focus({preventScroll:!0}),this.#E(t.offsetX,t.offsetY))}canvasPointermove(t){t.preventDefault(),this.#L(t.offsetX,t.offsetY)}canvasPointerup(t){t.preventDefault(),this.#F(t)}canvasPointerleave(t){this.#F(t)}#F(t){this.canvas.removeEventListener("pointerleave",this.#n),this.canvas.removeEventListener("pointermove",this.#s),this.canvas.removeEventListener("pointerup",this.#r),this.canvas.addEventListener("pointerdown",this.#i),this.#a&&clearTimeout(this.#a),this.#a=setTimeout(()=>{this.#a=null,this.canvas.removeEventListener("contextmenu",o.noContextMenu)},10),this.#y(t.offsetX,t.offsetY),this.addToAnnotationStorage(),this.setInBackground()}#k(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",this.canvas.setAttribute("data-l10n-id","pdfjs-ink-canvas"),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}#I(){this.#c=new ResizeObserver(t=>{const r=t[0].contentRect;r.width&&r.height&&this.setDimensions(r.width,r.height)}),this.#c.observe(this.div)}get isResizable(){return!this.isEmpty()&&this.#h}render(){if(this.div)return this.div;let t,r;this.width&&(t=this.x,r=this.y),super.render(),this.div.setAttribute("data-l10n-id","pdfjs-ink");const[c,f,v,S]=this.#A();if(this.setAt(c,f,0,0),this.setDims(v,S),this.#k(),this.width){const[M,I]=this.parentDimensions;this.setAspectRatio(this.width*M,this.height*I),this.setAt(t*M,r*I,this.width*M,this.height*I),this.#u=!0,this.#R(),this.setDims(this.width*M,this.height*I),this.#T(),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return this.#I(),this.div}#R(){if(!this.#u)return;const[t,r]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*t),this.canvas.height=Math.ceil(this.height*r),this.#P()}setDimensions(t,r){const c=Math.round(t),f=Math.round(r);if(this.#o===c&&this.#p===f)return;this.#o=c,this.#p=f,this.canvas.style.visibility="hidden";const[v,S]=this.parentDimensions;this.width=t/v,this.height=r/S,this.fixAndSetPosition(),this.#h&&this.#_(t,r),this.#R(),this.#T(),this.canvas.style.visibility="visible",this.fixDims()}#_(t,r){const c=this.#B(),f=(t-c)/this.#e,v=(r-c)/this.#t;this.scaleFactor=Math.min(f,v)}#P(){const t=this.#B()/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+t,this.translationY*this.scaleFactor+t)}static#D(t){const r=new Path2D;for(let c=0,f=t.length;c<f;c++){const[v,S,M,I]=t[c];c===0&&r.moveTo(...v),r.bezierCurveTo(S[0],S[1],M[0],M[1],I[0],I[1])}return r}static#G(t,r,c){const[f,v,S,M]=r;switch(c){case 0:for(let I=0,O=t.length;I<O;I+=2)t[I]+=f,t[I+1]=M-t[I+1];break;case 90:for(let I=0,O=t.length;I<O;I+=2){const N=t[I];t[I]=t[I+1]+f,t[I+1]=N+v}break;case 180:for(let I=0,O=t.length;I<O;I+=2)t[I]=S-t[I],t[I+1]+=v;break;case 270:for(let I=0,O=t.length;I<O;I+=2){const N=t[I];t[I]=S-t[I+1],t[I+1]=M-N}break;default:throw new Error("Invalid rotation")}return t}static#$(t,r,c){const[f,v,S,M]=r;switch(c){case 0:for(let I=0,O=t.length;I<O;I+=2)t[I]-=f,t[I+1]=M-t[I+1];break;case 90:for(let I=0,O=t.length;I<O;I+=2){const N=t[I];t[I]=t[I+1]-v,t[I+1]=N-f}break;case 180:for(let I=0,O=t.length;I<O;I+=2)t[I]=S-t[I],t[I+1]-=v;break;case 270:for(let I=0,O=t.length;I<O;I+=2){const N=t[I];t[I]=M-t[I+1],t[I+1]=S-N}break;default:throw new Error("Invalid rotation")}return t}#X(t,r,c,f){const v=[],S=this.thickness/2,M=t*r+S,I=t*c+S;for(const O of this.paths){const N=[],B=[];for(let q=0,st=O.length;q<st;q++){const[X,H,G,Y]=O[q];if(X[0]===Y[0]&&X[1]===Y[1]&&st===1){const Z=t*X[0]+M,m=t*X[1]+I;N.push(Z,m),B.push(Z,m);break}const Q=t*X[0]+M,K=t*X[1]+I,at=t*H[0]+M,ot=t*H[1]+I,lt=t*G[0]+M,ht=t*G[1]+I,ft=t*Y[0]+M,ct=t*Y[1]+I;q===0&&(N.push(Q,K),B.push(Q,K)),N.push(at,ot,lt,ht,ft,ct),B.push(at,ot),q===st-1&&B.push(ft,ct)}v.push({bezier:u.#G(N,f,this.rotation),points:u.#G(B,f,this.rotation)})}return v}#U(){let t=1/0,r=-1/0,c=1/0,f=-1/0;for(const v of this.paths)for(const[S,M,I,O]of v){const N=y.Util.bezierBoundingBox(...S,...M,...I,...O);t=Math.min(t,N[0]),c=Math.min(c,N[1]),r=Math.max(r,N[2]),f=Math.max(f,N[3])}return[t,c,r,f]}#B(){return this.#h?Math.ceil(this.thickness*this.parentScale):0}#N(t=!1){if(this.isEmpty())return;if(!this.#h){this.#T();return}const r=this.#U(),c=this.#B();this.#e=Math.max(z.AnnotationEditor.MIN_SIZE,r[2]-r[0]),this.#t=Math.max(z.AnnotationEditor.MIN_SIZE,r[3]-r[1]);const f=Math.ceil(c+this.#e*this.scaleFactor),v=Math.ceil(c+this.#t*this.scaleFactor),[S,M]=this.parentDimensions;this.width=f/S,this.height=v/M,this.setAspectRatio(f,v);const I=this.translationX,O=this.translationY;this.translationX=-r[0],this.translationY=-r[1],this.#R(),this.#T(),this.#o=f,this.#p=v,this.setDims(f,v);const N=t?c/this.scaleFactor/2:0;this.translate(I-this.translationX-N,O-this.translationY-N)}static deserialize(t,r,c){if(t instanceof U.InkAnnotationElement)return null;const f=super.deserialize(t,r,c);f.thickness=t.thickness,f.color=y.Util.makeHexColor(...t.color),f.opacity=t.opacity;const[v,S]=f.pageDimensions,M=f.width*v,I=f.height*S,O=f.parentScale,N=t.thickness/2;f.#h=!0,f.#o=Math.round(M),f.#p=Math.round(I);const{paths:B,rect:q,rotation:st}=t;for(let{bezier:H}of B){H=u.#$(H,q,st);const G=[];f.paths.push(G);let Y=O*(H[0]-N),Q=O*(H[1]-N);for(let at=2,ot=H.length;at<ot;at+=6){const lt=O*(H[at]-N),ht=O*(H[at+1]-N),ft=O*(H[at+2]-N),ct=O*(H[at+3]-N),Z=O*(H[at+4]-N),m=O*(H[at+5]-N);G.push([[Y,Q],[lt,ht],[ft,ct],[Z,m]]),Y=Z,Q=m}const K=this.#D(G);f.bezierPath2D.push(K)}const X=f.#U();return f.#e=Math.max(z.AnnotationEditor.MIN_SIZE,X[2]-X[0]),f.#t=Math.max(z.AnnotationEditor.MIN_SIZE,X[3]-X[1]),f.#_(M,I),f}serialize(){if(this.isEmpty())return null;const t=this.getRect(0,0),r=z.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:y.AnnotationEditorType.INK,color:r,thickness:this.thickness,opacity:this.opacity,paths:this.#X(this.scaleFactor/this.parentScale,this.translationX,this.translationY,t),pageIndex:this.pageIndex,rect:t,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}}class b extends z.AnnotationEditor{#t=null;#e=null;#s=null;#n=null;#r=null;#i="";#a=null;#l=null;#h=null;#d=!1;#u=!1;static _type="stamp";static _editorType=y.AnnotationEditorType.STAMP;constructor(t){super({...t,name:"stampEditor"}),this.#n=t.bitmapUrl,this.#r=t.bitmapFile}static initialize(t,r){z.AnnotationEditor.initialize(t,r)}static get supportedTypes(){const t=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,y.shadow)(this,"supportedTypes",t.map(r=>`image/${r}`))}static get supportedTypesStr(){return(0,y.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,r){r.pasteEditor(y.AnnotationEditorType.STAMP,{bitmapFile:t.getAsFile()})}#c(t,r=!1){if(!t){this.remove();return}this.#t=t.bitmap,r||(this.#e=t.id,this.#d=t.isSvg),t.file&&(this.#i=t.file.name),this.#g()}#o(){this.#s=null,this._uiManager.enableWaiting(!1),this.#a&&this.div.focus()}#p(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(r=>this.#c(r,!0)).finally(()=>this.#o());return}if(this.#n){const r=this.#n;this.#n=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromUrl(r).then(c=>this.#c(c)).finally(()=>this.#o());return}if(this.#r){const r=this.#r;this.#r=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromFile(r).then(c=>this.#c(c)).finally(()=>this.#o());return}const t=document.createElement("input");t.type="file",t.accept=b.supportedTypesStr,this.#s=new Promise(r=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const c=await this._uiManager.imageManager.getFromFile(t.files[0]);this.#c(c)}r()}),t.addEventListener("cancel",()=>{this.remove(),r()})}).finally(()=>this.#o()),t.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#a?.remove(),this.#a=null,this.#l?.disconnect(),this.#l=null,this.#h&&(clearTimeout(this.#h),this.#h=null)),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#p();return}super.rebuild(),this.div!==null&&(this.#e&&this.#a===null&&this.#p(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(this.#s||this.#t||this.#n||this.#r||this.#e)}get isResizable(){return!0}render(){if(this.div)return this.div;let t,r;if(this.width&&(t=this.x,r=this.y),super.render(),this.div.hidden=!0,this.addAltTextButton(),this.#t?this.#g():this.#p(),this.width){const[c,f]=this.parentDimensions;this.setAt(t*c,r*f,this.width*c,this.height*f)}return this.div}#g(){const{div:t}=this;let{width:r,height:c}=this.#t;const[f,v]=this.pageDimensions,S=.75;if(this.width)r=this.width*f,c=this.height*v;else if(r>S*f||c>S*v){const N=Math.min(S*f/r,S*v/c);r*=N,c*=N}const[M,I]=this.parentDimensions;this.setDims(r*M/f,c*I/v),this._uiManager.enableWaiting(!1);const O=this.#a=document.createElement("canvas");t.append(O),t.hidden=!1,this.#b(r,c),this.#w(),this.#u||(this.parent.addUndoableEditor(this),this.#u=!0),this._reportTelemetry({action:"inserted_image"}),this.#i&&O.setAttribute("aria-label",this.#i)}#f(t,r){const[c,f]=this.parentDimensions;this.width=t/c,this.height=r/f,this.setDims(t,r),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,this.#h!==null&&clearTimeout(this.#h);const v=200;this.#h=setTimeout(()=>{this.#h=null,this.#b(t,r)},v)}#m(t,r){const{width:c,height:f}=this.#t;let v=c,S=f,M=this.#t;for(;v>2*t||S>2*r;){const I=v,O=S;v>2*t&&(v=v>=16384?Math.floor(v/2)-1:Math.ceil(v/2)),S>2*r&&(S=S>=16384?Math.floor(S/2)-1:Math.ceil(S/2));const N=new OffscreenCanvas(v,S);N.getContext("2d").drawImage(M,0,0,I,O,0,0,v,S),M=N.transferToImageBitmap()}return M}#b(t,r){t=Math.ceil(t),r=Math.ceil(r);const c=this.#a;if(!c||c.width===t&&c.height===r)return;c.width=t,c.height=r;const f=this.#d?this.#t:this.#m(t,r);if(this._uiManager.hasMLManager&&!this.hasAltText()){const S=new OffscreenCanvas(t,r);S.getContext("2d").drawImage(f,0,0,f.width,f.height,0,0,t,r),S.convertToBlob().then(I=>{const O=new FileReader;O.onload=()=>{const N=O.result;this._uiManager.mlGuess({service:"image-to-text",request:{imageData:N}}).then(B=>{const q=B?.output||"";this.parent&&q&&!this.hasAltText()&&(this.altTextData={altText:q,decorative:!1})})},O.readAsDataURL(I)})}const v=c.getContext("2d");v.filter=this._uiManager.hcmFilter,v.drawImage(f,0,0,f.width,f.height,0,0,t,r)}getImageForAltText(){return this.#a}#A(t){if(t){if(this.#d){const f=this._uiManager.imageManager.getSvgUrl(this.#e);if(f)return f}const r=document.createElement("canvas");return{width:r.width,height:r.height}=this.#t,r.getContext("2d").drawImage(this.#t,0,0),r.toDataURL()}if(this.#d){const[r,c]=this.pageDimensions,f=Math.round(this.width*r*o.PixelsPerInch.PDF_TO_CSS_UNITS),v=Math.round(this.height*c*o.PixelsPerInch.PDF_TO_CSS_UNITS),S=new OffscreenCanvas(f,v);return S.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,f,v),S.transferToImageBitmap()}return structuredClone(this.#t)}#w(){this.#l=new ResizeObserver(t=>{const r=t[0].contentRect;r.width&&r.height&&this.#f(r.width,r.height)}),this.#l.observe(this.div)}static deserialize(t,r,c){if(t instanceof U.StampAnnotationElement)return null;const f=super.deserialize(t,r,c),{rect:v,bitmapUrl:S,bitmapId:M,isSvg:I,accessibilityData:O}=t;M&&c.imageManager.isValidId(M)?f.#e=M:f.#n=S,f.#d=I;const[N,B]=f.pageDimensions;return f.width=(v[2]-v[0])/N,f.height=(v[3]-v[1])/B,O&&(f.altTextData=O),f}serialize(t=!1,r=null){if(this.isEmpty())return null;const c={annotationType:y.AnnotationEditorType.STAMP,bitmapId:this.#e,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#d,structTreeParentId:this._structTreeParentId};if(t)return c.bitmapUrl=this.#A(!0),c.accessibilityData=this.altTextData,c;const{decorative:f,altText:v}=this.altTextData;if(!f&&v&&(c.accessibilityData={type:"Figure",alt:v}),r===null)return c;r.stamps||=new Map;const S=this.#d?(c.rect[2]-c.rect[0])*(c.rect[3]-c.rect[1]):null;if(!r.stamps.has(this.#e))r.stamps.set(this.#e,{area:S,serialized:c}),c.bitmap=this.#A(!1);else if(this.#d){const M=r.stamps.get(this.#e);S>M.area&&(M.area=S,M.serialized.bitmap.close(),M.serialized.bitmap=this.#A(!1))}return c}}class s{#t;#e=!1;#s=null;#n=null;#r=null;#i=null;#a=null;#l=new Map;#h=!1;#d=!1;#u=!1;#c=null;#o;static _initialized=!1;static#p=new Map([C,u,b,d].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:r,div:c,accessibilityManager:f,annotationLayer:v,drawLayer:S,textLayer:M,viewport:I,l10n:O}){const N=[...s.#p.values()];if(!s._initialized){s._initialized=!0;for(const B of N)B.initialize(O,t)}t.registerEditorTypes(N),this.#o=t,this.pageIndex=r,this.div=c,this.#t=f,this.#s=v,this.viewport=I,this.#c=M,this.drawLayer=S,this.#o.addLayer(this)}get isEmpty(){return this.#l.size===0}get isInvisible(){return this.isEmpty&&this.#o.getMode()===y.AnnotationEditorType.NONE}updateToolbar(t){this.#o.updateToolbar(t)}updateMode(t=this.#o.getMode()){switch(this.#A(),t){case y.AnnotationEditorType.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case y.AnnotationEditorType.INK:this.addInkEditorIfNeeded(!1),this.disableTextSelection(),this.togglePointerEvents(!0),this.disableClick();break;case y.AnnotationEditorType.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:r}=this.div;for(const c of s.#p.values())r.toggle(`${c._type}Editing`,t===c._editorType);this.div.hidden=!1}hasTextLayer(t){return t===this.#c?.div}addInkEditorIfNeeded(t){if(this.#o.getMode()!==y.AnnotationEditorType.INK)return;if(!t){for(const c of this.#l.values())if(c.isEmpty()){c.setInBackground();return}}this.createAndAddNewEditor({offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(t){this.#o.setEditingState(t)}addCommands(t){this.#o.addCommands(t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#s?.div.classList.toggle("disabled",!t)}enable(){this.div.tabIndex=0,this.togglePointerEvents(!0);const t=new Set;for(const c of this.#l.values())c.enableEditing(),c.annotationElementId&&t.add(c.annotationElementId);if(!this.#s)return;const r=this.#s.getEditableAnnotations();for(const c of r){if(c.hide(),this.#o.isDeletedAnnotationElement(c.data.id)||t.has(c.data.id))continue;const f=this.deserialize(c);f&&(this.addOrRebuild(f),f.enableEditing())}}disable(){this.#u=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1);const t=new Set;for(const c of this.#l.values()){if(c.disableEditing(),!c.annotationElementId||c.serialize()!==null){t.add(c.annotationElementId);continue}this.getEditableAnnotation(c.annotationElementId)?.show(),c.remove()}if(this.#s){const c=this.#s.getEditableAnnotations();for(const f of c){const{id:v}=f.data;t.has(v)||this.#o.isDeletedAnnotationElement(v)||f.show()}}this.#A(),this.isEmpty&&(this.div.hidden=!0);const{classList:r}=this.div;for(const c of s.#p.values())r.remove(`${c._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#u=!1}getEditableAnnotation(t){return this.#s?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#o.getActive()!==t&&this.#o.setActiveEditor(t)}enableTextSelection(){this.div.tabIndex=-1,this.#c?.div&&!this.#i&&(this.#i=this.#g.bind(this),this.#c.div.addEventListener("pointerdown",this.#i),this.#c.div.classList.add("highlighting"))}disableTextSelection(){this.div.tabIndex=0,this.#c?.div&&this.#i&&(this.#c.div.removeEventListener("pointerdown",this.#i),this.#i=null,this.#c.div.classList.remove("highlighting"))}#g(t){if(this.#o.unselectAll(),t.target===this.#c.div){const{isMac:r}=y.FeatureTest.platform;if(t.button!==0||t.ctrlKey&&r)return;this.#o.showAllEditors("highlight",!0,!0),this.#c.div.classList.add("free"),d.startHighlighting(this,this.#o.direction==="ltr",t),this.#c.div.addEventListener("pointerup",()=>{this.#c.div.classList.remove("free")},{once:!0}),t.preventDefault()}}enableClick(){this.#r||(this.#r=this.pointerdown.bind(this),this.#n=this.pointerup.bind(this),this.div.addEventListener("pointerdown",this.#r),this.div.addEventListener("pointerup",this.#n))}disableClick(){this.#r&&(this.div.removeEventListener("pointerdown",this.#r),this.div.removeEventListener("pointerup",this.#n),this.#r=null,this.#n=null)}attach(t){this.#l.set(t.id,t);const{annotationElementId:r}=t;r&&this.#o.isDeletedAnnotationElement(r)&&this.#o.removeDeletedAnnotationElement(t)}detach(t){this.#l.delete(t.id),this.#t?.removePointerInTextLayer(t.contentDiv),!this.#u&&t.annotationElementId&&this.#o.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#o.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1,this.#d||this.addInkEditorIfNeeded(!1)}changeParent(t){t.parent!==this&&(t.annotationElementId&&(this.#o.addDeletedAnnotationElement(t.annotationElementId),z.AnnotationEditor.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),this.#o.addEditor(t),this.attach(t),!t.isAttachedToDOM){const r=t.render();this.div.append(r),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(),this.#o.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;const{activeElement:r}=document;t.div.contains(r)&&!this.#a&&(t._focusEventsAllowed=!1,this.#a=setTimeout(()=>{this.#a=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0}),r.focus())},0)),t._structTreeParentId=this.#t?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const r=()=>t._uiManager.rebuild(t),c=()=>{t.remove()};this.addCommands({cmd:r,undo:c,mustExec:!1})}getNextId(){return this.#o.getId()}get#f(){return s.#p.get(this.#o.getMode())}#m(t){const r=this.#f;return r?new r.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#f?.canCreateNewEmptyEditor()}pasteEditor(t,r){this.#o.updateToolbar(t),this.#o.updateMode(t);const{offsetX:c,offsetY:f}=this.#b(),v=this.getNextId(),S=this.#m({parent:this,id:v,x:c,y:f,uiManager:this.#o,isCentered:!0,...r});S&&this.add(S)}deserialize(t){return s.#p.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#o)||null}createAndAddNewEditor(t,r,c={}){const f=this.getNextId(),v=this.#m({parent:this,id:f,x:t.offsetX,y:t.offsetY,uiManager:this.#o,isCentered:r,...c});return v&&this.add(v),v}#b(){const{x:t,y:r,width:c,height:f}=this.div.getBoundingClientRect(),v=Math.max(0,t),S=Math.max(0,r),M=Math.min(window.innerWidth,t+c),I=Math.min(window.innerHeight,r+f),O=(v+M)/2-t,N=(S+I)/2-r,[B,q]=this.viewport.rotation%180===0?[O,N]:[N,O];return{offsetX:B,offsetY:q}}addNewEditor(){this.createAndAddNewEditor(this.#b(),!0)}setSelected(t){this.#o.setSelected(t)}toggleSelected(t){this.#o.toggleSelected(t)}isSelected(t){return this.#o.isSelected(t)}unselect(t){this.#o.unselect(t)}pointerup(t){const{isMac:r}=y.FeatureTest.platform;if(!(t.button!==0||t.ctrlKey&&r)&&t.target===this.div&&this.#h){if(this.#h=!1,!this.#e){this.#e=!0;return}if(this.#o.getMode()===y.AnnotationEditorType.STAMP){this.#o.unselectAll();return}this.createAndAddNewEditor(t,!1)}}pointerdown(t){if(this.#o.getMode()===y.AnnotationEditorType.HIGHLIGHT&&this.enableTextSelection(),this.#h){this.#h=!1;return}const{isMac:r}=y.FeatureTest.platform;if(t.button!==0||t.ctrlKey&&r||t.target!==this.div)return;this.#h=!0;const c=this.#o.getActive();this.#e=!c||c.isEmpty()}findNewParent(t,r,c){const f=this.#o.findParent(r,c);return f===null||f===this?!1:(f.changeParent(t),!0)}destroy(){this.#o.getActive()?.parent===this&&(this.#o.commitOrRemove(),this.#o.setActiveEditor(null)),this.#a&&(clearTimeout(this.#a),this.#a=null);for(const t of this.#l.values())this.#t?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#l.clear(),this.#o.removeLayer(this)}#A(){this.#d=!0;for(const t of this.#l.values())t.isEmpty()&&t.remove();this.#d=!1}render({viewport:t}){this.viewport=t,(0,o.setLayerDimensions)(this.div,t);for(const r of this.#o.getEditors(this.pageIndex))this.add(r),r.rebuild();this.updateMode()}update({viewport:t}){this.#o.commitOrRemove(),this.#A();const r=this.viewport.rotation,c=t.rotation;if(this.viewport=t,(0,o.setLayerDimensions)(this.div,{rotation:c}),r!==c)for(const f of this.#l.values())f.rotate(c);this.addInkEditorIfNeeded(!1)}get pageDimensions(){const{pageWidth:t,pageHeight:r}=this.viewport.rawDims;return[t,r]}get scale(){return this.#o.viewParameters.realScale}}},259:(dt,et,V)=>{V.d(et,{ColorPicker:()=>U});var y=V(292),z=V(830),_=V(419);class U{#t=this.#g.bind(this);#e=this.#m.bind(this);#s=null;#n=null;#r;#i=null;#a=!1;#l=!1;#h=null;#d;#u=null;#c;static get _keyboardManager(){return(0,y.shadow)(this,"_keyboardManager",new z.KeyboardManager([[["Escape","mac+Escape"],U.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],U.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],U.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],U.prototype._moveToPrevious],[["Home","mac+Home"],U.prototype._moveToBeginning],[["End","mac+End"],U.prototype._moveToEnd]]))}constructor({editor:C=null,uiManager:T=null}){C?(this.#l=!1,this.#c=y.AnnotationEditorParamsType.HIGHLIGHT_COLOR,this.#h=C):(this.#l=!0,this.#c=y.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR),this.#u=C?._uiManager||T,this.#d=this.#u._eventBus,this.#r=C?.color||this.#u?.highlightColors.values().next().value||"#FFFF98"}renderButton(){const C=this.#s=document.createElement("button");C.className="colorPicker",C.tabIndex="0",C.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),C.setAttribute("aria-haspopup",!0),C.addEventListener("click",this.#f.bind(this)),C.addEventListener("keydown",this.#t);const T=this.#n=document.createElement("span");return T.className="swatch",T.setAttribute("aria-hidden",!0),T.style.backgroundColor=this.#r,C.append(T),C}renderMainDropdown(){const C=this.#i=this.#o();return C.setAttribute("aria-orientation","horizontal"),C.setAttribute("aria-labelledby","highlightColorPickerLabel"),C}#o(){const C=document.createElement("div");C.addEventListener("contextmenu",_.noContextMenu),C.className="dropdown",C.role="listbox",C.setAttribute("aria-multiselectable",!1),C.setAttribute("aria-orientation","vertical"),C.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[T,A]of this.#u.highlightColors){const o=document.createElement("button");o.tabIndex="0",o.role="option",o.setAttribute("data-color",A),o.title=T,o.setAttribute("data-l10n-id",`pdfjs-editor-colorpicker-${T}`);const d=document.createElement("span");o.append(d),d.className="swatch",d.style.backgroundColor=A,o.setAttribute("aria-selected",A===this.#r),o.addEventListener("click",this.#p.bind(this,A)),C.append(o)}return C.addEventListener("keydown",this.#t),C}#p(C,T){T.stopPropagation(),this.#d.dispatch("switchannotationeditorparams",{source:this,type:this.#c,value:C})}_colorSelectFromKeyboard(C){if(C.target===this.#s){this.#f(C);return}const T=C.target.getAttribute("data-color");T&&this.#p(T,C)}_moveToNext(C){if(!this.#b){this.#f(C);return}if(C.target===this.#s){this.#i.firstChild?.focus();return}C.target.nextSibling?.focus()}_moveToPrevious(C){if(C.target===this.#i?.firstChild||C.target===this.#s){this.#b&&this._hideDropdownFromKeyboard();return}this.#b||this.#f(C),C.target.previousSibling?.focus()}_moveToBeginning(C){if(!this.#b){this.#f(C);return}this.#i.firstChild?.focus()}_moveToEnd(C){if(!this.#b){this.#f(C);return}this.#i.lastChild?.focus()}#g(C){U._keyboardManager.exec(this,C)}#f(C){if(this.#b){this.hideDropdown();return}if(this.#a=C.detail===0,window.addEventListener("pointerdown",this.#e),this.#i){this.#i.classList.remove("hidden");return}const T=this.#i=this.#o();this.#s.append(T)}#m(C){this.#i?.contains(C.target)||this.hideDropdown()}hideDropdown(){this.#i?.classList.add("hidden"),window.removeEventListener("pointerdown",this.#e)}get#b(){return this.#i&&!this.#i.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#l){if(!this.#b){this.#h?.unselect();return}this.hideDropdown(),this.#s.focus({preventScroll:!0,focusVisible:this.#a})}}updateColor(C){if(this.#n&&(this.#n.style.backgroundColor=C),!this.#i)return;const T=this.#u.highlightColors.values();for(const A of this.#i.children)A.setAttribute("aria-selected",T.next().value===C)}destroy(){this.#s?.remove(),this.#s=null,this.#n=null,this.#i?.remove(),this.#i=null}}},310:(dt,et,V)=>{V.d(et,{AnnotationEditor:()=>C});var y=V(830),z=V(292),_=V(419);class U{#t="";#e=!1;#s=null;#n=null;#r=null;#i=!1;#a=null;static _l10nPromise=null;constructor(o){this.#a=o}static initialize(o){U._l10nPromise||=o}async render(){const o=this.#s=document.createElement("button");o.className="altText";const d=await U._l10nPromise.get("pdfjs-editor-alt-text-button-label");o.textContent=d,o.setAttribute("aria-label",d),o.tabIndex="0",o.addEventListener("contextmenu",_.noContextMenu),o.addEventListener("pointerdown",b=>b.stopPropagation());const u=b=>{b.preventDefault(),this.#a._uiManager.editAltText(this.#a)};return o.addEventListener("click",u,{capture:!0}),o.addEventListener("keydown",b=>{b.target===o&&b.key==="Enter"&&(this.#i=!0,u(b))}),await this.#l(),o}finish(){this.#s&&(this.#s.focus({focusVisible:this.#i}),this.#i=!1)}isEmpty(){return!this.#t&&!this.#e}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:o,decorative:d}){this.#t===o&&this.#e===d||(this.#t=o,this.#e=d,this.#l())}toggle(o=!1){this.#s&&(!o&&this.#r&&(clearTimeout(this.#r),this.#r=null),this.#s.disabled=!o)}destroy(){this.#s?.remove(),this.#s=null,this.#n=null}async#l(){const o=this.#s;if(!o)return;if(!this.#t&&!this.#e){o.classList.remove("done"),this.#n?.remove();return}o.classList.add("done"),U._l10nPromise.get("pdfjs-editor-alt-text-edit-button-label").then(b=>{o.setAttribute("aria-label",b)});let d=this.#n;if(!d){this.#n=d=document.createElement("span"),d.className="tooltip",d.setAttribute("role","tooltip");const b=d.id=`alt-text-tooltip-${this.#a.id}`;o.setAttribute("aria-describedby",b);const s=100;o.addEventListener("mouseenter",()=>{this.#r=setTimeout(()=>{this.#r=null,this.#n.classList.add("show"),this.#a._reportTelemetry({action:"alt_text_tooltip"})},s)}),o.addEventListener("mouseleave",()=>{this.#r&&(clearTimeout(this.#r),this.#r=null),this.#n?.classList.remove("show")})}d.innerText=this.#e?await U._l10nPromise.get("pdfjs-editor-alt-text-decorative-tooltip"):this.#t,d.parentNode||o.append(d),this.#a.getImageForAltText()?.setAttribute("aria-describedby",d.id)}}var F=V(362);class C{#t=null;#e=null;#s=!1;#n=!1;#r=null;#i=null;#a=this.focusin.bind(this);#l=this.focusout.bind(this);#h=null;#d="";#u=!1;#c=null;#o=!1;#p=!1;#g=!1;#f=null;#m=0;#b=0;#A=null;_initialOptions=Object.create(null);_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;_l10nPromise=null;#w=!1;#E=C._zIndex++;static _borderLineWidth=-1;static _colorManager=new y.ColorManager;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const o=C.prototype._resizeWithKeyboard,d=y.AnnotationEditorUIManager.TRANSLATE_SMALL,u=y.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,z.shadow)(this,"_resizerKeyboardManager",new y.KeyboardManager([[["ArrowLeft","mac+ArrowLeft"],o,{args:[-d,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],o,{args:[-u,0]}],[["ArrowRight","mac+ArrowRight"],o,{args:[d,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],o,{args:[u,0]}],[["ArrowUp","mac+ArrowUp"],o,{args:[0,-d]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],o,{args:[0,-u]}],[["ArrowDown","mac+ArrowDown"],o,{args:[0,d]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],o,{args:[0,u]}],[["Escape","mac+Escape"],C.prototype._stopResizingWithKeyboard]]))}constructor(o){this.constructor===C&&(0,z.unreachable)("Cannot initialize AnnotationEditor."),this.parent=o.parent,this.id=o.id,this.width=this.height=null,this.pageIndex=o.parent.pageIndex,this.name=o.name,this.div=null,this._uiManager=o.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=o.isCentered,this._structTreeParentId=null;const{rotation:d,rawDims:{pageWidth:u,pageHeight:b,pageX:s,pageY:g}}=this.parent.viewport;this.rotation=d,this.pageRotation=(360+d-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[u,b],this.pageTranslation=[s,g];const[t,r]=this.parentDimensions;this.x=o.x/t,this.y=o.y/r,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,z.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(o){const d=new T({id:o.parent.getNextId(),parent:o.parent,uiManager:o._uiManager});d.annotationElementId=o.annotationElementId,d.deleted=!0,d._uiManager.addToAnnotationStorage(d)}static initialize(o,d,u){if(C._l10nPromise||=new Map(["pdfjs-editor-alt-text-button-label","pdfjs-editor-alt-text-edit-button-label","pdfjs-editor-alt-text-decorative-tooltip","pdfjs-editor-resizer-label-topLeft","pdfjs-editor-resizer-label-topMiddle","pdfjs-editor-resizer-label-topRight","pdfjs-editor-resizer-label-middleRight","pdfjs-editor-resizer-label-bottomRight","pdfjs-editor-resizer-label-bottomMiddle","pdfjs-editor-resizer-label-bottomLeft","pdfjs-editor-resizer-label-middleLeft"].map(s=>[s,o.get(s.replaceAll(/([A-Z])/g,g=>`-${g.toLowerCase()}`))])),u?.strings)for(const s of u.strings)C._l10nPromise.set(s,o.get(s));if(C._borderLineWidth!==-1)return;const b=getComputedStyle(document.documentElement);C._borderLineWidth=parseFloat(b.getPropertyValue("--outline-width"))||0}static updateDefaultParams(o,d){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(o){return!1}static paste(o,d){(0,z.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#w}set _isDraggable(o){this.#w=o,this.div?.classList.toggle("draggable",o)}get isEnterHandled(){return!0}center(){const[o,d]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*d/(o*2),this.y+=this.width*o/(d*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*d/(o*2),this.y-=this.width*o/(d*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(o){this._uiManager.addCommands(o)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#E}setParent(o){o!==null?(this.pageIndex=o.pageIndex,this.pageDimensions=o.pageDimensions):this.#D(),this.parent=o}focusin(o){this._focusEventsAllowed&&(this.#u?this.#u=!1:this.parent.setSelected(this))}focusout(o){!this._focusEventsAllowed||!this.isAttachedToDOM||o.relatedTarget?.closest(`#${this.id}`)||(o.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(o,d,u,b){const[s,g]=this.parentDimensions;[u,b]=this.screenToPageTranslation(u,b),this.x=(o+u)/s,this.y=(d+b)/g,this.fixAndSetPosition()}#L([o,d],u,b){[u,b]=this.screenToPageTranslation(u,b),this.x+=u/o,this.y+=b/d,this.fixAndSetPosition()}translate(o,d){this.#L(this.parentDimensions,o,d)}translateInPage(o,d){this.#c||=[this.x,this.y],this.#L(this.pageDimensions,o,d),this.div.scrollIntoView({block:"nearest"})}drag(o,d){this.#c||=[this.x,this.y];const[u,b]=this.parentDimensions;if(this.x+=o/u,this.y+=d/b,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:c,y:f}=this.div.getBoundingClientRect();this.parent.findNewParent(this,c,f)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:s,y:g}=this;const[t,r]=this.getBaseTranslation();s+=t,g+=r,this.div.style.left=`${(100*s).toFixed(2)}%`,this.div.style.top=`${(100*g).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}get _hasBeenMoved(){return!!this.#c&&(this.#c[0]!==this.x||this.#c[1]!==this.y)}getBaseTranslation(){const[o,d]=this.parentDimensions,{_borderLineWidth:u}=C,b=u/o,s=u/d;switch(this.rotation){case 90:return[-b,s];case 180:return[b,s];case 270:return[b,-s];default:return[-b,-s]}}get _mustFixPosition(){return!0}fixAndSetPosition(o=this.rotation){const[d,u]=this.pageDimensions;let{x:b,y:s,width:g,height:t}=this;if(g*=d,t*=u,b*=d,s*=u,this._mustFixPosition)switch(o){case 0:b=Math.max(0,Math.min(d-g,b)),s=Math.max(0,Math.min(u-t,s));break;case 90:b=Math.max(0,Math.min(d-t,b)),s=Math.min(u,Math.max(g,s));break;case 180:b=Math.min(d,Math.max(g,b)),s=Math.min(u,Math.max(t,s));break;case 270:b=Math.min(d,Math.max(t,b)),s=Math.max(0,Math.min(u-g,s));break}this.x=b/=d,this.y=s/=u;const[r,c]=this.getBaseTranslation();b+=r,s+=c;const{style:f}=this.div;f.left=`${(100*b).toFixed(2)}%`,f.top=`${(100*s).toFixed(2)}%`,this.moveInDOM()}static#M(o,d,u){switch(u){case 90:return[d,-o];case 180:return[-o,-d];case 270:return[-d,o];default:return[o,d]}}screenToPageTranslation(o,d){return C.#M(o,d,this.parentRotation)}pageTranslationToScreen(o,d){return C.#M(o,d,360-this.parentRotation)}#y(o){switch(o){case 90:{const[d,u]=this.pageDimensions;return[0,-d/u,u/d,0]}case 180:return[-1,0,0,-1];case 270:{const[d,u]=this.pageDimensions;return[0,d/u,-u/d,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:o,pageDimensions:[d,u]}=this,b=d*o,s=u*o;return z.FeatureTest.isCSSRoundSupported?[Math.round(b),Math.round(s)]:[b,s]}setDims(o,d){const[u,b]=this.parentDimensions;this.div.style.width=`${(100*o/u).toFixed(2)}%`,this.#n||(this.div.style.height=`${(100*d/b).toFixed(2)}%`)}fixDims(){const{style:o}=this.div,{height:d,width:u}=o,b=u.endsWith("%"),s=!this.#n&&d.endsWith("%");if(b&&s)return;const[g,t]=this.parentDimensions;b||(o.width=`${(100*parseFloat(u)/g).toFixed(2)}%`),!this.#n&&!s&&(o.height=`${(100*parseFloat(d)/t).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#v(){if(this.#r)return;this.#r=document.createElement("div"),this.#r.classList.add("resizers");const o=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"];for(const d of o){const u=document.createElement("div");this.#r.append(u),u.classList.add("resizer",d),u.setAttribute("data-resizer-name",d),u.addEventListener("pointerdown",this.#S.bind(this,d)),u.addEventListener("contextmenu",_.noContextMenu),u.tabIndex=-1}this.div.prepend(this.#r)}#S(o,d){d.preventDefault();const{isMac:u}=z.FeatureTest.platform;if(d.button!==0||d.ctrlKey&&u)return;this.#e?.toggle(!1);const b=this.#T.bind(this,o),s=this._isDraggable;this._isDraggable=!1;const g={passive:!0,capture:!0};this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",b,g);const t=this.x,r=this.y,c=this.width,f=this.height,v=this.parent.div.style.cursor,S=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(d.target).cursor;const M=()=>{this.parent.togglePointerEvents(!0),this.#e?.toggle(!0),this._isDraggable=s,window.removeEventListener("pointerup",M),window.removeEventListener("blur",M),window.removeEventListener("pointermove",b,g),this.parent.div.style.cursor=v,this.div.style.cursor=S,this.#x(t,r,c,f)};window.addEventListener("pointerup",M),window.addEventListener("blur",M)}#x(o,d,u,b){const s=this.x,g=this.y,t=this.width,r=this.height;s===o&&g===d&&t===u&&r===b||this.addCommands({cmd:()=>{this.width=t,this.height=r,this.x=s,this.y=g;const[c,f]=this.parentDimensions;this.setDims(c*t,f*r),this.fixAndSetPosition()},undo:()=>{this.width=u,this.height=b,this.x=o,this.y=d;const[c,f]=this.parentDimensions;this.setDims(c*u,f*b),this.fixAndSetPosition()},mustExec:!0})}#T(o,d){const[u,b]=this.parentDimensions,s=this.x,g=this.y,t=this.width,r=this.height,c=C.MIN_SIZE/u,f=C.MIN_SIZE/b,v=m=>Math.round(m*1e4)/1e4,S=this.#y(this.rotation),M=(m,l)=>[S[0]*m+S[2]*l,S[1]*m+S[3]*l],I=this.#y(360-this.rotation),O=(m,l)=>[I[0]*m+I[2]*l,I[1]*m+I[3]*l];let N,B,q=!1,st=!1;switch(o){case"topLeft":q=!0,N=(m,l)=>[0,0],B=(m,l)=>[m,l];break;case"topMiddle":N=(m,l)=>[m/2,0],B=(m,l)=>[m/2,l];break;case"topRight":q=!0,N=(m,l)=>[m,0],B=(m,l)=>[0,l];break;case"middleRight":st=!0,N=(m,l)=>[m,l/2],B=(m,l)=>[0,l/2];break;case"bottomRight":q=!0,N=(m,l)=>[m,l],B=(m,l)=>[0,0];break;case"bottomMiddle":N=(m,l)=>[m/2,l],B=(m,l)=>[m/2,0];break;case"bottomLeft":q=!0,N=(m,l)=>[0,l],B=(m,l)=>[m,0];break;case"middleLeft":st=!0,N=(m,l)=>[0,l/2],B=(m,l)=>[m,l/2];break}const X=N(t,r),H=B(t,r);let G=M(...H);const Y=v(s+G[0]),Q=v(g+G[1]);let K=1,at=1,[ot,lt]=this.screenToPageTranslation(d.movementX,d.movementY);if([ot,lt]=O(ot/u,lt/b),q){const m=Math.hypot(t,r);K=at=Math.max(Math.min(Math.hypot(H[0]-X[0]-ot,H[1]-X[1]-lt)/m,1/t,1/r),c/t,f/r)}else st?K=Math.max(c,Math.min(1,Math.abs(H[0]-X[0]-ot)))/t:at=Math.max(f,Math.min(1,Math.abs(H[1]-X[1]-lt)))/r;const ht=v(t*K),ft=v(r*at);G=M(...B(ht,ft));const ct=Y-G[0],Z=Q-G[1];this.width=ht,this.height=ft,this.x=ct,this.y=Z,this.setDims(u*ht,b*ft),this.fixAndSetPosition()}altTextFinish(){this.#e?.finish()}async addEditToolbar(){return this.#h||this.#p?this.#h:(this.#h=new F.EditorToolbar(this),this.div.append(this.#h.render()),this.#e&&this.#h.addAltTextButton(await this.#e.render()),this.#h)}removeEditToolbar(){this.#h&&(this.#h.remove(),this.#h=null,this.#e?.destroy())}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){this.#e||(U.initialize(C._l10nPromise),this.#e=new U(this),await this.addEditToolbar())}get altTextData(){return this.#e?.data}set altTextData(o){this.#e&&(this.#e.data=o)}hasAltText(){return!this.#e?.isEmpty()}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=this.#s?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),this.div.addEventListener("focusin",this.#a),this.div.addEventListener("focusout",this.#l);const[o,d]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*d/o).toFixed(2)}%`,this.div.style.maxHeight=`${(100*o/d).toFixed(2)}%`);const[u,b]=this.getInitialTranslation();return this.translate(u,b),(0,y.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(o){const{isMac:d}=z.FeatureTest.platform;if(o.button!==0||o.ctrlKey&&d){o.preventDefault();return}if(this.#u=!0,this._isDraggable){this.#k(o);return}this.#F(o)}#F(o){const{isMac:d}=z.FeatureTest.platform;o.ctrlKey&&!d||o.shiftKey||o.metaKey&&d?this.parent.toggleSelected(this):this.parent.setSelected(this)}#k(o){const d=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let u,b;d&&(this.div.classList.add("moving"),u={passive:!0,capture:!0},this.#m=o.clientX,this.#b=o.clientY,b=g=>{const{clientX:t,clientY:r}=g,[c,f]=this.screenToPageTranslation(t-this.#m,r-this.#b);this.#m=t,this.#b=r,this._uiManager.dragSelectedEditors(c,f)},window.addEventListener("pointermove",b,u));const s=()=>{window.removeEventListener("pointerup",s),window.removeEventListener("blur",s),d&&(this.div.classList.remove("moving"),window.removeEventListener("pointermove",b,u)),this.#u=!1,this._uiManager.endDragSession()||this.#F(o)};window.addEventListener("pointerup",s),window.addEventListener("blur",s)}moveInDOM(){this.#f&&clearTimeout(this.#f),this.#f=setTimeout(()=>{this.#f=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(o,d,u){o.changeParent(this),this.x=d,this.y=u,this.fixAndSetPosition()}getRect(o,d,u=this.rotation){const b=this.parentScale,[s,g]=this.pageDimensions,[t,r]=this.pageTranslation,c=o/b,f=d/b,v=this.x*s,S=this.y*g,M=this.width*s,I=this.height*g;switch(u){case 0:return[v+c+t,g-S-f-I+r,v+c+M+t,g-S-f+r];case 90:return[v+f+t,g-S+c+r,v+f+I+t,g-S+c+M+r];case 180:return[v-c-M+t,g-S+f+r,v-c+t,g-S+f+I+r];case 270:return[v-f-I+t,g-S-c-M+r,v-f+t,g-S-c+r];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(o,d){const[u,b,s,g]=o,t=s-u,r=g-b;switch(this.rotation){case 0:return[u,d-g,t,r];case 90:return[u,d-b,r,t];case 180:return[s,d-b,t,r];case 270:return[s,d-g,r,t];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#p=!0}disableEditMode(){this.#p=!1}isInEditMode(){return this.#p}shouldGetKeyboardEvents(){return this.#g}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){this.div?.addEventListener("focusin",this.#a),this.div?.addEventListener("focusout",this.#l)}rotate(o){}serialize(o=!1,d=null){(0,z.unreachable)("An editor must be serializable")}static deserialize(o,d,u){const b=new this.prototype.constructor({parent:d,id:d.getNextId(),uiManager:u});b.rotation=o.rotation;const[s,g]=b.pageDimensions,[t,r,c,f]=b.getRectInCurrentCoords(o.rect,g);return b.x=t/s,b.y=r/g,b.width=c/s,b.height=f/g,b}remove(){if(this.div.removeEventListener("focusin",this.#a),this.div.removeEventListener("focusout",this.#l),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#f&&(clearTimeout(this.#f),this.#f=null),this.#D(),this.removeEditToolbar(),this.#A){for(const o of this.#A.values())clearTimeout(o);this.#A=null}this.parent=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#v(),this.#r.classList.remove("hidden"),(0,y.bindEvents)(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(o){if(!this.isResizable||o.target!==this.div||o.key!=="Enter")return;this._uiManager.setSelected(this),this.#i={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const d=this.#r.children;if(!this.#t){this.#t=Array.from(d);const g=this.#I.bind(this),t=this.#R.bind(this);for(const r of this.#t){const c=r.getAttribute("data-resizer-name");r.setAttribute("role","spinbutton"),r.addEventListener("keydown",g),r.addEventListener("blur",t),r.addEventListener("focus",this.#_.bind(this,c)),C._l10nPromise.get(`pdfjs-editor-resizer-label-${c}`).then(f=>r.setAttribute("aria-label",f))}}const u=this.#t[0];let b=0;for(const g of d){if(g===u)break;b++}const s=(360-this.rotation+this.parentRotation)%360/90*(this.#t.length/4);if(s!==b){if(s<b)for(let t=0;t<b-s;t++)this.#r.append(this.#r.firstChild);else if(s>b)for(let t=0;t<s-b;t++)this.#r.firstChild.before(this.#r.lastChild);let g=0;for(const t of d){const c=this.#t[g++].getAttribute("data-resizer-name");C._l10nPromise.get(`pdfjs-editor-resizer-label-${c}`).then(f=>t.setAttribute("aria-label",f))}}this.#P(0),this.#g=!0,this.#r.firstChild.focus({focusVisible:!0}),o.preventDefault(),o.stopImmediatePropagation()}#I(o){C._resizerKeyboardManager.exec(this,o)}#R(o){this.#g&&o.relatedTarget?.parentNode!==this.#r&&this.#D()}#_(o){this.#d=this.#g?o:""}#P(o){if(this.#t)for(const d of this.#t)d.tabIndex=o}_resizeWithKeyboard(o,d){this.#g&&this.#T(this.#d,{movementX:o,movementY:d})}#D(){if(this.#g=!1,this.#P(-1),this.#i){const{savedX:o,savedY:d,savedWidth:u,savedHeight:b}=this.#i;this.#x(o,d,u,b),this.#i=null}}_stopResizingWithKeyboard(){this.#D(),this.div.focus()}select(){if(this.makeResizable(),this.div?.classList.add("selectedEditor"),!this.#h){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this.#h?.show()});return}this.#h?.show()}unselect(){this.#r?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this.#h?.hide()}updateParams(o,d){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return this.#o}set isEditing(o){this.#o=o,this.parent&&(o?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(o,d){this.#n=!0;const u=o/d,{style:b}=this.div;b.aspectRatio=u,b.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(o,d=!1){if(d){this.#A||=new Map;const{action:u}=o;let b=this.#A.get(u);b&&clearTimeout(b),b=setTimeout(()=>{this._reportTelemetry(o),this.#A.delete(u),this.#A.size===0&&(this.#A=null)},C._telemetryTimeout),this.#A.set(u,b);return}o.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:o}})}show(o=this._isVisible){this.div.classList.toggle("hidden",!o),this._isVisible=o}enable(){this.div&&(this.div.tabIndex=0),this.#s=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#s=!0}}class T extends C{constructor(o){super(o),this.annotationElementId=o.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},61:(dt,et,V)=>{V.d(et,{FreeOutliner:()=>F,Outliner:()=>z});var y=V(292);class z{#t;#e=[];#s=[];constructor(A,o=0,d=0,u=!0){let b=1/0,s=-1/0,g=1/0,t=-1/0;const c=10**-4;for(const{x:N,y:B,width:q,height:st}of A){const X=Math.floor((N-o)/c)*c,H=Math.ceil((N+q+o)/c)*c,G=Math.floor((B-o)/c)*c,Y=Math.ceil((B+st+o)/c)*c,Q=[X,G,Y,!0],K=[H,G,Y,!1];this.#e.push(Q,K),b=Math.min(b,X),s=Math.max(s,H),g=Math.min(g,G),t=Math.max(t,Y)}const f=s-b+2*d,v=t-g+2*d,S=b-d,M=g-d,I=this.#e.at(u?-1:-2),O=[I[0],I[2]];for(const N of this.#e){const[B,q,st]=N;N[0]=(B-S)/f,N[1]=(q-M)/v,N[2]=(st-M)/v}this.#t={x:S,y:M,width:f,height:v,lastPoint:O}}getOutlines(){this.#e.sort((o,d)=>o[0]-d[0]||o[1]-d[1]||o[2]-d[2]);const A=[];for(const o of this.#e)o[3]?(A.push(...this.#l(o)),this.#i(o)):(this.#a(o),A.push(...this.#l(o)));return this.#n(A)}#n(A){const o=[],d=new Set;for(const s of A){const[g,t,r]=s;o.push([g,t,s],[g,r,s])}o.sort((s,g)=>s[1]-g[1]||s[0]-g[0]);for(let s=0,g=o.length;s<g;s+=2){const t=o[s][2],r=o[s+1][2];t.push(r),r.push(t),d.add(t),d.add(r)}const u=[];let b;for(;d.size>0;){const s=d.values().next().value;let[g,t,r,c,f]=s;d.delete(s);let v=g,S=t;for(b=[g,r],u.push(b);;){let M;if(d.has(c))M=c;else if(d.has(f))M=f;else break;d.delete(M),[g,t,r,c,f]=M,v!==g&&(b.push(v,S,g,S===t?t:r),v=g),S=S===t?r:t}b.push(v,S)}return new U(u,this.#t)}#r(A){const o=this.#s;let d=0,u=o.length-1;for(;d<=u;){const b=d+u>>1,s=o[b][0];if(s===A)return b;s<A?d=b+1:u=b-1}return u+1}#i([,A,o]){const d=this.#r(A);this.#s.splice(d,0,[A,o])}#a([,A,o]){const d=this.#r(A);for(let u=d;u<this.#s.length;u++){const[b,s]=this.#s[u];if(b!==A)break;if(b===A&&s===o){this.#s.splice(u,1);return}}for(let u=d-1;u>=0;u--){const[b,s]=this.#s[u];if(b!==A)break;if(b===A&&s===o){this.#s.splice(u,1);return}}}#l(A){const[o,d,u]=A,b=[[o,d,u]],s=this.#r(u);for(let g=0;g<s;g++){const[t,r]=this.#s[g];for(let c=0,f=b.length;c<f;c++){const[,v,S]=b[c];if(!(r<=v||S<=t)){if(v>=t){if(S>r)b[c][1]=r;else{if(f===1)return[];b.splice(c,1),c--,f--}continue}b[c][2]=t,S>r&&b.push([o,r,S])}}}return b}}class _{toSVGPath(){throw new Error("Abstract method `toSVGPath` must be implemented.")}get box(){throw new Error("Abstract getter `box` must be implemented.")}serialize(A,o){throw new Error("Abstract method `serialize` must be implemented.")}get free(){return this instanceof C}}class U extends _{#t;#e;constructor(A,o){super(),this.#e=A,this.#t=o}toSVGPath(){const A=[];for(const o of this.#e){let[d,u]=o;A.push(`M${d} ${u}`);for(let b=2;b<o.length;b+=2){const s=o[b],g=o[b+1];s===d?(A.push(`V${g}`),u=g):g===u&&(A.push(`H${s}`),d=s)}A.push("Z")}return A.join(" ")}serialize([A,o,d,u],b){const s=[],g=d-A,t=u-o;for(const r of this.#e){const c=new Array(r.length);for(let f=0;f<r.length;f+=2)c[f]=A+r[f]*g,c[f+1]=u-r[f+1]*t;s.push(c)}return s}get box(){return this.#t}}class F{#t;#e=[];#s;#n;#r=[];#i=new Float64Array(18);#a;#l;#h;#d;#u;#c;#o=[];static#p=8;static#g=2;static#f=F.#p+F.#g;constructor({x:A,y:o},d,u,b,s,g=0){this.#t=d,this.#c=b*u,this.#n=s,this.#i.set([NaN,NaN,NaN,NaN,A,o],6),this.#s=g,this.#d=F.#p*u,this.#h=F.#f*u,this.#u=u,this.#o.push(A,o)}get free(){return!0}isEmpty(){return isNaN(this.#i[8])}#m(){const A=this.#i.subarray(4,6),o=this.#i.subarray(16,18),[d,u,b,s]=this.#t;return[(this.#a+(A[0]-o[0])/2-d)/b,(this.#l+(A[1]-o[1])/2-u)/s,(this.#a+(o[0]-A[0])/2-d)/b,(this.#l+(o[1]-A[1])/2-u)/s]}add({x:A,y:o}){this.#a=A,this.#l=o;const[d,u,b,s]=this.#t;let[g,t,r,c]=this.#i.subarray(8,12);const f=A-r,v=o-c,S=Math.hypot(f,v);if(S<this.#h)return!1;const M=S-this.#d,I=M/S,O=I*f,N=I*v;let B=g,q=t;g=r,t=c,r+=O,c+=N,this.#o?.push(A,o);const st=-N/M,X=O/M,H=st*this.#c,G=X*this.#c;return this.#i.set(this.#i.subarray(2,8),0),this.#i.set([r+H,c+G],4),this.#i.set(this.#i.subarray(14,18),12),this.#i.set([r-H,c-G],16),isNaN(this.#i[6])?(this.#r.length===0&&(this.#i.set([g+H,t+G],2),this.#r.push(NaN,NaN,NaN,NaN,(g+H-d)/b,(t+G-u)/s),this.#i.set([g-H,t-G],14),this.#e.push(NaN,NaN,NaN,NaN,(g-H-d)/b,(t-G-u)/s)),this.#i.set([B,q,g,t,r,c],6),!this.isEmpty()):(this.#i.set([B,q,g,t,r,c],6),Math.abs(Math.atan2(q-t,B-g)-Math.atan2(N,O))<Math.PI/2?([g,t,r,c]=this.#i.subarray(2,6),this.#r.push(NaN,NaN,NaN,NaN,((g+r)/2-d)/b,((t+c)/2-u)/s),[g,t,B,q]=this.#i.subarray(14,18),this.#e.push(NaN,NaN,NaN,NaN,((B+g)/2-d)/b,((q+t)/2-u)/s),!0):([B,q,g,t,r,c]=this.#i.subarray(0,6),this.#r.push(((B+5*g)/6-d)/b,((q+5*t)/6-u)/s,((5*g+r)/6-d)/b,((5*t+c)/6-u)/s,((g+r)/2-d)/b,((t+c)/2-u)/s),[r,c,g,t,B,q]=this.#i.subarray(12,18),this.#e.push(((B+5*g)/6-d)/b,((q+5*t)/6-u)/s,((5*g+r)/6-d)/b,((5*t+c)/6-u)/s,((g+r)/2-d)/b,((t+c)/2-u)/s),!0))}toSVGPath(){if(this.isEmpty())return"";const A=this.#r,o=this.#e,d=this.#i.subarray(4,6),u=this.#i.subarray(16,18),[b,s,g,t]=this.#t,[r,c,f,v]=this.#m();if(isNaN(this.#i[6])&&!this.isEmpty())return`M${(this.#i[2]-b)/g} ${(this.#i[3]-s)/t} L${(this.#i[4]-b)/g} ${(this.#i[5]-s)/t} L${r} ${c} L${f} ${v} L${(this.#i[16]-b)/g} ${(this.#i[17]-s)/t} L${(this.#i[14]-b)/g} ${(this.#i[15]-s)/t} Z`;const S=[];S.push(`M${A[4]} ${A[5]}`);for(let M=6;M<A.length;M+=6)isNaN(A[M])?S.push(`L${A[M+4]} ${A[M+5]}`):S.push(`C${A[M]} ${A[M+1]} ${A[M+2]} ${A[M+3]} ${A[M+4]} ${A[M+5]}`);S.push(`L${(d[0]-b)/g} ${(d[1]-s)/t} L${r} ${c} L${f} ${v} L${(u[0]-b)/g} ${(u[1]-s)/t}`);for(let M=o.length-6;M>=6;M-=6)isNaN(o[M])?S.push(`L${o[M+4]} ${o[M+5]}`):S.push(`C${o[M]} ${o[M+1]} ${o[M+2]} ${o[M+3]} ${o[M+4]} ${o[M+5]}`);return S.push(`L${o[4]} ${o[5]} Z`),S.join(" ")}getOutlines(){const A=this.#r,o=this.#e,d=this.#i,u=d.subarray(4,6),b=d.subarray(16,18),[s,g,t,r]=this.#t,c=new Float64Array((this.#o?.length??0)+2);for(let N=0,B=c.length-2;N<B;N+=2)c[N]=(this.#o[N]-s)/t,c[N+1]=(this.#o[N+1]-g)/r;c[c.length-2]=(this.#a-s)/t,c[c.length-1]=(this.#l-g)/r;const[f,v,S,M]=this.#m();if(isNaN(d[6])&&!this.isEmpty()){const N=new Float64Array(36);return N.set([NaN,NaN,NaN,NaN,(d[2]-s)/t,(d[3]-g)/r,NaN,NaN,NaN,NaN,(d[4]-s)/t,(d[5]-g)/r,NaN,NaN,NaN,NaN,f,v,NaN,NaN,NaN,NaN,S,M,NaN,NaN,NaN,NaN,(d[16]-s)/t,(d[17]-g)/r,NaN,NaN,NaN,NaN,(d[14]-s)/t,(d[15]-g)/r],0),new C(N,c,this.#t,this.#u,this.#s,this.#n)}const I=new Float64Array(this.#r.length+24+this.#e.length);let O=A.length;for(let N=0;N<O;N+=2){if(isNaN(A[N])){I[N]=I[N+1]=NaN;continue}I[N]=A[N],I[N+1]=A[N+1]}I.set([NaN,NaN,NaN,NaN,(u[0]-s)/t,(u[1]-g)/r,NaN,NaN,NaN,NaN,f,v,NaN,NaN,NaN,NaN,S,M,NaN,NaN,NaN,NaN,(b[0]-s)/t,(b[1]-g)/r],O),O+=24;for(let N=o.length-6;N>=6;N-=6)for(let B=0;B<6;B+=2){if(isNaN(o[N+B])){I[O]=I[O+1]=NaN,O+=2;continue}I[O]=o[N+B],I[O+1]=o[N+B+1],O+=2}return I.set([NaN,NaN,NaN,NaN,o[4],o[5]],O),new C(I,c,this.#t,this.#u,this.#s,this.#n)}}class C extends _{#t;#e=null;#s;#n;#r;#i;#a;constructor(A,o,d,u,b,s){super(),this.#a=A,this.#r=o,this.#t=d,this.#i=u,this.#s=b,this.#n=s,this.#d(s);const{x:g,y:t,width:r,height:c}=this.#e;for(let f=0,v=A.length;f<v;f+=2)A[f]=(A[f]-g)/r,A[f+1]=(A[f+1]-t)/c;for(let f=0,v=o.length;f<v;f+=2)o[f]=(o[f]-g)/r,o[f+1]=(o[f+1]-t)/c}toSVGPath(){const A=[`M${this.#a[4]} ${this.#a[5]}`];for(let o=6,d=this.#a.length;o<d;o+=6){if(isNaN(this.#a[o])){A.push(`L${this.#a[o+4]} ${this.#a[o+5]}`);continue}A.push(`C${this.#a[o]} ${this.#a[o+1]} ${this.#a[o+2]} ${this.#a[o+3]} ${this.#a[o+4]} ${this.#a[o+5]}`)}return A.push("Z"),A.join(" ")}serialize([A,o,d,u],b){const s=d-A,g=u-o;let t,r;switch(b){case 0:t=this.#l(this.#a,A,u,s,-g),r=this.#l(this.#r,A,u,s,-g);break;case 90:t=this.#h(this.#a,A,o,s,g),r=this.#h(this.#r,A,o,s,g);break;case 180:t=this.#l(this.#a,d,o,-s,g),r=this.#l(this.#r,d,o,-s,g);break;case 270:t=this.#h(this.#a,d,u,-s,-g),r=this.#h(this.#r,d,u,-s,-g);break}return{outline:Array.from(t),points:[Array.from(r)]}}#l(A,o,d,u,b){const s=new Float64Array(A.length);for(let g=0,t=A.length;g<t;g+=2)s[g]=o+A[g]*u,s[g+1]=d+A[g+1]*b;return s}#h(A,o,d,u,b){const s=new Float64Array(A.length);for(let g=0,t=A.length;g<t;g+=2)s[g]=o+A[g+1]*u,s[g+1]=d+A[g]*b;return s}#d(A){const o=this.#a;let d=o[4],u=o[5],b=d,s=u,g=d,t=u,r=d,c=u;const f=A?Math.max:Math.min;for(let O=6,N=o.length;O<N;O+=6){if(isNaN(o[O]))b=Math.min(b,o[O+4]),s=Math.min(s,o[O+5]),g=Math.max(g,o[O+4]),t=Math.max(t,o[O+5]),c<o[O+5]?(r=o[O+4],c=o[O+5]):c===o[O+5]&&(r=f(r,o[O+4]));else{const B=y.Util.bezierBoundingBox(d,u,...o.slice(O,O+6));b=Math.min(b,B[0]),s=Math.min(s,B[1]),g=Math.max(g,B[2]),t=Math.max(t,B[3]),c<B[3]?(r=B[2],c=B[3]):c===B[3]&&(r=f(r,B[2]))}d=o[O+4],u=o[O+5]}const v=b-this.#s,S=s-this.#s,M=g-b+2*this.#s,I=t-s+2*this.#s;this.#e={x:v,y:S,width:M,height:I,lastPoint:[r,c]}}get box(){return this.#e}getNewOutline(A,o){const{x:d,y:u,width:b,height:s}=this.#e,[g,t,r,c]=this.#t,f=b*r,v=s*c,S=d*r+g,M=u*c+t,I=new F({x:this.#r[0]*f+S,y:this.#r[1]*v+M},this.#t,this.#i,A,this.#n,o??this.#s);for(let O=2;O<this.#r.length;O+=2)I.add({x:this.#r[O]*f+S,y:this.#r[O+1]*v+M});return I.getOutlines()}}},362:(dt,et,V)=>{V.d(et,{EditorToolbar:()=>z,HighlightToolbar:()=>_});var y=V(419);class z{#t=null;#e=null;#s;#n=null;constructor(F){this.#s=F}render(){const F=this.#t=document.createElement("div");F.className="editToolbar",F.setAttribute("role","toolbar"),F.addEventListener("contextmenu",y.noContextMenu),F.addEventListener("pointerdown",z.#r);const C=this.#n=document.createElement("div");C.className="buttons",F.append(C);const T=this.#s.toolbarPosition;if(T){const{style:A}=F,o=this.#s._uiManager.direction==="ltr"?1-T[0]:T[0];A.insetInlineEnd=`${100*o}%`,A.top=`calc(${100*T[1]}% + var(--editor-toolbar-vert-offset))`}return this.#h(),F}static#r(F){F.stopPropagation()}#i(F){this.#s._focusEventsAllowed=!1,F.preventDefault(),F.stopPropagation()}#a(F){this.#s._focusEventsAllowed=!0,F.preventDefault(),F.stopPropagation()}#l(F){F.addEventListener("focusin",this.#i.bind(this),{capture:!0}),F.addEventListener("focusout",this.#a.bind(this),{capture:!0}),F.addEventListener("contextmenu",y.noContextMenu)}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden")}#h(){const F=document.createElement("button");F.className="delete",F.tabIndex=0,F.setAttribute("data-l10n-id",`pdfjs-editor-remove-${this.#s.editorType}-button`),this.#l(F),F.addEventListener("click",C=>{this.#s._uiManager.delete()}),this.#n.append(F)}get#d(){const F=document.createElement("div");return F.className="divider",F}addAltTextButton(F){this.#l(F),this.#n.prepend(F,this.#d)}addColorPicker(F){this.#e=F;const C=F.renderButton();this.#l(C),this.#n.prepend(C,this.#d)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}}class _{#t=null;#e=null;#s;constructor(F){this.#s=F}#n(){const F=this.#e=document.createElement("div");F.className="editToolbar",F.setAttribute("role","toolbar"),F.addEventListener("contextmenu",y.noContextMenu);const C=this.#t=document.createElement("div");return C.className="buttons",F.append(C),this.#i(),F}#r(F,C){let T=0,A=0;for(const o of F){const d=o.y+o.height;if(d<T)continue;const u=o.x+(C?o.width:0);if(d>T){A=u,T=d;continue}C?u>A&&(A=u):u<A&&(A=u)}return[C?1-A:A,T]}show(F,C,T){const[A,o]=this.#r(C,T),{style:d}=this.#e||=this.#n();F.append(this.#e),d.insetInlineEnd=`${100*A}%`,d.top=`calc(${100*o}% + var(--editor-toolbar-vert-offset))`}hide(){this.#e.remove()}#i(){const F=document.createElement("button");F.className="highlightButton",F.tabIndex=0,F.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const C=document.createElement("span");F.append(C),C.className="visuallyHidden",C.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label"),F.addEventListener("contextmenu",y.noContextMenu),F.addEventListener("click",()=>{this.#s.highlightSelection("floating_button")}),this.#t.append(F)}}},830:(dt,et,V)=>{V.d(et,{AnnotationEditorUIManager:()=>u,ColorManager:()=>d,KeyboardManager:()=>o,bindEvents:()=>U,opacityToHex:()=>F});var y=V(292),z=V(419),_=V(362);function U(b,s,g){for(const t of g)s.addEventListener(t,b[t].bind(b))}function F(b){return Math.round(Math.min(255,Math.max(1,255*b))).toString(16).padStart(2,"0")}class C{#t=0;constructor(){}get id(){return`${y.AnnotationEditorPrefix}${this.#t++}`}}class T{#t=(0,y.getUuid)();#e=0;#s=null;static get _isSVGFittingCanvas(){const s='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',t=new OffscreenCanvas(1,3).getContext("2d"),r=new Image;r.src=s;const c=r.decode().then(()=>(t.drawImage(r,0,0,1,1,0,0,1,3),new Uint32Array(t.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,y.shadow)(this,"_isSVGFittingCanvas",c)}async#n(s,g){this.#s||=new Map;let t=this.#s.get(s);if(t===null)return null;if(t?.bitmap)return t.refCounter+=1,t;try{t||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let r;if(typeof g=="string"?(t.url=g,r=await(0,z.fetchData)(g,"blob")):r=t.file=g,r.type==="image/svg+xml"){const c=T._isSVGFittingCanvas,f=new FileReader,v=new Image,S=new Promise((M,I)=>{v.onload=()=>{t.bitmap=v,t.isSvg=!0,M()},f.onload=async()=>{const O=t.svgUrl=f.result;v.src=await c?`${O}#svgView(preserveAspectRatio(none))`:O},v.onerror=f.onerror=I});f.readAsDataURL(r),await S}else t.bitmap=await createImageBitmap(r);t.refCounter=1}catch(r){console.error(r),t=null}return this.#s.set(s,t),t&&this.#s.set(t.id,t),t}async getFromFile(s){const{lastModified:g,name:t,size:r,type:c}=s;return this.#n(`${g}_${t}_${r}_${c}`,s)}async getFromUrl(s){return this.#n(s,s)}async getFromId(s){this.#s||=new Map;const g=this.#s.get(s);return g?g.bitmap?(g.refCounter+=1,g):g.file?this.getFromFile(g.file):this.getFromUrl(g.url):null}getSvgUrl(s){const g=this.#s.get(s);return g?.isSvg?g.svgUrl:null}deleteId(s){this.#s||=new Map;const g=this.#s.get(s);g&&(g.refCounter-=1,g.refCounter===0&&(g.bitmap=null))}isValidId(s){return s.startsWith(`image_${this.#t}_`)}}class A{#t=[];#e=!1;#s;#n=-1;constructor(s=128){this.#s=s}add({cmd:s,undo:g,post:t,mustExec:r,type:c=NaN,overwriteIfSameType:f=!1,keepUndo:v=!1}){if(r&&s(),this.#e)return;const S={cmd:s,undo:g,post:t,type:c};if(this.#n===-1){this.#t.length>0&&(this.#t.length=0),this.#n=0,this.#t.push(S);return}if(f&&this.#t[this.#n].type===c){v&&(S.undo=this.#t[this.#n].undo),this.#t[this.#n]=S;return}const M=this.#n+1;M===this.#s?this.#t.splice(0,1):(this.#n=M,M<this.#t.length&&this.#t.splice(M)),this.#t.push(S)}undo(){if(this.#n===-1)return;this.#e=!0;const{undo:s,post:g}=this.#t[this.#n];s(),g?.(),this.#e=!1,this.#n-=1}redo(){if(this.#n<this.#t.length-1){this.#n+=1,this.#e=!0;const{cmd:s,post:g}=this.#t[this.#n];s(),g?.(),this.#e=!1}}hasSomethingToUndo(){return this.#n!==-1}hasSomethingToRedo(){return this.#n<this.#t.length-1}destroy(){this.#t=null}}class o{constructor(s){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:g}=y.FeatureTest.platform;for(const[t,r,c={}]of s)for(const f of t){const v=f.startsWith("mac+");g&&v?(this.callbacks.set(f.slice(4),{callback:r,options:c}),this.allKeys.add(f.split("+").at(-1))):!g&&!v&&(this.callbacks.set(f,{callback:r,options:c}),this.allKeys.add(f.split("+").at(-1)))}}#t(s){s.altKey&&this.buffer.push("alt"),s.ctrlKey&&this.buffer.push("ctrl"),s.metaKey&&this.buffer.push("meta"),s.shiftKey&&this.buffer.push("shift"),this.buffer.push(s.key);const g=this.buffer.join("+");return this.buffer.length=0,g}exec(s,g){if(!this.allKeys.has(g.key))return;const t=this.callbacks.get(this.#t(g));if(!t)return;const{callback:r,options:{bubbles:c=!1,args:f=[],checker:v=null}}=t;v&&!v(s,g)||(r.bind(s,...f,g)(),c||(g.stopPropagation(),g.preventDefault()))}}class d{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const s=new Map([["CanvasText",null],["Canvas",null]]);return(0,z.getColorValues)(s),(0,y.shadow)(this,"_colors",s)}convert(s){const g=(0,z.getRGB)(s);if(!window.matchMedia("(forced-colors: active)").matches)return g;for(const[t,r]of this._colors)if(r.every((c,f)=>c===g[f]))return d._colorsMapping.get(t);return g}getHexCode(s){const g=this._colors.get(s);return g?y.Util.makeHexColor(...g):s}}class u{#t=null;#e=new Map;#s=new Map;#n=null;#r=null;#i=new A;#a=0;#l=new Set;#h=null;#d=null;#u=new Set;#c=!1;#o=null;#p=null;#g=null;#f=!1;#m=null;#b=new C;#A=!1;#w=!1;#E=null;#L=null;#M=null;#y=y.AnnotationEditorType.NONE;#v=new Set;#S=null;#x=null;#T=null;#F=this.blur.bind(this);#k=this.focus.bind(this);#I=this.copy.bind(this);#R=this.cut.bind(this);#_=this.paste.bind(this);#P=this.keydown.bind(this);#D=this.keyup.bind(this);#G=this.onEditingAction.bind(this);#$=this.onPageChanging.bind(this);#X=this.onScaleChanging.bind(this);#U=this.#nt.bind(this);#B=this.onRotationChanging.bind(this);#N={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#V=[0,0];#O=null;#z=null;#q=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const s=u.prototype,g=f=>f.#z.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&f.hasSomethingToControl(),t=(f,{target:v})=>{if(v instanceof HTMLInputElement){const{type:S}=v;return S!=="text"&&S!=="number"}return!0},r=this.TRANSLATE_SMALL,c=this.TRANSLATE_BIG;return(0,y.shadow)(this,"_keyboardManager",new o([[["ctrl+a","mac+meta+a"],s.selectAll,{checker:t}],[["ctrl+z","mac+meta+z"],s.undo,{checker:t}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],s.redo,{checker:t}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],s.delete,{checker:t}],[["Enter","mac+Enter"],s.addNewEditorFromKeyboard,{checker:(f,{target:v})=>!(v instanceof HTMLButtonElement)&&f.#z.contains(v)&&!f.isEnterHandled}],[[" ","mac+ "],s.addNewEditorFromKeyboard,{checker:(f,{target:v})=>!(v instanceof HTMLButtonElement)&&f.#z.contains(document.activeElement)}],[["Escape","mac+Escape"],s.unselectAll],[["ArrowLeft","mac+ArrowLeft"],s.translateSelectedEditors,{args:[-r,0],checker:g}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],s.translateSelectedEditors,{args:[-c,0],checker:g}],[["ArrowRight","mac+ArrowRight"],s.translateSelectedEditors,{args:[r,0],checker:g}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],s.translateSelectedEditors,{args:[c,0],checker:g}],[["ArrowUp","mac+ArrowUp"],s.translateSelectedEditors,{args:[0,-r],checker:g}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],s.translateSelectedEditors,{args:[0,-c],checker:g}],[["ArrowDown","mac+ArrowDown"],s.translateSelectedEditors,{args:[0,r],checker:g}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],s.translateSelectedEditors,{args:[0,c],checker:g}]]))}constructor(s,g,t,r,c,f,v,S,M){this.#z=s,this.#q=g,this.#n=t,this._eventBus=r,this._eventBus._on("editingaction",this.#G),this._eventBus._on("pagechanging",this.#$),this._eventBus._on("scalechanging",this.#X),this._eventBus._on("rotationchanging",this.#B),this.#rt(),this.#J(),this.#r=c.annotationStorage,this.#o=c.filterFactory,this.#x=f,this.#g=v||null,this.#c=S,this.#M=M||null,this.viewParameters={realScale:z.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1}destroy(){this.#Q(),this.#K(),this._eventBus._off("editingaction",this.#G),this._eventBus._off("pagechanging",this.#$),this._eventBus._off("scalechanging",this.#X),this._eventBus._off("rotationchanging",this.#B);for(const s of this.#s.values())s.destroy();this.#s.clear(),this.#e.clear(),this.#u.clear(),this.#t=null,this.#v.clear(),this.#i.destroy(),this.#n?.destroy(),this.#m?.hide(),this.#m=null,this.#p&&(clearTimeout(this.#p),this.#p=null),this.#O&&(clearTimeout(this.#O),this.#O=null),this.#at()}async mlGuess(s){return this.#M?.guess(s)||null}get hasMLManager(){return!!this.#M}get hcmFilter(){return(0,y.shadow)(this,"hcmFilter",this.#x?this.#o.addHCMFilter(this.#x.foreground,this.#x.background):"none")}get direction(){return(0,y.shadow)(this,"direction",getComputedStyle(this.#z).direction)}get highlightColors(){return(0,y.shadow)(this,"highlightColors",this.#g?new Map(this.#g.split(",").map(s=>s.split("=").map(g=>g.trim()))):null)}get highlightColorNames(){return(0,y.shadow)(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,s=>s.reverse())):null)}setMainHighlightColorPicker(s){this.#L=s}editAltText(s){this.#n?.editAltText(this,s)}onPageChanging({pageNumber:s}){this.#a=s-1}focusMainContainer(){this.#z.focus()}findParent(s,g){for(const t of this.#s.values()){const{x:r,y:c,width:f,height:v}=t.div.getBoundingClientRect();if(s>=r&&s<=r+f&&g>=c&&g<=c+v)return t}return null}disableUserSelect(s=!1){this.#q.classList.toggle("noUserSelect",s)}addShouldRescale(s){this.#u.add(s)}removeShouldRescale(s){this.#u.delete(s)}onScaleChanging({scale:s}){this.commitOrRemove(),this.viewParameters.realScale=s*z.PixelsPerInch.PDF_TO_CSS_UNITS;for(const g of this.#u)g.onScaleChanging()}onRotationChanging({pagesRotation:s}){this.commitOrRemove(),this.viewParameters.rotation=s}#Y({anchorNode:s}){return s.nodeType===Node.TEXT_NODE?s.parentElement:s}highlightSelection(s=""){const g=document.getSelection();if(!g||g.isCollapsed)return;const{anchorNode:t,anchorOffset:r,focusNode:c,focusOffset:f}=g,v=g.toString(),M=this.#Y(g).closest(".textLayer"),I=this.getSelectionBoxes(M);if(I){g.empty(),this.#y===y.AnnotationEditorType.NONE&&(this._eventBus.dispatch("showannotationeditorui",{source:this,mode:y.AnnotationEditorType.HIGHLIGHT}),this.showAllEditors("highlight",!0,!0));for(const O of this.#s.values())if(O.hasTextLayer(M)){O.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:s,boxes:I,anchorNode:t,anchorOffset:r,focusNode:c,focusOffset:f,text:v});break}}}#it(){const s=document.getSelection();if(!s||s.isCollapsed)return;const t=this.#Y(s).closest(".textLayer"),r=this.getSelectionBoxes(t);r&&(this.#m||=new _.HighlightToolbar(this),this.#m.show(t,r,this.direction==="ltr"))}addToAnnotationStorage(s){!s.isEmpty()&&this.#r&&!this.#r.has(s.id)&&this.#r.setValue(s.id,s)}#nt(){const s=document.getSelection();if(!s||s.isCollapsed){this.#S&&(this.#m?.hide(),this.#S=null,this.#C({hasSelectedText:!1}));return}const{anchorNode:g}=s;if(g===this.#S)return;if(!this.#Y(s).closest(".textLayer")){this.#S&&(this.#m?.hide(),this.#S=null,this.#C({hasSelectedText:!1}));return}if(this.#m?.hide(),this.#S=g,this.#C({hasSelectedText:!0}),!(this.#y!==y.AnnotationEditorType.HIGHLIGHT&&this.#y!==y.AnnotationEditorType.NONE)&&(this.#y===y.AnnotationEditorType.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#f=this.isShiftKeyDown,!this.isShiftKeyDown)){const c=f=>{f.type==="pointerup"&&f.button!==0||(window.removeEventListener("pointerup",c),window.removeEventListener("blur",c),f.type==="pointerup"&&this.#W("main_toolbar"))};window.addEventListener("pointerup",c),window.addEventListener("blur",c)}}#W(s=""){this.#y===y.AnnotationEditorType.HIGHLIGHT?this.highlightSelection(s):this.#c&&this.#it()}#rt(){document.addEventListener("selectionchange",this.#U)}#at(){document.removeEventListener("selectionchange",this.#U)}#ot(){window.addEventListener("focus",this.#k),window.addEventListener("blur",this.#F)}#K(){window.removeEventListener("focus",this.#k),window.removeEventListener("blur",this.#F)}blur(){if(this.isShiftKeyDown=!1,this.#f&&(this.#f=!1,this.#W("main_toolbar")),!this.hasSelection)return;const{activeElement:s}=document;for(const g of this.#v)if(g.div.contains(s)){this.#E=[g,s],g._focusEventsAllowed=!1;break}}focus(){if(!this.#E)return;const[s,g]=this.#E;this.#E=null,g.addEventListener("focusin",()=>{s._focusEventsAllowed=!0},{once:!0}),g.focus()}#J(){window.addEventListener("keydown",this.#P),window.addEventListener("keyup",this.#D)}#Q(){window.removeEventListener("keydown",this.#P),window.removeEventListener("keyup",this.#D)}#Z(){document.addEventListener("copy",this.#I),document.addEventListener("cut",this.#R),document.addEventListener("paste",this.#_)}#tt(){document.removeEventListener("copy",this.#I),document.removeEventListener("cut",this.#R),document.removeEventListener("paste",this.#_)}addEditListeners(){this.#J(),this.#Z()}removeEditListeners(){this.#Q(),this.#tt()}copy(s){if(s.preventDefault(),this.#t?.commitOrRemove(),!this.hasSelection)return;const g=[];for(const t of this.#v){const r=t.serialize(!0);r&&g.push(r)}g.length!==0&&s.clipboardData.setData("application/pdfjs",JSON.stringify(g))}cut(s){this.copy(s),this.delete()}paste(s){s.preventDefault();const{clipboardData:g}=s;for(const c of g.items)for(const f of this.#d)if(f.isHandlingMimeForPasting(c.type)){f.paste(c,this.currentLayer);return}let t=g.getData("application/pdfjs");if(!t)return;try{t=JSON.parse(t)}catch(c){(0,y.warn)(`paste: "${c.message}".`);return}if(!Array.isArray(t))return;this.unselectAll();const r=this.currentLayer;try{const c=[];for(const S of t){const M=r.deserialize(S);if(!M)return;c.push(M)}const f=()=>{for(const S of c)this.#et(S);this.#st(c)},v=()=>{for(const S of c)S.remove()};this.addCommands({cmd:f,undo:v,mustExec:!0})}catch(c){(0,y.warn)(`paste: "${c.message}".`)}}keydown(s){!this.isShiftKeyDown&&s.key==="Shift"&&(this.isShiftKeyDown=!0),this.#y!==y.AnnotationEditorType.NONE&&!this.isEditorHandlingKeyboard&&u._keyboardManager.exec(this,s)}keyup(s){this.isShiftKeyDown&&s.key==="Shift"&&(this.isShiftKeyDown=!1,this.#f&&(this.#f=!1,this.#W("main_toolbar")))}onEditingAction({name:s}){switch(s){case"undo":case"redo":case"delete":case"selectAll":this[s]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}#C(s){Object.entries(s).some(([t,r])=>this.#N[t]!==r)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#N,s)}),this.#y===y.AnnotationEditorType.HIGHLIGHT&&s.hasSelectedEditor===!1&&this.#H([[y.AnnotationEditorParamsType.HIGHLIGHT_FREE,!0]]))}#H(s){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:s})}setEditingState(s){s?(this.#ot(),this.#Z(),this.#C({isEditing:this.#y!==y.AnnotationEditorType.NONE,isEmpty:this.#j(),hasSomethingToUndo:this.#i.hasSomethingToUndo(),hasSomethingToRedo:this.#i.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#K(),this.#tt(),this.#C({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(s){if(!this.#d){this.#d=s;for(const g of this.#d)this.#H(g.defaultPropertiesToUpdate)}}getId(){return this.#b.id}get currentLayer(){return this.#s.get(this.#a)}getLayer(s){return this.#s.get(s)}get currentPageIndex(){return this.#a}addLayer(s){this.#s.set(s.pageIndex,s),this.#A?s.enable():s.disable()}removeLayer(s){this.#s.delete(s.pageIndex)}updateMode(s,g=null,t=!1){if(this.#y!==s){if(this.#y=s,s===y.AnnotationEditorType.NONE){this.setEditingState(!1),this.#lt();return}this.setEditingState(!0),this.#ht(),this.unselectAll();for(const r of this.#s.values())r.updateMode(s);if(!g&&t){this.addNewEditorFromKeyboard();return}if(g){for(const r of this.#e.values())if(r.annotationElementId===g){this.setSelected(r),r.enterInEditMode();break}}}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(s){s!==this.#y&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:s})}updateParams(s,g){if(this.#d){switch(s){case y.AnnotationEditorParamsType.CREATE:this.currentLayer.addNewEditor();return;case y.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR:this.#L?.updateColor(g);break;case y.AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#T||=new Map).set(s,g),this.showAllEditors("highlight",g);break}for(const t of this.#v)t.updateParams(s,g);for(const t of this.#d)t.updateDefaultParams(s,g)}}showAllEditors(s,g,t=!1){for(const c of this.#e.values())c.editorType===s&&c.show(g);(this.#T?.get(y.AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL)??!0)!==g&&this.#H([[y.AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL,g]])}enableWaiting(s=!1){if(this.#w!==s){this.#w=s;for(const g of this.#s.values())s?g.disableClick():g.enableClick(),g.div.classList.toggle("waiting",s)}}#ht(){if(!this.#A){this.#A=!0;for(const s of this.#s.values())s.enable();for(const s of this.#e.values())s.enable()}}#lt(){if(this.unselectAll(),this.#A){this.#A=!1;for(const s of this.#s.values())s.disable();for(const s of this.#e.values())s.disable()}}getEditors(s){const g=[];for(const t of this.#e.values())t.pageIndex===s&&g.push(t);return g}getEditor(s){return this.#e.get(s)}addEditor(s){this.#e.set(s.id,s)}removeEditor(s){s.div.contains(document.activeElement)&&(this.#p&&clearTimeout(this.#p),this.#p=setTimeout(()=>{this.focusMainContainer(),this.#p=null},0)),this.#e.delete(s.id),this.unselect(s),(!s.annotationElementId||!this.#l.has(s.annotationElementId))&&this.#r?.remove(s.id)}addDeletedAnnotationElement(s){this.#l.add(s.annotationElementId),s.deleted=!0}isDeletedAnnotationElement(s){return this.#l.has(s)}removeDeletedAnnotationElement(s){this.#l.delete(s.annotationElementId),s.deleted=!1}#et(s){const g=this.#s.get(s.pageIndex);g?g.addOrRebuild(s):(this.addEditor(s),this.addToAnnotationStorage(s))}setActiveEditor(s){this.#t!==s&&(this.#t=s,s&&this.#H(s.propertiesToUpdate))}get#ct(){let s=null;for(s of this.#v);return s}updateUI(s){this.#ct===s&&this.#H(s.propertiesToUpdate)}toggleSelected(s){if(this.#v.has(s)){this.#v.delete(s),s.unselect(),this.#C({hasSelectedEditor:this.hasSelection});return}this.#v.add(s),s.select(),this.#H(s.propertiesToUpdate),this.#C({hasSelectedEditor:!0})}setSelected(s){for(const g of this.#v)g!==s&&g.unselect();this.#v.clear(),this.#v.add(s),s.select(),this.#H(s.propertiesToUpdate),this.#C({hasSelectedEditor:!0})}isSelected(s){return this.#v.has(s)}get firstSelectedEditor(){return this.#v.values().next().value}unselect(s){s.unselect(),this.#v.delete(s),this.#C({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#v.size!==0}get isEnterHandled(){return this.#v.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#i.undo(),this.#C({hasSomethingToUndo:this.#i.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#j()})}redo(){this.#i.redo(),this.#C({hasSomethingToUndo:!0,hasSomethingToRedo:this.#i.hasSomethingToRedo(),isEmpty:this.#j()})}addCommands(s){this.#i.add(s),this.#C({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#j()})}#j(){if(this.#e.size===0)return!0;if(this.#e.size===1)for(const s of this.#e.values())return s.isEmpty();return!1}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const s=[...this.#v],g=()=>{for(const r of s)r.remove()},t=()=>{for(const r of s)this.#et(r)};this.addCommands({cmd:g,undo:t,mustExec:!0})}commitOrRemove(){this.#t?.commitOrRemove()}hasSomethingToControl(){return this.#t||this.hasSelection}#st(s){for(const g of this.#v)g.unselect();this.#v.clear();for(const g of s)g.isEmpty()||(this.#v.add(g),g.select());this.#C({hasSelectedEditor:this.hasSelection})}selectAll(){for(const s of this.#v)s.commit();this.#st(this.#e.values())}unselectAll(){if(!(this.#t&&(this.#t.commitOrRemove(),this.#y!==y.AnnotationEditorType.NONE))&&this.hasSelection){for(const s of this.#v)s.unselect();this.#v.clear(),this.#C({hasSelectedEditor:!1})}}translateSelectedEditors(s,g,t=!1){if(t||this.commitOrRemove(),!this.hasSelection)return;this.#V[0]+=s,this.#V[1]+=g;const[r,c]=this.#V,f=[...this.#v],v=1e3;this.#O&&clearTimeout(this.#O),this.#O=setTimeout(()=>{this.#O=null,this.#V[0]=this.#V[1]=0,this.addCommands({cmd:()=>{for(const S of f)this.#e.has(S.id)&&S.translateInPage(r,c)},undo:()=>{for(const S of f)this.#e.has(S.id)&&S.translateInPage(-r,-c)},mustExec:!1})},v);for(const S of f)S.translateInPage(s,g)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#h=new Map;for(const s of this.#v)this.#h.set(s,{savedX:s.x,savedY:s.y,savedPageIndex:s.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#h)return!1;this.disableUserSelect(!1);const s=this.#h;this.#h=null;let g=!1;for(const[{x:r,y:c,pageIndex:f},v]of s)v.newX=r,v.newY=c,v.newPageIndex=f,g||=r!==v.savedX||c!==v.savedY||f!==v.savedPageIndex;if(!g)return!1;const t=(r,c,f,v)=>{if(this.#e.has(r.id)){const S=this.#s.get(v);S?r._setParentAndPosition(S,c,f):(r.pageIndex=v,r.x=c,r.y=f)}};return this.addCommands({cmd:()=>{for(const[r,{newX:c,newY:f,newPageIndex:v}]of s)t(r,c,f,v)},undo:()=>{for(const[r,{savedX:c,savedY:f,savedPageIndex:v}]of s)t(r,c,f,v)},mustExec:!0}),!0}dragSelectedEditors(s,g){if(this.#h)for(const t of this.#h.keys())t.drag(s,g)}rebuild(s){if(s.parent===null){const g=this.getLayer(s.pageIndex);g?(g.changeParent(s),g.addOrRebuild(s)):(this.addEditor(s),this.addToAnnotationStorage(s),s.rebuild())}else s.parent.addOrRebuild(s)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#v.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(s){return this.#t===s}getActive(){return this.#t}getMode(){return this.#y}get imageManager(){return(0,y.shadow)(this,"imageManager",new T)}getSelectionBoxes(s){if(!s)return null;const g=document.getSelection();for(let M=0,I=g.rangeCount;M<I;M++)if(!s.contains(g.getRangeAt(M).commonAncestorContainer))return null;const{x:t,y:r,width:c,height:f}=s.getBoundingClientRect();let v;switch(s.getAttribute("data-main-rotation")){case"90":v=(M,I,O,N)=>({x:(I-r)/f,y:1-(M+O-t)/c,width:N/f,height:O/c});break;case"180":v=(M,I,O,N)=>({x:1-(M+O-t)/c,y:1-(I+N-r)/f,width:O/c,height:N/f});break;case"270":v=(M,I,O,N)=>({x:1-(I+N-r)/f,y:(M-t)/c,width:N/f,height:O/c});break;default:v=(M,I,O,N)=>({x:(M-t)/c,y:(I-r)/f,width:O/c,height:N/f});break}const S=[];for(let M=0,I=g.rangeCount;M<I;M++){const O=g.getRangeAt(M);if(!O.collapsed)for(const{x:N,y:B,width:q,height:st}of O.getClientRects())q===0||st===0||S.push(v(N,B,q,st))}return S.length===0?null:S}}},94:(dt,et,V)=>{V.d(et,{PDFFetchStream:()=>C});var y=V(292),z=V(490);function _(o,d,u){return{method:"GET",headers:o,signal:u.signal,mode:"cors",credentials:d?"include":"same-origin",redirect:"follow"}}function U(o){const d=new Headers;for(const u in o){const b=o[u];b!==void 0&&d.append(u,b)}return d}function F(o){return o instanceof Uint8Array?o.buffer:o instanceof ArrayBuffer?o:((0,y.warn)(`getArrayBuffer - unexpected data format: ${o}`),new Uint8Array(o).buffer)}class C{constructor(d){this.source=d,this.isHttp=/^https?:/i.test(d.url),this.httpHeaders=this.isHttp&&d.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,y.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new T(this),this._fullRequestReader}getRangeReader(d,u){if(u<=this._progressiveDataLength)return null;const b=new A(this,d,u);return this._rangeRequestReaders.push(b),b}cancelAllRequests(d){this._fullRequestReader?.cancel(d);for(const u of this._rangeRequestReaders.slice(0))u.cancel(d)}}class T{constructor(d){this._stream=d,this._reader=null,this._loaded=0,this._filename=null;const u=d.source;this._withCredentials=u.withCredentials||!1,this._contentLength=u.length,this._headersCapability=Promise.withResolvers(),this._disableRange=u.disableRange||!1,this._rangeChunkSize=u.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!u.disableStream,this._isRangeSupported=!u.disableRange,this._headers=U(this._stream.httpHeaders);const b=u.url;fetch(b,_(this._headers,this._withCredentials,this._abortController)).then(s=>{if(!(0,z.validateResponseStatus)(s.status))throw(0,z.createResponseStatusError)(s.status,b);this._reader=s.body.getReader(),this._headersCapability.resolve();const g=c=>s.headers.get(c),{allowRangeRequests:t,suggestedLength:r}=(0,z.validateRangeRequestCapabilities)({getResponseHeader:g,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=t,this._contentLength=r||this._contentLength,this._filename=(0,z.extractFilenameFromHeader)(g),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new y.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:d,done:u}=await this._reader.read();return u?{value:d,done:u}:(this._loaded+=d.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:F(d),done:!1})}cancel(d){this._reader?.cancel(d),this._abortController.abort()}}class A{constructor(d,u,b){this._stream=d,this._reader=null,this._loaded=0;const s=d.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController,this._headers=U(this._stream.httpHeaders),this._headers.append("Range",`bytes=${u}-${b-1}`);const g=s.url;fetch(g,_(this._headers,this._withCredentials,this._abortController)).then(t=>{if(!(0,z.validateResponseStatus)(t.status))throw(0,z.createResponseStatusError)(t.status,g);this._readCapability.resolve(),this._reader=t.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:d,done:u}=await this._reader.read();return u?{value:d,done:u}:(this._loaded+=d.byteLength,this.onProgress?.({loaded:this._loaded}),{value:F(d),done:!1})}cancel(d){this._reader?.cancel(d),this._abortController.abort()}}},10:(dt,et,V)=>{V.d(et,{FontFaceObject:()=>_,FontLoader:()=>z});var y=V(292);class z{#t=new Set;constructor({ownerDocument:F=globalThis.document,styleElement:C=null}){this._document=F,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(F){this.nativeFontFaces.add(F),this._document.fonts.add(F)}removeNativeFontFace(F){this.nativeFontFaces.delete(F),this._document.fonts.delete(F)}insertRule(F){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const C=this.styleElement.sheet;C.insertRule(F,C.cssRules.length)}clear(){for(const F of this.nativeFontFaces)this._document.fonts.delete(F);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:F,_inspectFont:C}){if(!(!F||this.#t.has(F.loadedName))){if((0,y.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:T,src:A,style:o}=F,d=new FontFace(T,A,o);this.addNativeFontFace(d);try{await d.load(),this.#t.add(T),C?.(F)}catch{(0,y.warn)(`Cannot load system font: ${F.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(d)}return}(0,y.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(F){if(F.attached||F.missingFile&&!F.systemFontInfo)return;if(F.attached=!0,F.systemFontInfo){await this.loadSystemFont(F);return}if(this.isFontLoadingAPISupported){const T=F.createNativeFontFace();if(T){this.addNativeFontFace(T);try{await T.loaded}catch(A){throw(0,y.warn)(`Failed to load font '${T.family}': '${A}'.`),F.disableFontFace=!0,A}}return}const C=F.createFontFaceRule();if(C){if(this.insertRule(C),this.isSyncFontLoadingSupported)return;await new Promise(T=>{const A=this._queueLoadingCallback(T);this._prepareFontLoadEvent(F,A)})}}get isFontLoadingAPISupported(){const F=!!this._document?.fonts;return(0,y.shadow)(this,"isFontLoadingAPISupported",F)}get isSyncFontLoadingSupported(){let F=!1;return(y.isNodeJS||typeof navigator<"u"&&typeof navigator?.userAgent=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(F=!0),(0,y.shadow)(this,"isSyncFontLoadingSupported",F)}_queueLoadingCallback(F){function C(){for((0,y.assert)(!A.done,"completeRequest() cannot be called twice."),A.done=!0;T.length>0&&T[0].done;){const o=T.shift();setTimeout(o.callback,0)}}const{loadingRequests:T}=this,A={done:!1,complete:C,callback:F};return T.push(A),A}get _loadTestFont(){const F=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,y.shadow)(this,"_loadTestFont",F)}_prepareFontLoadEvent(F,C){function T(N,B){return N.charCodeAt(B)<<24|N.charCodeAt(B+1)<<16|N.charCodeAt(B+2)<<8|N.charCodeAt(B+3)&255}function A(N,B,q,st){const X=N.substring(0,B),H=N.substring(B+q);return X+st+H}let o,d;const u=this._document.createElement("canvas");u.width=1,u.height=1;const b=u.getContext("2d");let s=0;function g(N,B){if(++s>30){(0,y.warn)("Load test font never loaded."),B();return}if(b.font="30px "+N,b.fillText(".",0,20),b.getImageData(0,0,1,1).data[3]>0){B();return}setTimeout(g.bind(null,N,B))}const t=`lt${Date.now()}${this.loadTestFontId++}`;let r=this._loadTestFont;r=A(r,976,t.length,t);const f=16,v=1482184792;let S=T(r,f);for(o=0,d=t.length-3;o<d;o+=4)S=S-v+T(t,o)|0;o<t.length&&(S=S-v+T(t+"XXX",o)|0),r=A(r,f,4,(0,y.string32)(S));const M=`url(data:font/opentype;base64,${btoa(r)});`,I=`@font-face {font-family:"${t}";src:${M}}`;this.insertRule(I);const O=this._document.createElement("div");O.style.visibility="hidden",O.style.width=O.style.height="10px",O.style.position="absolute",O.style.top=O.style.left="0px";for(const N of[F.loadedName,t]){const B=this._document.createElement("span");B.textContent="Hi",B.style.fontFamily=N,O.append(B)}this._document.body.append(O),g(t,()=>{O.remove(),C.complete()})}}class _{constructor(F,{isEvalSupported:C=!0,disableFontFace:T=!1,ignoreErrors:A=!1,inspectFont:o=null}){this.compiledGlyphs=Object.create(null);for(const d in F)this[d]=F[d];this.isEvalSupported=C!==!1,this.disableFontFace=T===!0,this.ignoreErrors=A===!0,this._inspectFont=o}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let F;if(!this.cssFontInfo)F=new FontFace(this.loadedName,this.data,{});else{const C={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(C.style=`oblique ${this.cssFontInfo.italicAngle}deg`),F=new FontFace(this.cssFontInfo.fontFamily,this.data,C)}return this._inspectFont?.(this),F}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const F=(0,y.bytesToString)(this.data),C=`url(data:${this.mimetype};base64,${btoa(F)});`;let T;if(!this.cssFontInfo)T=`@font-face {font-family:"${this.loadedName}";src:${C}}`;else{let A=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(A+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),T=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${A}src:${C}}`}return this._inspectFont?.(this,C),T}getPathGenerator(F,C){if(this.compiledGlyphs[C]!==void 0)return this.compiledGlyphs[C];let T;try{T=F.get(this.loadedName+"_path_"+C)}catch(A){if(!this.ignoreErrors)throw A;return(0,y.warn)(`getPathGenerator - ignoring character: "${A}".`),this.compiledGlyphs[C]=function(o,d){}}if(this.isEvalSupported&&y.FeatureTest.isEvalSupported){const A=[];for(const o of T){const d=o.args!==void 0?o.args.join(","):"";A.push("c.",o.cmd,"(",d,`);
`)}return this.compiledGlyphs[C]=new Function("c","size",A.join(""))}return this.compiledGlyphs[C]=function(A,o){for(const d of T)d.cmd==="scale"&&(d.args=[o,-o]),A[d.cmd].apply(A,d.args)}}}},62:(dt,et,V)=>{V.d(et,{Metadata:()=>z});var y=V(292);class z{#t;#e;constructor({parsedData:U,rawData:F}){this.#t=U,this.#e=F}getRaw(){return this.#e}get(U){return this.#t.get(U)??null}getAll(){return(0,y.objectFromMap)(this.#t)}has(U){return this.#t.has(U)}}},457:(dt,et,V)=>{V.d(et,{PDFNetworkStream:()=>T});var y=V(292),z=V(490);const _=200,U=206;function F(d){const u=d.response;return typeof u!="string"?u:(0,y.stringToBytes)(u).buffer}class C{constructor(u,b={}){this.url=u,this.isHttp=/^https?:/i.test(u),this.httpHeaders=this.isHttp&&b.httpHeaders||Object.create(null),this.withCredentials=b.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(u,b,s){const g={begin:u,end:b};for(const t in s)g[t]=s[t];return this.request(g)}requestFull(u){return this.request(u)}request(u){const b=new XMLHttpRequest,s=this.currXhrId++,g=this.pendingRequests[s]={xhr:b};b.open("GET",this.url),b.withCredentials=this.withCredentials;for(const t in this.httpHeaders){const r=this.httpHeaders[t];r!==void 0&&b.setRequestHeader(t,r)}return this.isHttp&&"begin"in u&&"end"in u?(b.setRequestHeader("Range",`bytes=${u.begin}-${u.end-1}`),g.expectedStatus=U):g.expectedStatus=_,b.responseType="arraybuffer",u.onError&&(b.onerror=function(t){u.onError(b.status)}),b.onreadystatechange=this.onStateChange.bind(this,s),b.onprogress=this.onProgress.bind(this,s),g.onHeadersReceived=u.onHeadersReceived,g.onDone=u.onDone,g.onError=u.onError,g.onProgress=u.onProgress,b.send(null),s}onProgress(u,b){const s=this.pendingRequests[u];s&&s.onProgress?.(b)}onStateChange(u,b){const s=this.pendingRequests[u];if(!s)return;const g=s.xhr;if(g.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),g.readyState!==4||!(u in this.pendingRequests))return;if(delete this.pendingRequests[u],g.status===0&&this.isHttp){s.onError?.(g.status);return}const t=g.status||_;if(!(t===_&&s.expectedStatus===U)&&t!==s.expectedStatus){s.onError?.(g.status);return}const c=F(g);if(t===U){const f=g.getResponseHeader("Content-Range"),v=/bytes (\d+)-(\d+)\/(\d+)/.exec(f);s.onDone({begin:parseInt(v[1],10),chunk:c})}else c?s.onDone({begin:0,chunk:c}):s.onError?.(g.status)}getRequestXhr(u){return this.pendingRequests[u].xhr}isPendingRequest(u){return u in this.pendingRequests}abortRequest(u){const b=this.pendingRequests[u].xhr;delete this.pendingRequests[u],b.abort()}}class T{constructor(u){this._source=u,this._manager=new C(u.url,{httpHeaders:u.httpHeaders,withCredentials:u.withCredentials}),this._rangeChunkSize=u.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(u){const b=this._rangeRequestReaders.indexOf(u);b>=0&&this._rangeRequestReaders.splice(b,1)}getFullReader(){return(0,y.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new A(this._manager,this._source),this._fullRequestReader}getRangeReader(u,b){const s=new o(this._manager,u,b);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(u){this._fullRequestReader?.cancel(u);for(const b of this._rangeRequestReaders.slice(0))b.cancel(u)}}class A{constructor(u,b){this._manager=u;const s={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=b.url,this._fullRequestId=u.requestFull(s),this._headersReceivedCapability=Promise.withResolvers(),this._disableRange=b.disableRange||!1,this._contentLength=b.length,this._rangeChunkSize=b.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const u=this._fullRequestId,b=this._manager.getRequestXhr(u),s=r=>b.getResponseHeader(r),{allowRangeRequests:g,suggestedLength:t}=(0,z.validateRangeRequestCapabilities)({getResponseHeader:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});g&&(this._isRangeSupported=!0),this._contentLength=t||this._contentLength,this._filename=(0,z.extractFilenameFromHeader)(s),this._isRangeSupported&&this._manager.abortRequest(u),this._headersReceivedCapability.resolve()}_onDone(u){if(u&&(this._requests.length>0?this._requests.shift().resolve({value:u.chunk,done:!1}):this._cachedChunks.push(u.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const b of this._requests)b.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(u){this._storedError=(0,z.createResponseStatusError)(u,this._url),this._headersReceivedCapability.reject(this._storedError);for(const b of this._requests)b.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(u){this.onProgress?.({loaded:u.loaded,total:u.lengthComputable?u.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const u=Promise.withResolvers();return this._requests.push(u),u.promise}cancel(u){this._done=!0,this._headersReceivedCapability.reject(u);for(const b of this._requests)b.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class o{constructor(u,b,s){this._manager=u;const g={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=u.url,this._requestId=u.requestRange(b,s,g),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(u){const b=u.chunk;this._requests.length>0?this._requests.shift().resolve({value:b,done:!1}):this._queuedChunk=b,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(u){this._storedError=(0,z.createResponseStatusError)(u,this._url);for(const b of this._requests)b.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(u){this.isStreamingSupported||this.onProgress?.({loaded:u.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const b=this._queuedChunk;return this._queuedChunk=null,{value:b,done:!1}}if(this._done)return{value:void 0,done:!0};const u=Promise.withResolvers();return this._requests.push(u),u.promise}cancel(u){this._done=!0;for(const b of this._requests)b.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},490:(dt,et,V)=>{V.d(et,{createResponseStatusError:()=>C,extractFilenameFromHeader:()=>F,validateRangeRequestCapabilities:()=>U,validateResponseStatus:()=>T});var y=V(292);function z(A){let o=!0,d=u("filename\\*","i").exec(A);if(d){d=d[1];let f=t(d);return f=unescape(f),f=r(f),f=c(f),s(f)}if(d=g(A),d){const f=c(d);return s(f)}if(d=u("filename","i").exec(A),d){d=d[1];let f=t(d);return f=c(f),s(f)}function u(f,v){return new RegExp("(?:^|;)\\s*"+f+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',v)}function b(f,v){if(f){if(!/^[\x00-\xFF]+$/.test(v))return v;try{const S=new TextDecoder(f,{fatal:!0}),M=(0,y.stringToBytes)(v);v=S.decode(M),o=!1}catch{}}return v}function s(f){return o&&/[\x80-\xff]/.test(f)&&(f=b("utf-8",f),o&&(f=b("iso-8859-1",f))),f}function g(f){const v=[];let S;const M=u("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(S=M.exec(f))!==null;){let[,O,N,B]=S;if(O=parseInt(O,10),O in v){if(O===0)break;continue}v[O]=[N,B]}const I=[];for(let O=0;O<v.length&&O in v;++O){let[N,B]=v[O];B=t(B),N&&(B=unescape(B),O===0&&(B=r(B))),I.push(B)}return I.join("")}function t(f){if(f.startsWith('"')){const v=f.slice(1).split('\\"');for(let S=0;S<v.length;++S){const M=v[S].indexOf('"');M!==-1&&(v[S]=v[S].slice(0,M),v.length=S+1),v[S]=v[S].replaceAll(/\\(.)/g,"$1")}f=v.join('"')}return f}function r(f){const v=f.indexOf("'");if(v===-1)return f;const S=f.slice(0,v),I=f.slice(v+1).replace(/^[^']*'/,"");return b(S,I)}function c(f){return!f.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(f)?f:f.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(v,S,M,I){if(M==="q"||M==="Q")return I=I.replaceAll("_"," "),I=I.replaceAll(/=([0-9a-fA-F]{2})/g,function(O,N){return String.fromCharCode(parseInt(N,16))}),b(S,I);try{I=atob(I)}catch{}return b(S,I)})}return""}var _=V(419);function U({getResponseHeader:A,isHttp:o,rangeChunkSize:d,disableRange:u}){const b={allowRangeRequests:!1,suggestedLength:void 0},s=parseInt(A("Content-Length"),10);return!Number.isInteger(s)||(b.suggestedLength=s,s<=2*d)||u||!o||A("Accept-Ranges")!=="bytes"||(A("Content-Encoding")||"identity")!=="identity"||(b.allowRangeRequests=!0),b}function F(A){const o=A("Content-Disposition");if(o){let d=z(o);if(d.includes("%"))try{d=decodeURIComponent(d)}catch{}if((0,_.isPdfFile)(d))return d}return null}function C(A,o){return A===404||A===0&&o.startsWith("file:")?new y.MissingPDFException('Missing PDF "'+o+'".'):new y.UnexpectedResponseException(`Unexpected server response (${A}) while retrieving PDF "${o}".`,A)}function T(A){return A===200||A===206}},786:(dt,et,V)=>{V.a(dt,async(y,z)=>{try{let d=function(v){const S=A.parse(v);return S.protocol==="file:"||S.host?S:/^[a-z]:[/\\]/i.test(v)?A.parse(`file:///${v}`):(S.host||(S.protocol="file:"),S)},g=function(v,S){return{protocol:v.protocol,auth:v.auth,host:v.hostname,port:v.port,path:v.path,method:"GET",headers:S}};V.d(et,{PDFNodeStream:()=>u});var _=V(292),U=V(490);let F,C,T,A;_.isNodeJS&&(F=await Rt(()=>import("./__vite-browser-external-b25bb000.js"),[]),C=await Rt(()=>import("./__vite-browser-external-b25bb000.js"),[]),T=await Rt(()=>import("./__vite-browser-external-b25bb000.js"),[]),A=await Rt(()=>import("./__vite-browser-external-b25bb000.js"),[]));const o=/^file:\/\/\/[a-zA-Z]:\//;class u{constructor(S){this.source=S,this.url=d(S.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&S.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,_.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new c(this):new t(this),this._fullRequestReader}getRangeReader(S,M){if(M<=this._progressiveDataLength)return null;const I=this.isFsUrl?new f(this,S,M):new r(this,S,M);return this._rangeRequestReaders.push(I),I}cancelAllRequests(S){this._fullRequestReader?.cancel(S);for(const M of this._rangeRequestReaders.slice(0))M.cancel(S)}}class b{constructor(S){this._url=S.url,this._done=!1,this._storedError=null,this.onProgress=null;const M=S.source;this._contentLength=M.length,this._loaded=0,this._filename=null,this._disableRange=M.disableRange||!1,this._rangeChunkSize=M.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!M.disableStream,this._isRangeSupported=!M.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const S=this._readableStream.read();return S===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=S.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(S).buffer,done:!1})}cancel(S){if(!this._readableStream){this._error(S);return}this._readableStream.destroy(S)}_error(S){this._storedError=S,this._readCapability.resolve()}_setReadableStream(S){this._readableStream=S,S.on("readable",()=>{this._readCapability.resolve()}),S.on("end",()=>{S.destroy(),this._done=!0,this._readCapability.resolve()}),S.on("error",M=>{this._error(M)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new _.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class s{constructor(S){this._url=S.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const M=S.source;this._isStreamingSupported=!M.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const S=this._readableStream.read();return S===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=S.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(S).buffer,done:!1})}cancel(S){if(!this._readableStream){this._error(S);return}this._readableStream.destroy(S)}_error(S){this._storedError=S,this._readCapability.resolve()}_setReadableStream(S){this._readableStream=S,S.on("readable",()=>{this._readCapability.resolve()}),S.on("end",()=>{S.destroy(),this._done=!0,this._readCapability.resolve()}),S.on("error",M=>{this._error(M)}),this._storedError&&this._readableStream.destroy(this._storedError)}}class t extends b{constructor(S){super(S);const M=I=>{if(I.statusCode===404){const q=new _.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=q,this._headersCapability.reject(q);return}this._headersCapability.resolve(),this._setReadableStream(I);const O=q=>this._readableStream.headers[q.toLowerCase()],{allowRangeRequests:N,suggestedLength:B}=(0,U.validateRangeRequestCapabilities)({getResponseHeader:O,isHttp:S.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=N,this._contentLength=B||this._contentLength,this._filename=(0,U.extractFilenameFromHeader)(O)};this._request=null,this._url.protocol==="http:"?this._request=C.request(g(this._url,S.httpHeaders),M):this._request=T.request(g(this._url,S.httpHeaders),M),this._request.on("error",I=>{this._storedError=I,this._headersCapability.reject(I)}),this._request.end()}}class r extends s{constructor(S,M,I){super(S),this._httpHeaders={};for(const N in S.httpHeaders){const B=S.httpHeaders[N];B!==void 0&&(this._httpHeaders[N]=B)}this._httpHeaders.Range=`bytes=${M}-${I-1}`;const O=N=>{if(N.statusCode===404){const B=new _.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=B;return}this._setReadableStream(N)};this._request=null,this._url.protocol==="http:"?this._request=C.request(g(this._url,this._httpHeaders),O):this._request=T.request(g(this._url,this._httpHeaders),O),this._request.on("error",N=>{this._storedError=N}),this._request.end()}}class c extends b{constructor(S){super(S);let M=decodeURIComponent(this._url.path);o.test(this._url.href)&&(M=M.replace(/^\//,"")),F.promises.lstat(M).then(I=>{this._contentLength=I.size,this._setReadableStream(F.createReadStream(M)),this._headersCapability.resolve()},I=>{I.code==="ENOENT"&&(I=new _.MissingPDFException(`Missing PDF "${M}".`)),this._storedError=I,this._headersCapability.reject(I)})}}class f extends s{constructor(S,M,I){super(S);let O=decodeURIComponent(this._url.path);o.test(this._url.href)&&(O=O.replace(/^\//,"")),this._setReadableStream(F.createReadStream(O,{start:M,end:I-1}))}}z()}catch(F){z(F)}},1)},573:(dt,et,V)=>{V.a(dt,async(y,z)=>{try{V.d(et,{NodeCMapReaderFactory:()=>u,NodeCanvasFactory:()=>d,NodeFilterFactory:()=>o,NodeStandardFontDataFactory:()=>b});var _=V(583),U=V(292);let F,C,T;if(U.isNodeJS){F=await Rt(()=>import("./__vite-browser-external-b25bb000.js"),[]);try{C=await Rt(()=>import("./__vite-browser-external-b25bb000.js"),[])}catch{}try{T=await Rt(()=>import("./index-9d5554b1.js"),[])}catch{}}const A=function(s){return F.promises.readFile(s).then(g=>new Uint8Array(g))};class o extends _.BaseFilterFactory{}class d extends _.BaseCanvasFactory{_createCanvas(g,t){return C.createCanvas(g,t)}}class u extends _.BaseCMapReaderFactory{_fetchData(g,t){return A(g).then(r=>({cMapData:r,compressionType:t}))}}class b extends _.BaseStandardFontDataFactory{_fetchData(g){return A(g)}}z()}catch(F){z(F)}},1)},626:(dt,et,V)=>{V.d(et,{OptionalContentConfig:()=>F});var y=V(292),z=V(651);const _=Symbol("INTERNAL");class U{#t=!1;#e=!1;#s=!1;#n=!0;constructor(T,{name:A,intent:o,usage:d}){this.#t=!!(T&y.RenderingIntentFlag.DISPLAY),this.#e=!!(T&y.RenderingIntentFlag.PRINT),this.name=A,this.intent=o,this.usage=d}get visible(){if(this.#s)return this.#n;if(!this.#n)return!1;const{print:T,view:A}=this.usage;return this.#t?A?.viewState!=="OFF":this.#e?T?.printState!=="OFF":!0}_setVisible(T,A,o=!1){T!==_&&(0,y.unreachable)("Internal method `_setVisible` called."),this.#s=o,this.#n=A}}class F{#t=null;#e=new Map;#s=null;#n=null;constructor(T,A=y.RenderingIntentFlag.DISPLAY){if(this.renderingIntent=A,this.name=null,this.creator=null,T!==null){this.name=T.name,this.creator=T.creator,this.#n=T.order;for(const o of T.groups)this.#e.set(o.id,new U(A,o));if(T.baseState==="OFF")for(const o of this.#e.values())o._setVisible(_,!1);for(const o of T.on)this.#e.get(o)._setVisible(_,!0);for(const o of T.off)this.#e.get(o)._setVisible(_,!1);this.#s=this.getHash()}}#r(T){const A=T.length;if(A<2)return!0;const o=T[0];for(let d=1;d<A;d++){const u=T[d];let b;if(Array.isArray(u))b=this.#r(u);else if(this.#e.has(u))b=this.#e.get(u).visible;else return(0,y.warn)(`Optional content group not found: ${u}`),!0;switch(o){case"And":if(!b)return!1;break;case"Or":if(b)return!0;break;case"Not":return!b;default:return!0}}return o==="And"}isVisible(T){if(this.#e.size===0)return!0;if(!T)return(0,y.info)("Optional content group not defined."),!0;if(T.type==="OCG")return this.#e.has(T.id)?this.#e.get(T.id).visible:((0,y.warn)(`Optional content group not found: ${T.id}`),!0);if(T.type==="OCMD"){if(T.expression)return this.#r(T.expression);if(!T.policy||T.policy==="AnyOn"){for(const A of T.ids){if(!this.#e.has(A))return(0,y.warn)(`Optional content group not found: ${A}`),!0;if(this.#e.get(A).visible)return!0}return!1}else if(T.policy==="AllOn"){for(const A of T.ids){if(!this.#e.has(A))return(0,y.warn)(`Optional content group not found: ${A}`),!0;if(!this.#e.get(A).visible)return!1}return!0}else if(T.policy==="AnyOff"){for(const A of T.ids){if(!this.#e.has(A))return(0,y.warn)(`Optional content group not found: ${A}`),!0;if(!this.#e.get(A).visible)return!0}return!1}else if(T.policy==="AllOff"){for(const A of T.ids){if(!this.#e.has(A))return(0,y.warn)(`Optional content group not found: ${A}`),!0;if(this.#e.get(A).visible)return!1}return!0}return(0,y.warn)(`Unknown optional content policy ${T.policy}.`),!0}return(0,y.warn)(`Unknown group type ${T.type}.`),!0}setVisibility(T,A=!0){const o=this.#e.get(T);if(!o){(0,y.warn)(`Optional content group not found: ${T}`);return}o._setVisible(_,!!A,!0),this.#t=null}setOCGState({state:T,preserveRB:A}){let o;for(const d of T){switch(d){case"ON":case"OFF":case"Toggle":o=d;continue}const u=this.#e.get(d);if(u)switch(o){case"ON":u._setVisible(_,!0);break;case"OFF":u._setVisible(_,!1);break;case"Toggle":u._setVisible(_,!u.visible);break}}this.#t=null}get hasInitialVisibility(){return this.#s===null||this.getHash()===this.#s}getOrder(){return this.#e.size?this.#n?this.#n.slice():[...this.#e.keys()]:null}getGroups(){return this.#e.size>0?(0,y.objectFromMap)(this.#e):null}getGroup(T){return this.#e.get(T)||null}getHash(){if(this.#t!==null)return this.#t;const T=new z.MurmurHash3_64;for(const[A,o]of this.#e)T.update(`${A}:${o.visible}`);return this.#t=T.hexdigest()}}},814:(dt,et,V)=>{V.d(et,{cleanupTextLayer:()=>o,renderTextLayer:()=>t,updateTextLayer:()=>r});var y=V(292),z=V(419);const _=1e5,U=30,F=.8,C=new Map;let T=null;function A(){if(!T){const c=document.createElement("canvas");c.className="hiddenCanvasElement",document.body.append(c),T=c.getContext("2d",{alpha:!1})}return T}function o(){T?.canvas.remove(),T=null}function d(c){const f=C.get(c);if(f)return f;const v=A(),S=v.font;v.canvas.width=v.canvas.height=U,v.font=`${U}px ${c}`;const M=v.measureText("");let I=M.fontBoundingBoxAscent,O=Math.abs(M.fontBoundingBoxDescent);if(I){const B=I/(I+O);return C.set(c,B),v.canvas.width=v.canvas.height=0,v.font=S,B}v.strokeStyle="red",v.clearRect(0,0,U,U),v.strokeText("g",0,0);let N=v.getImageData(0,0,U,U).data;O=0;for(let B=N.length-1-3;B>=0;B-=4)if(N[B]>0){O=Math.ceil(B/4/U);break}v.clearRect(0,0,U,U),v.strokeText("A",0,U),N=v.getImageData(0,0,U,U).data,I=0;for(let B=0,q=N.length;B<q;B+=4)if(N[B]>0){I=U-Math.floor(B/4/U);break}if(v.canvas.width=v.canvas.height=0,v.font=S,I){const B=I/(I+O);return C.set(c,B),B}return C.set(c,F),F}function u(c,f,v){const S=document.createElement("span"),M={angle:0,canvasWidth:0,hasText:f.str!=="",hasEOL:f.hasEOL,fontSize:0};c._textDivs.push(S);const I=y.Util.transform(c._transform,f.transform);let O=Math.atan2(I[1],I[0]);const N=v[f.fontName];N.vertical&&(O+=Math.PI/2);const B=c._fontInspectorEnabled&&N.fontSubstitution||N.fontFamily,q=Math.hypot(I[2],I[3]),st=q*d(B);let X,H;O===0?(X=I[4],H=I[5]-st):(X=I[4]+st*Math.sin(O),H=I[5]-st*Math.cos(O));const G="calc(var(--scale-factor)*",Y=S.style;c._container===c._rootContainer?(Y.left=`${(100*X/c._pageWidth).toFixed(2)}%`,Y.top=`${(100*H/c._pageHeight).toFixed(2)}%`):(Y.left=`${G}${X.toFixed(2)}px)`,Y.top=`${G}${H.toFixed(2)}px)`),Y.fontSize=`${G}${q.toFixed(2)}px)`,Y.fontFamily=B,M.fontSize=q,S.setAttribute("role","presentation"),S.textContent=f.str,S.dir=f.dir,c._fontInspectorEnabled&&(S.dataset.fontName=N.fontSubstitutionLoadedName||f.fontName),O!==0&&(M.angle=O*(180/Math.PI));let Q=!1;if(f.str.length>1)Q=!0;else if(f.str!==" "&&f.transform[0]!==f.transform[3]){const K=Math.abs(f.transform[0]),at=Math.abs(f.transform[3]);K!==at&&Math.max(K,at)/Math.min(K,at)>1.5&&(Q=!0)}Q&&(M.canvasWidth=N.vertical?f.height:f.width),c._textDivProperties.set(S,M),c._isReadableStream&&c._layoutText(S)}function b(c){const{div:f,scale:v,properties:S,ctx:M,prevFontSize:I,prevFontFamily:O}=c,{style:N}=f;let B="";if(S.canvasWidth!==0&&S.hasText){const{fontFamily:q}=N,{canvasWidth:st,fontSize:X}=S;(I!==X||O!==q)&&(M.font=`${X*v}px ${q}`,c.prevFontSize=X,c.prevFontFamily=q);const{width:H}=M.measureText(f.textContent);H>0&&(B=`scaleX(${st*v/H})`)}S.angle!==0&&(B=`rotate(${S.angle}deg) ${B}`),B.length>0&&(N.transform=B)}function s(c){if(c._canceled)return;const f=c._textDivs,v=c._capability;if(f.length>_){v.resolve();return}if(!c._isReadableStream)for(const M of f)c._layoutText(M);v.resolve()}class g{constructor({textContentSource:f,container:v,viewport:S,textDivs:M,textDivProperties:I,textContentItemsStr:O}){this._textContentSource=f,this._isReadableStream=f instanceof ReadableStream,this._container=this._rootContainer=v,this._textDivs=M||[],this._textContentItemsStr=O||[],this._fontInspectorEnabled=!!globalThis.FontInspector?.enabled,this._reader=null,this._textDivProperties=I||new WeakMap,this._canceled=!1,this._capability=Promise.withResolvers(),this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:S.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:A()};const{pageWidth:N,pageHeight:B,pageX:q,pageY:st}=S.rawDims;this._transform=[1,0,0,-1,-q,st+B],this._pageWidth=N,this._pageHeight=B,(0,z.setLayerDimensions)(v,S),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new y.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new y.AbortException("TextLayer task cancelled."))}_processItems(f,v){for(const S of f){if(S.str===void 0){if(S.type==="beginMarkedContentProps"||S.type==="beginMarkedContent"){const M=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),S.id!==null&&this._container.setAttribute("id",`${S.id}`),M.append(this._container)}else S.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(S.str),u(this,S,v)}}_layoutText(f){const v=this._layoutTextParams.properties=this._textDivProperties.get(f);if(this._layoutTextParams.div=f,b(this._layoutTextParams),v.hasText&&this._container.append(f),v.hasEOL){const S=document.createElement("br");S.setAttribute("role","presentation"),this._container.append(S)}}_render(){const{promise:f,resolve:v,reject:S}=Promise.withResolvers();let M=Object.create(null);if(this._isReadableStream){const I=()=>{this._reader.read().then(({value:O,done:N})=>{if(N){v();return}Object.assign(M,O.styles),this._processItems(O.items,M),I()},S)};this._reader=this._textContentSource.getReader(),I()}else if(this._textContentSource){const{items:I,styles:O}=this._textContentSource;this._processItems(I,O),v()}else throw new Error('No "textContentSource" parameter specified.');f.then(()=>{M=null,s(this)},this._capability.reject)}}function t(c){const f=new g(c);return f._render(),f}function r({container:c,viewport:f,textDivs:v,textDivProperties:S,mustRotate:M=!0,mustRescale:I=!0}){if(M&&(0,z.setLayerDimensions)(c,{rotation:f.rotation}),I){const O=A(),B={prevFontSize:null,prevFontFamily:null,div:null,scale:f.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:O};for(const q of v)B.properties=S.get(q),B.div=q,b(B)}}},585:(dt,et,V)=>{V.d(et,{PDFDataTransportStream:()=>_});var y=V(292),z=V(419);class _{constructor(T,{disableRange:A=!1,disableStream:o=!1}){(0,y.assert)(T,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:d,initialData:u,progressiveDone:b,contentDispositionFilename:s}=T;if(this._queuedChunks=[],this._progressiveDone=b,this._contentDispositionFilename=s,u?.length>0){const g=u instanceof Uint8Array&&u.byteLength===u.buffer.byteLength?u.buffer:new Uint8Array(u).buffer;this._queuedChunks.push(g)}this._pdfDataRangeTransport=T,this._isStreamingSupported=!o,this._isRangeSupported=!A,this._contentLength=d,this._fullRequestReader=null,this._rangeReaders=[],T.addRangeListener((g,t)=>{this._onReceiveData({begin:g,chunk:t})}),T.addProgressListener((g,t)=>{this._onProgress({loaded:g,total:t})}),T.addProgressiveReadListener(g=>{this._onReceiveData({chunk:g})}),T.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),T.transportReady()}_onReceiveData({begin:T,chunk:A}){const o=A instanceof Uint8Array&&A.byteLength===A.buffer.byteLength?A.buffer:new Uint8Array(A).buffer;if(T===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(o):this._queuedChunks.push(o);else{const d=this._rangeReaders.some(function(u){return u._begin!==T?!1:(u._enqueue(o),!0)});(0,y.assert)(d,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(T){T.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:T.loaded}):this._fullRequestReader?.onProgress?.({loaded:T.loaded,total:T.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(T){const A=this._rangeReaders.indexOf(T);A>=0&&this._rangeReaders.splice(A,1)}getFullReader(){(0,y.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const T=this._queuedChunks;return this._queuedChunks=null,new U(this,T,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(T,A){if(A<=this._progressiveDataLength)return null;const o=new F(this,T,A);return this._pdfDataRangeTransport.requestDataRange(T,A),this._rangeReaders.push(o),o}cancelAllRequests(T){this._fullRequestReader?.cancel(T);for(const A of this._rangeReaders.slice(0))A.cancel(T);this._pdfDataRangeTransport.abort()}}class U{constructor(T,A,o=!1,d=null){this._stream=T,this._done=o||!1,this._filename=(0,z.isPdfFile)(d)?d:null,this._queuedChunks=A||[],this._loaded=0;for(const u of this._queuedChunks)this._loaded+=u.byteLength;this._requests=[],this._headersReady=Promise.resolve(),T._fullRequestReader=this,this.onProgress=null}_enqueue(T){this._done||(this._requests.length>0?this._requests.shift().resolve({value:T,done:!1}):this._queuedChunks.push(T),this._loaded+=T.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const T=Promise.withResolvers();return this._requests.push(T),T.promise}cancel(T){this._done=!0;for(const A of this._requests)A.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class F{constructor(T,A,o){this._stream=T,this._begin=A,this._end=o,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(T){if(!this._done){if(this._requests.length===0)this._queuedChunk=T;else{this._requests.shift().resolve({value:T,done:!1});for(const o of this._requests)o.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const A=this._queuedChunk;return this._queuedChunk=null,{value:A,done:!1}}if(this._done)return{value:void 0,done:!0};const T=Promise.withResolvers();return this._requests.push(T),T.promise}cancel(T){this._done=!0;for(const A of this._requests)A.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},164:(dt,et,V)=>{V.d(et,{GlobalWorkerOptions:()=>y});class y{static#t=null;static#e="";static get workerPort(){return this.#t}static set workerPort(_){if(!(typeof Worker<"u"&&_ instanceof Worker)&&_!==null)throw new Error("Invalid `workerPort` type.");this.#t=_}static get workerSrc(){return this.#e}static set workerSrc(_){if(typeof _!="string")throw new Error("Invalid `workerSrc` type.");this.#e=_}}},284:(dt,et,V)=>{V.d(et,{XfaLayer:()=>z});var y=V(50);class z{static setupStorage(U,F,C,T,A){const o=T.getValue(F,{value:null});switch(C.name){case"textarea":if(o.value!==null&&(U.textContent=o.value),A==="print")break;U.addEventListener("input",d=>{T.setValue(F,{value:d.target.value})});break;case"input":if(C.attributes.type==="radio"||C.attributes.type==="checkbox"){if(o.value===C.attributes.xfaOn?U.setAttribute("checked",!0):o.value===C.attributes.xfaOff&&U.removeAttribute("checked"),A==="print")break;U.addEventListener("change",d=>{T.setValue(F,{value:d.target.checked?d.target.getAttribute("xfaOn"):d.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&U.setAttribute("value",o.value),A==="print")break;U.addEventListener("input",d=>{T.setValue(F,{value:d.target.value})})}break;case"select":if(o.value!==null){U.setAttribute("value",o.value);for(const d of C.children)d.attributes.value===o.value?d.attributes.selected=!0:d.attributes.hasOwnProperty("selected")&&delete d.attributes.selected}U.addEventListener("input",d=>{const u=d.target.options,b=u.selectedIndex===-1?"":u[u.selectedIndex].value;T.setValue(F,{value:b})});break}}static setAttributes({html:U,element:F,storage:C=null,intent:T,linkService:A}){const{attributes:o}=F,d=U instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${T}`);for(const[u,b]of Object.entries(o))if(b!=null)switch(u){case"class":b.length&&U.setAttribute(u,b.join(" "));break;case"dataId":break;case"id":U.setAttribute("data-element-id",b);break;case"style":Object.assign(U.style,b);break;case"textContent":U.textContent=b;break;default:(!d||u!=="href"&&u!=="newWindow")&&U.setAttribute(u,b)}d&&A.addLinkAttributes(U,o.href,o.newWindow),C&&o.dataId&&this.setupStorage(U,o.dataId,F,C)}static render(U){const F=U.annotationStorage,C=U.linkService,T=U.xfaHtml,A=U.intent||"display",o=document.createElement(T.name);T.attributes&&this.setAttributes({html:o,element:T,intent:A,linkService:C});const d=A!=="richText",u=U.div;if(u.append(o),U.viewport){const g=`matrix(${U.viewport.transform.join(",")})`;u.style.transform=g}d&&u.setAttribute("class","xfaLayer xfaFont");const b=[];if(T.children.length===0){if(T.value){const g=document.createTextNode(T.value);o.append(g),d&&y.XfaText.shouldBuildText(T.name)&&b.push(g)}return{textDivs:b}}const s=[[T,-1,o]];for(;s.length>0;){const[g,t,r]=s.at(-1);if(t+1===g.children.length){s.pop();continue}const c=g.children[++s.at(-1)[1]];if(c===null)continue;const{name:f}=c;if(f==="#text"){const S=document.createTextNode(c.value);b.push(S),r.append(S);continue}const v=c?.attributes?.xmlns?document.createElementNS(c.attributes.xmlns,f):document.createElement(f);if(r.append(v),c.attributes&&this.setAttributes({html:v,element:c,storage:F,intent:A,linkService:C}),c.children?.length>0)s.push([c,-1,v]);else if(c.value){const S=document.createTextNode(c.value);d&&y.XfaText.shouldBuildText(f)&&b.push(S),v.append(S)}}for(const g of u.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))g.setAttribute("readOnly",!0);return{textDivs:b}}static update(U){const F=`matrix(${U.viewport.transform.join(",")})`;U.div.style.transform=F,U.div.hidden=!1}}},50:(dt,et,V)=>{V.d(et,{XfaText:()=>y});class y{static textContent(_){const U=[],F={items:U,styles:Object.create(null)};function C(T){if(!T)return;let A=null;const o=T.name;if(o==="#text")A=T.value;else if(y.shouldBuildText(o))T?.attributes?.textContent?A=T.attributes.textContent:T.value&&(A=T.value);else return;if(A!==null&&U.push({str:A}),!!T.children)for(const d of T.children)C(d)}return C(_),F}static shouldBuildText(_){return!(_==="textarea"||_==="input"||_==="option"||_==="select")}}},228:(dt,et,V)=>{V.a(dt,async(y,z)=>{try{V.d(et,{AbortException:()=>_.AbortException,AnnotationEditorLayer:()=>T.AnnotationEditorLayer,AnnotationEditorParamsType:()=>_.AnnotationEditorParamsType,AnnotationEditorType:()=>_.AnnotationEditorType,AnnotationEditorUIManager:()=>A.AnnotationEditorUIManager,AnnotationLayer:()=>o.AnnotationLayer,AnnotationMode:()=>_.AnnotationMode,CMapCompressionType:()=>_.CMapCompressionType,ColorPicker:()=>d.ColorPicker,DOMSVGFactory:()=>F.DOMSVGFactory,DrawLayer:()=>u.DrawLayer,FeatureTest:()=>_.FeatureTest,GlobalWorkerOptions:()=>b.GlobalWorkerOptions,ImageKind:()=>_.ImageKind,InvalidPDFException:()=>_.InvalidPDFException,MissingPDFException:()=>_.MissingPDFException,OPS:()=>_.OPS,Outliner:()=>s.Outliner,PDFDataRangeTransport:()=>U.PDFDataRangeTransport,PDFDateString:()=>F.PDFDateString,PDFWorker:()=>U.PDFWorker,PasswordResponses:()=>_.PasswordResponses,PermissionFlag:()=>_.PermissionFlag,PixelsPerInch:()=>F.PixelsPerInch,RenderingCancelledException:()=>F.RenderingCancelledException,UnexpectedResponseException:()=>_.UnexpectedResponseException,Util:()=>_.Util,VerbosityLevel:()=>_.VerbosityLevel,XfaLayer:()=>g.XfaLayer,build:()=>U.build,createValidAbsoluteUrl:()=>_.createValidAbsoluteUrl,fetchData:()=>F.fetchData,getDocument:()=>U.getDocument,getFilenameFromUrl:()=>F.getFilenameFromUrl,getPdfFilenameFromUrl:()=>F.getPdfFilenameFromUrl,getXfaPageViewport:()=>F.getXfaPageViewport,isDataScheme:()=>F.isDataScheme,isPdfFile:()=>F.isPdfFile,noContextMenu:()=>F.noContextMenu,normalizeUnicode:()=>_.normalizeUnicode,renderTextLayer:()=>C.renderTextLayer,setLayerDimensions:()=>F.setLayerDimensions,shadow:()=>_.shadow,updateTextLayer:()=>C.updateTextLayer,version:()=>U.version});var _=V(292),U=V(831),F=V(419),C=V(814),T=V(731),A=V(830),o=V(976),d=V(259),u=V(47),b=V(164),s=V(61),g=V(284),t=y([U]);U=(t.then?(await t)():t)[0];const r="4.1.392",c="fcb76a78d";z()}catch(r){z(r)}})},178:(dt,et,V)=>{V.d(et,{MessageHandler:()=>F});var y=V(292);const z={UNKNOWN:0,DATA:1,ERROR:2},_={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function U(C){switch(C instanceof Error||typeof C=="object"&&C!==null||(0,y.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),C.name){case"AbortException":return new y.AbortException(C.message);case"MissingPDFException":return new y.MissingPDFException(C.message);case"PasswordException":return new y.PasswordException(C.message,C.code);case"UnexpectedResponseException":return new y.UnexpectedResponseException(C.message,C.status);case"UnknownErrorException":return new y.UnknownErrorException(C.message,C.details);default:return new y.UnknownErrorException(C.message,C.toString())}}class F{constructor(T,A,o){this.sourceName=T,this.targetName=A,this.comObj=o,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=d=>{const u=d.data;if(u.targetName!==this.sourceName)return;if(u.stream){this.#e(u);return}if(u.callback){const s=u.callbackId,g=this.callbackCapabilities[s];if(!g)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],u.callback===z.DATA)g.resolve(u.data);else if(u.callback===z.ERROR)g.reject(U(u.reason));else throw new Error("Unexpected callback case");return}const b=this.actionHandler[u.action];if(!b)throw new Error(`Unknown action from worker: ${u.action}`);if(u.callbackId){const s=this.sourceName,g=u.sourceName;new Promise(function(t){t(b(u.data))}).then(function(t){o.postMessage({sourceName:s,targetName:g,callback:z.DATA,callbackId:u.callbackId,data:t})},function(t){o.postMessage({sourceName:s,targetName:g,callback:z.ERROR,callbackId:u.callbackId,reason:U(t)})});return}if(u.streamId){this.#t(u);return}b(u.data)},o.addEventListener("message",this._onComObjOnMessage)}on(T,A){const o=this.actionHandler;if(o[T])throw new Error(`There is already an actionName called "${T}"`);o[T]=A}send(T,A,o){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:T,data:A},o)}sendWithPromise(T,A,o){const d=this.callbackId++,u=Promise.withResolvers();this.callbackCapabilities[d]=u;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:T,callbackId:d,data:A},o)}catch(b){u.reject(b)}return u.promise}sendWithStream(T,A,o,d){const u=this.streamId++,b=this.sourceName,s=this.targetName,g=this.comObj;return new ReadableStream({start:t=>{const r=Promise.withResolvers();return this.streamControllers[u]={controller:t,startCall:r,pullCall:null,cancelCall:null,isClosed:!1},g.postMessage({sourceName:b,targetName:s,action:T,streamId:u,data:A,desiredSize:t.desiredSize},d),r.promise},pull:t=>{const r=Promise.withResolvers();return this.streamControllers[u].pullCall=r,g.postMessage({sourceName:b,targetName:s,stream:_.PULL,streamId:u,desiredSize:t.desiredSize}),r.promise},cancel:t=>{(0,y.assert)(t instanceof Error,"cancel must have a valid reason");const r=Promise.withResolvers();return this.streamControllers[u].cancelCall=r,this.streamControllers[u].isClosed=!0,g.postMessage({sourceName:b,targetName:s,stream:_.CANCEL,streamId:u,reason:U(t)}),r.promise}},o)}#t(T){const A=T.streamId,o=this.sourceName,d=T.sourceName,u=this.comObj,b=this,s=this.actionHandler[T.action],g={enqueue(t,r=1,c){if(this.isCancelled)return;const f=this.desiredSize;this.desiredSize-=r,f>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),u.postMessage({sourceName:o,targetName:d,stream:_.ENQUEUE,streamId:A,chunk:t},c)},close(){this.isCancelled||(this.isCancelled=!0,u.postMessage({sourceName:o,targetName:d,stream:_.CLOSE,streamId:A}),delete b.streamSinks[A])},error(t){(0,y.assert)(t instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,u.postMessage({sourceName:o,targetName:d,stream:_.ERROR,streamId:A,reason:U(t)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:T.desiredSize,ready:null};g.sinkCapability.resolve(),g.ready=g.sinkCapability.promise,this.streamSinks[A]=g,new Promise(function(t){t(s(T.data,g))}).then(function(){u.postMessage({sourceName:o,targetName:d,stream:_.START_COMPLETE,streamId:A,success:!0})},function(t){u.postMessage({sourceName:o,targetName:d,stream:_.START_COMPLETE,streamId:A,reason:U(t)})})}#e(T){const A=T.streamId,o=this.sourceName,d=T.sourceName,u=this.comObj,b=this.streamControllers[A],s=this.streamSinks[A];switch(T.stream){case _.START_COMPLETE:T.success?b.startCall.resolve():b.startCall.reject(U(T.reason));break;case _.PULL_COMPLETE:T.success?b.pullCall.resolve():b.pullCall.reject(U(T.reason));break;case _.PULL:if(!s){u.postMessage({sourceName:o,targetName:d,stream:_.PULL_COMPLETE,streamId:A,success:!0});break}s.desiredSize<=0&&T.desiredSize>0&&s.sinkCapability.resolve(),s.desiredSize=T.desiredSize,new Promise(function(g){g(s.onPull?.())}).then(function(){u.postMessage({sourceName:o,targetName:d,stream:_.PULL_COMPLETE,streamId:A,success:!0})},function(g){u.postMessage({sourceName:o,targetName:d,stream:_.PULL_COMPLETE,streamId:A,reason:U(g)})});break;case _.ENQUEUE:if((0,y.assert)(b,"enqueue should have stream controller"),b.isClosed)break;b.controller.enqueue(T.chunk);break;case _.CLOSE:if((0,y.assert)(b,"close should have stream controller"),b.isClosed)break;b.isClosed=!0,b.controller.close(),this.#s(b,A);break;case _.ERROR:(0,y.assert)(b,"error should have stream controller"),b.controller.error(U(T.reason)),this.#s(b,A);break;case _.CANCEL_COMPLETE:T.success?b.cancelCall.resolve():b.cancelCall.reject(U(T.reason)),this.#s(b,A);break;case _.CANCEL:if(!s)break;new Promise(function(g){g(s.onCancel?.(U(T.reason)))}).then(function(){u.postMessage({sourceName:o,targetName:d,stream:_.CANCEL_COMPLETE,streamId:A,success:!0})},function(g){u.postMessage({sourceName:o,targetName:d,stream:_.CANCEL_COMPLETE,streamId:A,reason:U(g)})}),s.sinkCapability.reject(U(T.reason)),s.isCancelled=!0,delete this.streamSinks[A];break;default:throw new Error("Unexpected stream case")}}async#s(T,A){await Promise.allSettled([T.startCall?.promise,T.pullCall?.promise,T.cancelCall?.promise]),delete this.streamControllers[A]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}},651:(dt,et,V)=>{V.d(et,{MurmurHash3_64:()=>U});const y=3285377520,z=4294901760,_=65535;class U{constructor(C){this.h1=C?C&4294967295:y,this.h2=C?C&4294967295:y}update(C){let T,A;if(typeof C=="string"){T=new Uint8Array(C.length*2),A=0;for(let S=0,M=C.length;S<M;S++){const I=C.charCodeAt(S);I<=255?T[A++]=I:(T[A++]=I>>>8,T[A++]=I&255)}}else if(ArrayBuffer.isView(C))T=C.slice(),A=T.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const o=A>>2,d=A-o*4,u=new Uint32Array(T.buffer,0,o);let b=0,s=0,g=this.h1,t=this.h2;const r=3432918353,c=461845907,f=r&_,v=c&_;for(let S=0;S<o;S++)S&1?(b=u[S],b=b*r&z|b*f&_,b=b<<15|b>>>17,b=b*c&z|b*v&_,g^=b,g=g<<13|g>>>19,g=g*5+3864292196):(s=u[S],s=s*r&z|s*f&_,s=s<<15|s>>>17,s=s*c&z|s*v&_,t^=s,t=t<<13|t>>>19,t=t*5+3864292196);switch(b=0,d){case 3:b^=T[o*4+2]<<16;case 2:b^=T[o*4+1]<<8;case 1:b^=T[o*4],b=b*r&z|b*f&_,b=b<<15|b>>>17,b=b*c&z|b*v&_,o&1?g^=b:t^=b}this.h1=g,this.h2=t}hexdigest(){let C=this.h1,T=this.h2;return C^=T>>>1,C=C*3981806797&z|C*36045&_,T=T*4283543511&z|((T<<16|C>>>16)*2950163797&z)>>>16,C^=T>>>1,C=C*444984403&z|C*60499&_,T=T*3301882366&z|((T<<16|C>>>16)*3120437893&z)>>>16,C^=T>>>1,(C>>>0).toString(16).padStart(8,"0")+(T>>>0).toString(16).padStart(8,"0")}}},292:(dt,et,V)=>{V.d(et,{AbortException:()=>ht,AnnotationBorderStyleType:()=>t,AnnotationEditorParamsType:()=>d,AnnotationEditorPrefix:()=>A,AnnotationEditorType:()=>o,AnnotationMode:()=>T,AnnotationPrefix:()=>P,AnnotationType:()=>g,BaseException:()=>G,CMapCompressionType:()=>c,FONT_IDENTITY_MATRIX:()=>_,FeatureTest:()=>n,FormatError:()=>lt,IDENTITY_MATRIX:()=>z,ImageKind:()=>s,InvalidPDFException:()=>K,LINE_FACTOR:()=>F,MAX_IMAGE_SIZE_TO_CACHE:()=>U,MissingPDFException:()=>at,OPS:()=>f,PasswordException:()=>Y,PasswordResponses:()=>v,PermissionFlag:()=>u,RenderingIntentFlag:()=>C,TextRenderingMode:()=>b,UnexpectedResponseException:()=>ot,UnknownErrorException:()=>Q,Util:()=>i,VerbosityLevel:()=>r,assert:()=>q,bytesToString:()=>ft,createValidAbsoluteUrl:()=>X,getUuid:()=>R,getVerbosityLevel:()=>I,info:()=>O,isNodeJS:()=>y,normalizeUnicode:()=>E,objectFromMap:()=>m,setVerbosityLevel:()=>M,shadow:()=>H,string32:()=>Z,stringToBytes:()=>ct,unreachable:()=>B,warn:()=>N});const y=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),z=[1,0,0,1,0,0],_=[.001,0,0,.001,0,0],U=1e7,F=1.35,C={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256},T={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},A="pdfjs_internal_editor_",o={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},d={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35},u={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},b={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},s={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},g={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},t={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},r={ERRORS:0,WARNINGS:1,INFOS:5},c={NONE:0,BINARY:1},f={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},v={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let S=r.WARNINGS;function M(L){Number.isInteger(L)&&(S=L)}function I(){return S}function O(L){S>=r.INFOS&&console.log(`Info: ${L}`)}function N(L){S>=r.WARNINGS&&console.log(`Warning: ${L}`)}function B(L){throw new Error(L)}function q(L,x){L||B(x)}function st(L){switch(L?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function X(L,x=null,k=null){if(!L)return null;try{if(k&&typeof L=="string"&&(k.addDefaultProtocol&&L.startsWith("www.")&&L.match(/\./g)?.length>=2&&(L=`http://${L}`),k.tryConvertEncoding))try{L=h(L)}catch{}const D=x?new URL(L,x):new URL(L);if(st(D))return D}catch{}return null}function H(L,x,k,D=!1){return Object.defineProperty(L,x,{value:k,enumerable:!D,configurable:!0,writable:!1}),k}const G=function(){function x(k,D){this.constructor===x&&B("Cannot initialize BaseException."),this.message=k,this.name=D}return x.prototype=new Error,x.constructor=x,x}();class Y extends G{constructor(x,k){super(x,"PasswordException"),this.code=k}}class Q extends G{constructor(x,k){super(x,"UnknownErrorException"),this.details=k}}class K extends G{constructor(x){super(x,"InvalidPDFException")}}class at extends G{constructor(x){super(x,"MissingPDFException")}}class ot extends G{constructor(x,k){super(x,"UnexpectedResponseException"),this.status=k}}class lt extends G{constructor(x){super(x,"FormatError")}}class ht extends G{constructor(x){super(x,"AbortException")}}function ft(L){(typeof L!="object"||L?.length===void 0)&&B("Invalid argument for bytesToString");const x=L.length,k=8192;if(x<k)return String.fromCharCode.apply(null,L);const D=[];for(let j=0;j<x;j+=k){const J=Math.min(j+k,x),$=L.subarray(j,J);D.push(String.fromCharCode.apply(null,$))}return D.join("")}function ct(L){typeof L!="string"&&B("Invalid argument for stringToBytes");const x=L.length,k=new Uint8Array(x);for(let D=0;D<x;++D)k[D]=L.charCodeAt(D)&255;return k}function Z(L){return String.fromCharCode(L>>24&255,L>>16&255,L>>8&255,L&255)}function m(L){const x=Object.create(null);for(const[k,D]of L)x[k]=D;return x}function l(){const L=new Uint8Array(4);return L[0]=1,new Uint32Array(L.buffer,0,1)[0]===1}function e(){try{return new Function(""),!0}catch{return!1}}class n{static get isLittleEndian(){return H(this,"isLittleEndian",l())}static get isEvalSupported(){return H(this,"isEvalSupported",e())}static get isOffscreenCanvasSupported(){return H(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator<"u"&&typeof navigator?.platform=="string"?H(this,"platform",{isMac:navigator.platform.includes("Mac")}):H(this,"platform",{isMac:!1})}static get isCSSRoundSupported(){return H(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const a=Array.from(Array(256).keys(),L=>L.toString(16).padStart(2,"0"));class i{static makeHexColor(x,k,D){return`#${a[x]}${a[k]}${a[D]}`}static scaleMinMax(x,k){let D;x[0]?(x[0]<0&&(D=k[0],k[0]=k[2],k[2]=D),k[0]*=x[0],k[2]*=x[0],x[3]<0&&(D=k[1],k[1]=k[3],k[3]=D),k[1]*=x[3],k[3]*=x[3]):(D=k[0],k[0]=k[1],k[1]=D,D=k[2],k[2]=k[3],k[3]=D,x[1]<0&&(D=k[1],k[1]=k[3],k[3]=D),k[1]*=x[1],k[3]*=x[1],x[2]<0&&(D=k[0],k[0]=k[2],k[2]=D),k[0]*=x[2],k[2]*=x[2]),k[0]+=x[4],k[1]+=x[5],k[2]+=x[4],k[3]+=x[5]}static transform(x,k){return[x[0]*k[0]+x[2]*k[1],x[1]*k[0]+x[3]*k[1],x[0]*k[2]+x[2]*k[3],x[1]*k[2]+x[3]*k[3],x[0]*k[4]+x[2]*k[5]+x[4],x[1]*k[4]+x[3]*k[5]+x[5]]}static applyTransform(x,k){const D=x[0]*k[0]+x[1]*k[2]+k[4],j=x[0]*k[1]+x[1]*k[3]+k[5];return[D,j]}static applyInverseTransform(x,k){const D=k[0]*k[3]-k[1]*k[2],j=(x[0]*k[3]-x[1]*k[2]+k[2]*k[5]-k[4]*k[3])/D,J=(-x[0]*k[1]+x[1]*k[0]+k[4]*k[1]-k[5]*k[0])/D;return[j,J]}static getAxialAlignedBoundingBox(x,k){const D=this.applyTransform(x,k),j=this.applyTransform(x.slice(2,4),k),J=this.applyTransform([x[0],x[3]],k),$=this.applyTransform([x[2],x[1]],k);return[Math.min(D[0],j[0],J[0],$[0]),Math.min(D[1],j[1],J[1],$[1]),Math.max(D[0],j[0],J[0],$[0]),Math.max(D[1],j[1],J[1],$[1])]}static inverseTransform(x){const k=x[0]*x[3]-x[1]*x[2];return[x[3]/k,-x[1]/k,-x[2]/k,x[0]/k,(x[2]*x[5]-x[4]*x[3])/k,(x[4]*x[1]-x[5]*x[0])/k]}static singularValueDecompose2dScale(x){const k=[x[0],x[2],x[1],x[3]],D=x[0]*k[0]+x[1]*k[2],j=x[0]*k[1]+x[1]*k[3],J=x[2]*k[0]+x[3]*k[2],$=x[2]*k[1]+x[3]*k[3],tt=(D+$)/2,it=Math.sqrt((D+$)**2-4*(D*$-J*j))/2,W=tt+it||1,rt=tt-it||1;return[Math.sqrt(W),Math.sqrt(rt)]}static normalizeRect(x){const k=x.slice(0);return x[0]>x[2]&&(k[0]=x[2],k[2]=x[0]),x[1]>x[3]&&(k[1]=x[3],k[3]=x[1]),k}static intersect(x,k){const D=Math.max(Math.min(x[0],x[2]),Math.min(k[0],k[2])),j=Math.min(Math.max(x[0],x[2]),Math.max(k[0],k[2]));if(D>j)return null;const J=Math.max(Math.min(x[1],x[3]),Math.min(k[1],k[3])),$=Math.min(Math.max(x[1],x[3]),Math.max(k[1],k[3]));return J>$?null:[D,J,j,$]}static#t(x,k,D,j,J,$,tt,it,W,rt){if(W<=0||W>=1)return;const nt=1-W,ut=W*W,gt=ut*W,mt=nt*(nt*(nt*x+3*W*k)+3*ut*D)+gt*j,At=nt*(nt*(nt*J+3*W*$)+3*ut*tt)+gt*it;rt[0]=Math.min(rt[0],mt),rt[1]=Math.min(rt[1],At),rt[2]=Math.max(rt[2],mt),rt[3]=Math.max(rt[3],At)}static#e(x,k,D,j,J,$,tt,it,W,rt,nt,ut){if(Math.abs(W)<1e-12){Math.abs(rt)>=1e-12&&this.#t(x,k,D,j,J,$,tt,it,-nt/rt,ut);return}const gt=rt**2-4*nt*W;if(gt<0)return;const mt=Math.sqrt(gt),At=2*W;this.#t(x,k,D,j,J,$,tt,it,(-rt+mt)/At,ut),this.#t(x,k,D,j,J,$,tt,it,(-rt-mt)/At,ut)}static bezierBoundingBox(x,k,D,j,J,$,tt,it,W){return W?(W[0]=Math.min(W[0],x,tt),W[1]=Math.min(W[1],k,it),W[2]=Math.max(W[2],x,tt),W[3]=Math.max(W[3],k,it)):W=[Math.min(x,tt),Math.min(k,it),Math.max(x,tt),Math.max(k,it)],this.#e(x,D,J,tt,k,j,$,it,3*(-x+3*(D-J)+tt),6*(x-2*D+J),3*(D-x),W),this.#e(x,D,J,tt,k,j,$,it,3*(-k+3*(j-$)+it),6*(k-2*j+$),3*(j-k),W),W}}function h(L){return decodeURIComponent(escape(L))}let p=null,w=null;function E(L){return p||(p=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,w=new Map([["ﬅ","ſt"]])),L.replaceAll(p,(x,k,D)=>k?k.normalize("NFKC"):w.get(D))}function R(){if(typeof crypto<"u"&&typeof crypto?.randomUUID=="function")return crypto.randomUUID();const L=new Uint8Array(32);if(typeof crypto<"u"&&typeof crypto?.getRandomValues=="function")crypto.getRandomValues(L);else for(let x=0;x<32;x++)L[x]=Math.floor(Math.random()*255);return ft(L)}const P="pdfjs_internal_id_"}},Gt={};function Lt(dt){var et=Gt[dt];if(et!==void 0)return et.exports;var V=Gt[dt]={exports:{}};return Vt[dt](V,V.exports,Lt),V.exports}(()=>{var dt=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",et=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",V=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",y=_=>{_&&_.d<1&&(_.d=1,_.forEach(U=>U.r--),_.forEach(U=>U.r--?U.r++:U()))},z=_=>_.map(U=>{if(U!==null&&typeof U=="object"){if(U[dt])return U;if(U.then){var F=[];F.d=0,U.then(A=>{C[et]=A,y(F)},A=>{C[V]=A,y(F)});var C={};return C[dt]=A=>A(F),C}}var T={};return T[dt]=A=>{},T[et]=U,T});Lt.a=(_,U,F)=>{var C;F&&((C=[]).d=-1);var T=new Set,A=_.exports,o,d,u,b=new Promise((s,g)=>{u=g,d=s});b[et]=A,b[dt]=s=>(C&&s(C),T.forEach(s),b.catch(g=>{})),_.exports=b,U(s=>{o=z(s);var g,t=()=>o.map(c=>{if(c[V])throw c[V];return c[et]}),r=new Promise(c=>{g=()=>c(t),g.r=0;var f=v=>v!==C&&!T.has(v)&&(T.add(v),v&&!v.d&&(g.r++,v.push(g)));o.map(v=>v[dt](f))});return g.r?r:t()},s=>(s?u(b[V]=s):d(A),y(C))),C&&C.d<0&&(C.d=0)}})();Lt.d=(dt,et)=>{for(var V in et)Lt.o(et,V)&&!Lt.o(dt,V)&&Object.defineProperty(dt,V,{enumerable:!0,get:et[V]})};Lt.o=(dt,et)=>Object.prototype.hasOwnProperty.call(dt,et);var pt=Lt(228);pt=globalThis.pdfjsLib=await(globalThis.pdfjsLibPromise=pt);var jt=pt.AbortException,Yt=pt.AnnotationEditorLayer,Wt=pt.AnnotationEditorParamsType,qt=pt.AnnotationEditorType,Kt=pt.AnnotationEditorUIManager,Jt=pt.AnnotationLayer,Qt=pt.AnnotationMode,Zt=pt.CMapCompressionType,te=pt.ColorPicker,ee=pt.DOMSVGFactory,se=pt.DrawLayer,ie=pt.FeatureTest,ne=pt.GlobalWorkerOptions,re=pt.ImageKind,ae=pt.InvalidPDFException,oe=pt.MissingPDFException,he=pt.OPS,le=pt.Outliner,ce=pt.PDFDataRangeTransport,de=pt.PDFDateString,ue=pt.PDFWorker,fe=pt.PasswordResponses,pe=pt.PermissionFlag,ge=pt.PixelsPerInch,me=pt.RenderingCancelledException,be=pt.UnexpectedResponseException,Ae=pt.Util,ve=pt.VerbosityLevel,ye=pt.XfaLayer,we=pt.build,Se=pt.createValidAbsoluteUrl,xe=pt.fetchData,Ee=pt.getDocument,Te=pt.getFilenameFromUrl,Ce=pt.getPdfFilenameFromUrl,ke=pt.getXfaPageViewport,Fe=pt.isDataScheme,Re=pt.isPdfFile,Pe=pt.noContextMenu,Le=pt.normalizeUnicode,Me=pt.renderTextLayer,Ie=pt.setLayerDimensions,_e=pt.shadow,De=pt.updateTextLayer,Ne=pt.version;export{jt as AbortException,Yt as AnnotationEditorLayer,Wt as AnnotationEditorParamsType,qt as AnnotationEditorType,Kt as AnnotationEditorUIManager,Jt as AnnotationLayer,Qt as AnnotationMode,Zt as CMapCompressionType,te as ColorPicker,ee as DOMSVGFactory,se as DrawLayer,ie as FeatureTest,ne as GlobalWorkerOptions,re as ImageKind,ae as InvalidPDFException,oe as MissingPDFException,he as OPS,le as Outliner,ce as PDFDataRangeTransport,de as PDFDateString,ue as PDFWorker,fe as PasswordResponses,pe as PermissionFlag,ge as PixelsPerInch,me as RenderingCancelledException,be as UnexpectedResponseException,Ae as Util,ve as VerbosityLevel,ye as XfaLayer,we as build,Se as createValidAbsoluteUrl,xe as fetchData,Ee as getDocument,Te as getFilenameFromUrl,Ce as getPdfFilenameFromUrl,ke as getXfaPageViewport,Fe as isDataScheme,Re as isPdfFile,Pe as noContextMenu,Le as normalizeUnicode,Me as renderTextLayer,Ie as setLayerDimensions,_e as shadow,De as updateTextLayer,Ne as version};
